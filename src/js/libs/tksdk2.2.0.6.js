var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,e={next:function(){if(c<b.length){var d=c++;return{value:a(d,b[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var a=b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,c){b(a)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){e(a,
0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(h){b.reject(h)}};d.prototype.createResolveAndReject_=
function(){function a(a){return function(f){c||(c=!0,a.call(b,f))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(h){this.reject_(h);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var m=new a;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(F){r(F)}}:b}var f,r,e=new d(function(a,
b){f=a;r=b});this.callWhenSettled_(c(a,f),c(b,r));return e};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?m.asyncExecute(c):this.onSettledCallbacks_.push(function(){m.asyncExecute(c)})};d.resolve=c;d.reject=function(a){return new d(function(b,c){c(a)})};d.race=function(a){return new d(function(b,
d){for(var f=$jscomp.makeIterator(a),r=f.next();!r.done;r=f.next())c(r.value).callWhenSettled_(b,d)})};d.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?c([]):new d(function(a,d){function f(b){return function(c){r[b]=c;k--;0==k&&a(r)}}var r=[],k=0;do r.push(void 0),k++,c(e.value).callWhenSettled_(f(r.length-1),d),e=b.next();while(!e.done)})};return d},"es6","es3");
(function(){function b(b){return new Promise(function(c,d){a(b,c,d)})}var a=null,c=null,e={log:function(){"undefined"!==typeof module||"function"===typeof require&&"function"===typeof define||(window.webrtcLogDebug=void 0!=window.webrtcLogDebug&&"boolean"===typeof window.webrtcLogDebug?window.webrtcLogDebug:!0,window.webrtcLogDebug&&console.log.apply(console,arguments))},extractVersion:function(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)}};"object"===typeof window&&(!window.HTMLMediaElement||
"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(a){"mozSrcObject"in this?this.mozSrcObject=a:(this._srcObject=a,this.src=URL.createObjectURL(a))}}),a=window.navigator&&window.navigator.getUserMedia);if("undefined"!==typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(e.log("This appears to be Firefox"),c=e.extractVersion(navigator.userAgent,
/Firefox\/([0-9]+)\./,1),window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(38>c&&a&&a.iceServers){for(var d=[],k=0;k<a.iceServers.length;k++){var u=a.iceServers[k];if(u.hasOwnProperty("urls"))for(var f=0;f<u.urls.length;f++){var r={url:u.urls[f]};0===u.urls[f].indexOf("turn")&&(r.username=u.username,r.credential=u.credential);d.push(r)}else d.push(a.iceServers[k])}a.iceServers=d}return new mozRTCPeerConnection(a,b)},mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,
"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),a=function(a,b,d){var k=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(k){if("require"!==k&&"advanced"!==k&&"mediaSource"!==k){var c=a[k]="object"===typeof a[k]?a[k]:{ideal:a[k]};void 0===
c.min&&void 0===c.max&&void 0===c.exact||b.push(k);void 0!==c.exact&&("number"===typeof c.exact?c.min=c.max=c.exact:a[k]=c.exact,delete c.exact);if(void 0!==c.ideal){a.advanced=a.advanced||[];var u={};u[k]="number"===typeof c.ideal?{min:c.ideal,max:c.ideal}:c.ideal;a.advanced.push(u);delete c.ideal;Object.keys(c).length||delete a[k]}}});b.length&&(a.require=b);return a};38>c&&(e.log("spec: "+JSON.stringify(a)),a.audio&&(a.audio=k(a.audio)),a.video&&(a.video=k(a.video)),e.log("ff37: "+JSON.stringify(a)));
return navigator.mozGetUserMedia(a,b,d)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:b,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},41>c){var d=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);
navigator.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){e.log("This appears to be Chrome");c=e.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);window.RTCPeerConnection=function(a,b){a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);a=new webkitRTCPeerConnection(a,b);var c=a.getStats.bind(a);a.getStats=function(a,b,d){var k=
this,u=arguments;if(0<arguments.length&&"function"===typeof a)return c(a,b);var f=function(a){var b={};a.result().forEach(function(a){var k={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){k[b]=a.stat(b)});b[k.id]=k});return b};return 2<=arguments.length?c.apply(this,[function(a){u[1](f(a))},arguments[0]]):new Promise(function(b,d){1===u.length&&null===a?c.apply(k,[function(a){b.apply(null,[f(a)])},d]):c.apply(k,[b,d])})};return a};webkitRTCPeerConnection.generateCertificate&&
Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}});["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var k=1===arguments.length?arguments[0]:void 0;return new Promise(function(c,
d){b.apply(a,[c,d,k])})}return b.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,k=this;return new Promise(function(c,d){b.apply(k,[a[0],function(){c();2<=a.length&&a[1].apply(null,[])},function(b){d(b);3<=a.length&&a[2].apply(null,[b])}])})}});var m=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(c){if("require"!==
c&&"advanced"!==c&&"mediaSource"!==c){var k="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0!==k.exact&&"number"===typeof k.exact&&(k.min=k.max=k.exact);var u=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==k.ideal){b.optional=b.optional||[];var d={};"number"===typeof k.ideal?(d[u("min",c)]=k.ideal,b.optional.push(d),d={},d[u("max",c)]=k.ideal):d[u("",c)]=k.ideal;b.optional.push(d)}void 0!==k.exact&&"number"!==typeof k.exact?(b.mandatory=b.mandatory||
{},b.mandatory[u("",c)]=k.exact):["min","max"].forEach(function(a){void 0!==k[a]&&(b.mandatory=b.mandatory||{},b.mandatory[u(a,c)]=k[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b};a=function(a,b,c){a.audio&&(a.audio=m(a.audio));a.video&&(a.video=m(a.video));e.log("chrome: "+JSON.stringify(a));return navigator.webkitGetUserMedia(a,b,c)};navigator.getUserMedia=a;navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:b,enumerateDevices:function(){return new Promise(function(a){var b=
{audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}});if(navigator.mediaDevices.getUserMedia){var n=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){e.log("spec:   "+JSON.stringify(a));a.audio=m(a.audio);a.video=m(a.video);e.log("chrome: "+JSON.stringify(a));return n(a)}}else navigator.mediaDevices.getUserMedia=
function(a){return b(a)};"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){e.log("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){e.log("Dummy mediaDevices.removeEventListener called.")})}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(e.log("This appears to be Edge"),c=e.extractVersion(navigator.userAgent,
/Edge\/(\d+).(\d+)$/,2),window.RTCIceGatherer){var f=Math.random().toString(36).substr(2,10),h={splitLines:function(a){return a.trim().split("\n").map(function(a){return a.trim()})},splitSections:function(a){return a.split("\r\nm\x3d").map(function(a,b){return(0<b?"m\x3d"+a:a).trim()+"\r\n"})},matchPrefix:function(a,b){return h.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},parseCandidate:function(a){a=0===a.indexOf("a\x3dcandidate:")?a.substring(12).split(" "):a.substring(10).split(" ");
for(var b={foundation:a[0],component:a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},c=8;c<a.length;c+=2)switch(a[c]){case "raddr":b.relatedAddress=a[c+1];break;case "rport":b.relatedPort=parseInt(a[c+1],10);break;case "tcptype":b.tcpType=a[c+1]}return b},writeCandidate:function(a){var b=[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var c=a.type;b.push("typ");b.push(c);
"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));return"candidate:"+b.join(" ")},parseRtpMap:function(a){a=a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.numChannels=3===a.length?parseInt(a[2],10):1;return b},writeRtpMap:function(a){var b=a.payloadType;void 0!==
a.preferredPayloadType&&(b=a.preferredPayloadType);return"a\x3drtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},parseFmtp:function(a){for(var b={},c=a.substr(a.indexOf(" ")+1).split(";"),k=0;k<c.length;k++)a=c[k].trim().split("\x3d"),b[a[0].trim()]=a[1];return b},writeFtmp:function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);if(a.parameters&&a.parameters.length){var k=[];Object.keys(a.parameters).forEach(function(b){k.push(b+
"\x3d"+a.parameters[b])});b+="a\x3dfmtp:"+c+" "+k.join(";")+"\r\n"}return b},parseRtcpFb:function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},writeRtcpFb:function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a\x3drtcp-fb:"+c+" "+a.type+" "+a.parameter+"\r\n"});return b},parseSsrcMedia:function(a){var b=a.indexOf(" "),c={ssrc:a.substr(7,
b-7)},k=a.indexOf(":",b);-1<k?(c.attribute=a.substr(b+1,k-b-1),c.value=a.substr(k+1)):c.attribute=a.substr(b+1);return c},getDtlsParameters:function(a,b){a=h.splitLines(a);a=a.concat(h.splitLines(b));b=a.filter(function(a){return 0===a.indexOf("a\x3dfingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:b.split(" ")[0],value:b.split(" ")[1]}]}},writeDtlsParameters:function(a,b){var c="a\x3dsetup:"+b+"\r\n";a.fingerprints.forEach(function(a){c+="a\x3dfingerprint:"+a.algorithm+" "+
a.value+"\r\n"});return c},getIceParameters:function(a,b){a=h.splitLines(a);a=a.concat(h.splitLines(b));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a\x3dice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a\x3dice-pwd:")})[0].substr(10)}},writeIceParameters:function(a){return"a\x3dice-ufrag:"+a.usernameFragment+"\r\na\x3dice-pwd:"+a.password+"\r\n"},parseRtpParameters:function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},
c=h.splitLines(a)[0].split(" "),k=3;k<c.length;k++){var u=c[k],d=h.matchPrefix(a,"a\x3drtpmap:"+u+" ")[0];if(d){d=h.parseRtpMap(d);var f=h.matchPrefix(a,"a\x3dfmtp:"+u+" ");d.parameters=f.length?h.parseFmtp(f[0]):{};d.rtcpFeedback=h.matchPrefix(a,"a\x3drtcp-fb:"+u+" ").map(h.parseRtcpFb);b.codecs.push(d)}}return b},writeRtpDescription:function(a,b){var c="";c+="m\x3d"+a+" ";c+=0<b.codecs.length?"9":"0";c+=" UDP/TLS/RTP/SAVPF ";c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:
a.payloadType}).join(" ")+"\r\n";c+="c\x3dIN IP4 0.0.0.0\r\n";c+="a\x3drtcp:9 IN IP4 0.0.0.0\r\n";b.codecs.forEach(function(a){c+=h.writeRtpMap(a);c+=h.writeFtmp(a);c+=h.writeRtcpFb(a)});return c+="a\x3drtcp-mux\r\n"},writeSessionBoilerplate:function(){return"v\x3d0\r\no\x3dthisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns\x3d-\r\nt\x3d0 0\r\n"},writeMediaSection:function(a,b,c,k){b=h.writeRtpDescription(a.kind,b);b+=h.writeIceParameters(a.iceGatherer.getLocalParameters());b+=h.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),
"offer"===c?"actpass":"active");b+="a\x3dmid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a\x3dsendrecv\r\n":a.rtpSender?b+"a\x3dsendonly\r\n":a.rtpReceiver?b+"a\x3drecvonly\r\n":b+"a\x3dinactive\r\n";a.rtpSender&&(c="msid:"+k.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a\x3d"+c)+("a\x3dssrc:"+a.sendSsrc+" "+c));return b+="a\x3dssrc:"+a.sendSsrc+" cname:"+f+"\r\n"},getDirection:function(a,b){a=h.splitLines(a);for(var c=0;c<a.length;c++)switch(a[c]){case "a\x3dsendrecv":case "a\x3dsendonly":case "a\x3drecvonly":case "a\x3dinactive":return a[c].substr(2)}return b?
h.getDirection(b):"sendrecv"}};window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a});window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a});window.RTCPeerConnection=function(a){var b=this;this.ondatachannel=this.onnegotiationneeded=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.onaddstream=this.onicecandidate=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return b.localStreams};this.getRemoteStreams=
function(){return b.remoteStreams};this.localDescription=new RTCSessionDescription({type:"",sdp:""});this.remoteDescription=new RTCSessionDescription({type:"",sdp:""});this.signalingState="stable";this.iceConnectionState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case "all":case "relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case "none":throw new TypeError('iceTransportPolicy "none" not supported');}a&&a.iceServers&&
a.iceServers.forEach(function(a){if(a.urls){var c="string"===typeof a.urls?a.urls:a.urls[0];-1!==c.indexOf("transport\x3dudp")&&b.iceServers.push({username:a.username,credential:a.credential,urls:c})}});this.transceivers=[];this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this;this._localIceCandidatesBuffer.forEach(function(b){if(null!==a.onicecandidate)a.onicecandidate(b)});this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype.addStream=
function(a){this.localStreams.push(a.clone());this._maybeFireNegotiationNeeded()};window.RTCPeerConnection.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,1),this._maybeFireNegotiationNeeded())};window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};a.codecs.forEach(function(a){for(var k=0;k<b.codecs.length;k++){var d=b.codecs[k];if(a.name.toLowerCase()===d.name.toLowerCase()&&
a.clockRate===d.clockRate&&a.numChannels===d.numChannels){c.codecs.push(d);break}}});a.headerExtensions.forEach(function(a){for(var k=0;k<b.headerExtensions.length;k++){var d=b.headerExtensions[k];if(a.uri===d.uri){c.headerExtensions.push(d);break}}});return c};window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,k=new RTCIceGatherer(c.iceOptions),d=new RTCIceTransport(k);k.onlocalcandidate=function(u){var f={};f.candidate={sdpMid:a,sdpMLineIndex:b};(u=u.candidate)&&
0!==Object.keys(u).length?(u.component="RTCP"===d.component?2:1,f.candidate.candidate=h.writeCandidate(u)):(void 0===k.state&&(k.state="completed"),f.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");u=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});if(null!==c.onicecandidate)if(c.localDescription&&""===c.localDescription.type)c._localIceCandidatesBuffer.push(f),u&&c._localIceCandidatesBuffer.push({});else if(c.onicecandidate(f),u)c.onicecandidate({})};
d.onicestatechange=function(){c._updateConnectionState()};var f=new RTCDtlsTransport(d);f.ondtlsstatechange=function(){c._updateConnectionState()};f.onerror=function(){f.state="failed";c._updateConnectionState()};return{iceGatherer:k,iceTransport:d,dtlsTransport:f}};window.RTCPeerConnection.prototype._transceive=function(a,b,c){var k=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(k.encodings=[{ssrc:a.sendSsrc}],k.rtcp={cname:f,ssrc:a.recvSsrc},a.rtpSender.send(k));
c&&a.rtpReceiver&&(k.encodings=[{ssrc:a.recvSsrc}],k.rtcp={cname:a.cname,ssrc:a.sendSsrc},a.rtpReceiver.receive(k))};window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b=this;if("offer"===a.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){var c=h.splitSections(b.remoteDescription.sdp),k=c.shift();c.forEach(function(a,c){c=b.transceivers[c];var d=c.iceGatherer,u=c.iceTransport,f=c.dtlsTransport,e=c.localCapabilities,
l=c.remoteCapabilities;if("0"!==a.split("\n",1)[0].split(" ",2)[1]){var t=h.getIceParameters(a,k);u.start(d,t,"controlled");a=h.getDtlsParameters(a,k);f.start(a);a=b._getCommonCapabilities(e,l);b._transceive(c,0<a.codecs.length,!1)}})}this.localDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}var d=1<arguments.length&&"function"===typeof arguments[1];
if(d){var f=arguments[1];window.setTimeout(function(){f();b._emitBufferedCandidates()},0)}c=Promise.resolve();c.then(function(){d||window.setTimeout(b._emitBufferedCandidates.bind(b),0)});return c};window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,k=h.splitSections(a.sdp),d=k.shift();k.forEach(function(k,u){var f=h.splitLines(k)[0].substr(2).split(" "),e=f[0],l="0"===f[1];f=h.getDirection(k,d);var t=h.parseRtpParameters(k);if(!l){var n=h.getIceParameters(k,
d);var m=h.getDtlsParameters(k,d)}var w=h.matchPrefix(k,"a\x3dmid:")[0].substr(6);if(k=h.matchPrefix(k,"a\x3dssrc:").map(function(a){return h.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0]){var F=parseInt(k.ssrc,10);var r=k.value}if("offer"===a.type){n=b._createIceAndDtlsTransports(w,u);var P=RTCRtpReceiver.getCapabilities(e);l=1001*(2*u+2);k=new RTCRtpReceiver(n.dtlsTransport,e);c.addTrack(k.track);if(0<b.localStreams.length&&b.localStreams[0].getTracks().length>=u){var xa=
b.localStreams[0].getTracks()[u];xa=new RTCRtpSender(xa,n.dtlsTransport)}b.transceivers[u]={iceGatherer:n.iceGatherer,iceTransport:n.iceTransport,dtlsTransport:n.dtlsTransport,localCapabilities:P,remoteCapabilities:t,rtpSender:xa,rtpReceiver:k,kind:e,mid:w,cname:r,sendSsrc:l,recvSsrc:F};b._transceive(b.transceivers[u],!1,"sendrecv"===f||"sendonly"===f)}else if("answer"===a.type&&!l){e=b.transceivers[u];w=e.iceGatherer;var Pa=e.iceTransport;var Ja=e.dtlsTransport;xa=e.rtpSender;k=e.rtpReceiver;l=e.sendSsrc;
P=e.localCapabilities;b.transceivers[u].recvSsrc=F;b.transceivers[u].remoteCapabilities=t;b.transceivers[u].cname=r;Pa.start(w,n,"controlling");Ja.start(m);b._transceive(e,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f);!k||"sendrecv"!==f&&"sendonly"!==f?delete e.rtpReceiver:c.addTrack(k.track)}});this.remoteDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+
a.type+'"');}window.setTimeout(function(){null!==b.onaddstream&&c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){b.onaddstream({stream:c})},0))},0);1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&
a.rtpReceiver.stop()});this._updateSignalingState("closed")};window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;if(null!==this.onsignalingstatechange)this.onsignalingstatechange()};window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){if(null!==this.onnegotiationneeded)this.onnegotiationneeded()};window.RTCPeerConnection.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};
this.transceivers.forEach(function(b){a[b.iceTransport.state]++;a[b.dtlsTransport.state]++});a.connected+=a.completed;var b="new";if(0<a.failed)b="failed";else if(0<a.connecting||0<a.checking)b="connecting";else if(0<a.disconnected)b="disconnected";else if(0<a.new)b="new";else if(0<a.connecting||0<a.completed)b="connected";if(b!==this.iceConnectionState&&(this.iceConnectionState=b,null!==this.oniceconnectionstatechange))this.oniceconnectionstatechange()};window.RTCPeerConnection.prototype.createOffer=
function(){var a=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!==typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],k=0,d=0;this.localStreams.length&&(k=this.localStreams[0].getAudioTracks().length,d=this.localStreams[0].getVideoTracks().length);if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&
(k=b.offerToReceiveAudio);void 0!==b.offerToReceiveVideo&&(d=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?0<k:0<d});"audio"===a.kind?k--:"video"===a.kind&&d--});0<k||0<d;)0<k&&(c.push({kind:"audio",wantReceive:!0}),k--),0<d&&(c.push({kind:"video",wantReceive:!0}),d--);var f=h.writeSessionBoilerplate(),e=[];c.forEach(function(b,c){var k=b.track,d=b.kind,u=Math.random().toString(36).substr(2,
10),l=a._createIceAndDtlsTransports(u,c),n=RTCRtpSender.getCapabilities(d),t,m,w=1001*(2*c+1);k&&(t=new RTCRtpSender(k,l.dtlsTransport));b.wantReceive&&(m=new RTCRtpReceiver(l.dtlsTransport,d));e[c]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:n,remoteCapabilities:null,rtpSender:t,rtpReceiver:m,kind:d,mid:u,sendSsrc:w,recvSsrc:null};b=e[c];f+=h.writeMediaSection(b,b.localCapabilities,"offer",a.localStreams[0])});this._pendingOffer=e;b=new RTCSessionDescription({type:"offer",
sdp:f});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,b);return Promise.resolve(b)};window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=h.writeSessionBoilerplate();this.transceivers.forEach(function(c){var k=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=h.writeMediaSection(c,k,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],
0,c);return Promise.resolve(c)};window.RTCPeerConnection.prototype.addIceCandidate=function(a){var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}if(b=this.transceivers[b]){c=0<Object.keys(a.candidate).length?h.parseCandidate(a.candidate):{};if("tcp"===c.protocol&&0===c.port||"1"!==c.component)return;"endOfCandidates"===c.type&&(c={});b.iceTransport.addRemoteCandidate(c)}1<arguments.length&&"function"===typeof arguments[1]&&
window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1];return new Promise(function(c){var k={};Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){k[b]=a[b]})});
b&&window.setTimeout(b,0,k);c(k)})})}}}else e.log("Browser does not appear to be WebRTC-capable");else e.log("This does not appear to be a browser");var l={};try{Object.defineProperty(l,"version",{set:function(a){c=a}})}catch(r){}})();(function(){var b=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"===typeof window.__SDKDEV__)try{b=window.__SDKDEV__}catch(c){b=!1}if(!b){b=decodeURIComponent(window.location.href);var a=b.indexOf("?");b=b.substring(a+1).match(/(^|&)debug=([^&]*)(&|$)/i);b=null!=b?b[2]:""}window.__TkSdkBuild__=!b;try{window.localStorage?window.localStorage.setItem("debug",b?"*":"none"):console.warn("[tk-sdk]window.localStorage is not exist!")}catch(c){console.warn("[tk-sdk]Browser does not support localStorage!")}})();
!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.io=a():b.io=a()}(this,function(){return function(b){function a(e){if(c[e])return c[e].exports;var d=c[e]={exports:{},id:e,loaded:!1};return b[e].call(d.exports,d,d.exports,a),d.loaded=!0,d.exports}var c={};return a.m=b,a.c=c,a.p="",a(0)}([function(b,a,c){function e(a,b){"object"===("undefined"==typeof a?"undefined":d(a))&&(b=a,a=void 0);
b=b||{};var c;a=m(a);var k=a.source,u=a.id,e=a.path;e=l[u]&&e in l[u].nsps;return b.forceNew||b["force new connection"]||!1===b.multiplex||e?(h("ignoring socket cache for %s",k),c=f(k,b)):(l[u]||(h("new io instance for %s",k),l[u]=f(k,b)),c=l[u]),a.query&&!b.query&&(b.query=a.query),c.socket(a.path,b)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":
typeof a},m=c(1),n=c(7),f=c(13),h=c(3)("socket.io-client");b.exports=a=e;var l=a.managers={};a.protocol=n.protocol;a.connect=e;a.Manager=c(13);a.Socket=c(39)},function(b,a,c){(function(a){var d=c(2),e=c(3)("socket.io-client:url");b.exports=function(b,c){var f=b;c=c||a.location;null==b&&(b=c.protocol+"//"+c.host);"string"==typeof b&&("/"===b.charAt(0)&&(b="/"===b.charAt(1)?c.protocol+b:c.host+b),/^(https?|wss?):\/\//.test(b)||(e("protocol-less url %s",b),b="undefined"!=typeof c?c.protocol+"//"+b:"https://"+
b),e("parse %s",b),f=d(b));f.port||(/^(http|ws)$/.test(f.protocol)?f.port="80":/^(http|ws)s$/.test(f.protocol)&&(f.port="443"));f.path=f.path||"/";b=-1!==f.host.indexOf(":")?"["+f.host+"]":f.host;return f.id=f.protocol+"://"+b+":"+f.port,f.href=f.protocol+"://"+b+(c&&c.port===f.port?"":":"+f.port),f}}).call(a,function(){return this}())},function(b,a){var c=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.exports=function(a){var b=a,d=a.indexOf("["),f=a.indexOf("]");-1!=d&&-1!=f&&(a=a.substring(0,d)+a.substring(d,f).replace(/:/g,";")+a.substring(f,a.length));a=c.exec(a||"");for(var h={},l=14;l--;)h[e[l]]=a[l]||"";return-1!=d&&-1!=f&&(h.source=b,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=
!0),h}},function(b,a,c){(function(e){function d(){try{var b=a.storage.debug}catch(h){}return!b&&"undefined"!=typeof e&&"env"in e&&(b=e.env.DEBUG),b}a=b.exports=c(5);a.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};a.formatArgs=function(b){var c=this.useColors;if(b[0]=(c?"%c":"")+this.namespace+(c?" %c":" ")+b[0]+(c?"%c ":" ")+"+"+a.humanize(this.diff),c){c="color: "+this.color;b.splice(1,0,c,"color: inherit");var d=0,f=0;b[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&(d++,"%c"===a&&(f=d))});b.splice(f,0,c)}};a.save=function(b){try{null==b?a.storage.removeItem("debug"):a.storage.debug=b}catch(h){}};a.load=d;a.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var m=a;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var n=chrome.storage.local;else a:{try{n=window.localStorage;break a}catch(f){}n=void 0}m.storage=n;a.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
a.formatters.j=function(a){try{return JSON.stringify(a)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}};a.enable(d())}).call(a,c(4))},function(b,a){function c(){throw Error("setTimeout has not been defined");}function e(){throw Error("clearTimeout has not been defined");}function d(a){if(r===setTimeout)return setTimeout(a,0);if((r===c||!r)&&setTimeout)return r=setTimeout,setTimeout(a,0);try{return r(a,0)}catch(B){try{return r.call(null,a,0)}catch(G){return r.call(this,a,0)}}}function m(a){if(w===
clearTimeout)return clearTimeout(a);if((w===e||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(a);try{return w(a)}catch(B){try{return w.call(null,a)}catch(G){return w.call(this,a)}}}function n(){u&&t&&(u=!1,t.length?k=t.concat(k):F=-1,k.length&&f())}function f(){if(!u){var a=d(n);u=!0;for(var b=k.length;b;){t=k;for(k=[];++F<b;)t&&t[F].run();F=-1;b=k.length}t=null;u=!1;m(a)}}function h(a,b){this.fun=a;this.array=b}function l(){}b=b.exports={};try{var r="function"==typeof setTimeout?setTimeout:
c}catch(P){r=c}try{var w="function"==typeof clearTimeout?clearTimeout:e}catch(P){w=e}!0;var t,k=[],u=!1,F=-1;b.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];k.push(new h(a,b));1!==k.length||u||d(f)};h.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=l;b.addListener=l;b.once=l;b.off=l;b.removeListener=l;b.removeAllListeners=l;
b.emit=l;b.prependListener=l;b.prependOnceListener=l;b.listeners=function(a){return[]};b.binding=function(a){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},function(b,a,c){function e(b){var c,d=0;for(c in b)d=(d<<5)-d+b.charCodeAt(c),d|=0;return a.colors[Math.abs(d)%a.colors.length]}function d(b){function c(){if(c.enabled){var b=+new Date;c.diff=b-(m||b);c.prev=m;m=c.curr=
b;var d=Array(arguments.length);for(b=0;b<d.length;b++)d[b]=arguments[b];d[0]=a.coerce(d[0]);"string"!=typeof d[0]&&d.unshift("%O");var f=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(b,e){if("%%"===b)return b;f++;e=a.formatters[e];"function"==typeof e&&(b=e.call(c,d[f]),d.splice(f,1),f--);return b});a.formatArgs.call(c,d);(c.log||a.log||console.log.bind(console)).apply(c,d)}}return c.namespace=b,c.enabled=a.enabled(b),c.useColors=a.useColors(),c.color=e(b),"function"==typeof a.init&&a.init(c),c}a=
b.exports=d.debug=d["default"]=d;a.coerce=function(a){return a instanceof Error?a.stack||a.message:a};a.disable=function(){a.enable("")};a.enable=function(b){a.save(b);a.names=[];a.skips=[];for(var c=("string"==typeof b?b:"").split(/[\s,]+/),d=c.length,e=0;e<d;e++)c[e]&&(b=c[e].replace(/\*/g,".*?"),"-"===b[0]?a.skips.push(new RegExp("^"+b.substr(1)+"$")):a.names.push(new RegExp("^"+b+"$")))};a.enabled=function(b){var c;var d=0;for(c=a.skips.length;d<c;d++)if(a.skips[d].test(b))return!1;d=0;for(c=
a.names.length;d<c;d++)if(a.names[d].test(b))return!0;return!1};a.humanize=c(6);a.names=[];a.skips=[];a.formatters={};var m},function(b,a){function c(a){if(a=String(a),!(100<a.length))if(a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a)){var b=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return b*h;case "days":case "day":case "d":return b*f;case "hours":case "hour":case "hrs":case "hr":case "h":return b*
n;case "minutes":case "minute":case "mins":case "min":case "m":return b*m;case "seconds":case "second":case "secs":case "sec":case "s":return b*d;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return b}}}function e(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var d=1E3,m=60*d,n=60*m,f=24*n,h=365.25*f;b.exports=function(a,b){b=b||{};var l=typeof a;if("string"===l&&0<a.length)return c(a);if("number"===l&&!1===isNaN(a))return b["long"]?e(a,
f,"day")||e(a,n,"hour")||e(a,m,"minute")||e(a,d,"second")||a+" ms":a>=f?Math.round(a/f)+"d":a>=n?Math.round(a/n)+"h":a>=m?Math.round(a/m)+"m":a>=d?Math.round(a/d)+"s":a+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(a));}},function(b,a,c){function e(){}function d(b){var c=""+b.type;return a.BINARY_EVENT!==b.type&&a.BINARY_ACK!==b.type||(c+=b.attachments+"-"),b.nsp&&"/"!==b.nsp&&(c+=b.nsp+","),null!=b.id&&(c+=b.id),null!=b.data&&(c+=JSON.stringify(b.data)),
l("encoded %j as %s",b,c),c}function m(a,b){w.removeBlobs(a,function(a){var c=w.deconstructPacket(a);a=d(c.packet);c=c.buffers;c.unshift(a);b(c)})}function n(){this.reconstructor=null}function f(a){this.reconPack=a;this.buffers=[]}function h(){return{type:a.ERROR,data:"parser error"}}var l=c(3)("socket.io-parser");b=c(8);var r=c(9),w=c(11),t=c(12);a.protocol=4;a.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");a.CONNECT=0;a.DISCONNECT=1;a.EVENT=2;a.ACK=3;a.ERROR=4;a.BINARY_EVENT=
5;a.BINARY_ACK=6;a.Encoder=e;a.Decoder=n;e.prototype.encode=function(b,c){(b.type!==a.EVENT&&b.type!==a.ACK||!r(b.data)||(b.type=b.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK),l("encoding packet %j",b),a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type)?m(b,c):(b=d(b),c([b]))};b(n.prototype);n.prototype.add=function(b){if("string"==typeof b){var c=0,k={type:Number(b.charAt(0))};if(null==a.types[k.type])b=h();else{if(a.BINARY_EVENT===k.type||a.BINARY_ACK===k.type){for(var d="";"-"!==b.charAt(++c)&&(d+=
b.charAt(c),c!=b.length););if(d!=Number(d)||"-"!==b.charAt(c))throw Error("Illegal attachments");k.attachments=Number(d)}if("/"===b.charAt(c+1))for(k.nsp="";++c;){d=b.charAt(c);if(","===d)break;if(k.nsp+=d,c===b.length)break}else k.nsp="/";d=b.charAt(c+1);if(""!==d&&Number(d)==d){for(k.id="";++c;){d=b.charAt(c);if(null==d||Number(d)!=d){--c;break}if(k.id+=b.charAt(c),c===b.length)break}k.id=Number(k.id)}if(b.charAt(++c)){b:{c=b.substr(c);try{k.data=JSON.parse(c)}catch(B){c=h();break b}c=k}k=c}b=(l("decoded %s as %j",
b,k),k)}a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type?(this.reconstructor=new f(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else{if(!t(b)&&!b.base64)throw Error("Unknown type: "+b);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(b=this.reconstructor.takeBinaryData(b))&&(this.reconstructor=null,this.emit("decoded",b))}};n.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
f.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===this.reconPack.attachments)?(a=w.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};f.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(b,a,c){function e(a){if(a){for(var b in e.prototype)a[b]=e.prototype[b];return a}}b.exports=e;e.prototype.on=e.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+
a]=this._callbacks["$"+a]||[]).push(b),this};e.prototype.once=function(a,b){function c(){this.off(a,c);b.apply(this,arguments)}return c.fn=b,this.on(a,c),this};e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=
c[e],d===b||d.fn===b){c.splice(e,1);break}return this};e.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this};e.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};e.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(b,a,c){(function(a){function d(b){if(!b||"object"!=typeof b)return!1;
if(e(b)){for(var c=0,l=b.length;c<l;c++)if(d(b[c]))return!0;return!1}if("function"==typeof a.Buffer&&a.Buffer.isBuffer&&a.Buffer.isBuffer(b)||"function"==typeof a.ArrayBuffer&&b instanceof ArrayBuffer||f&&b instanceof Blob||h&&b instanceof File)return!0;if(b.toJSON&&"function"==typeof b.toJSON&&1===arguments.length)return d(b.toJSON(),!0);for(c in b)if(Object.prototype.hasOwnProperty.call(b,c)&&d(b[c]))return!0;return!1}var e=c(10),n=Object.prototype.toString,f="function"==typeof a.Blob||"[object BlobConstructor]"===
n.call(a.Blob),h="function"==typeof a.File||"[object FileConstructor]"===n.call(a.File);b.exports=d}).call(a,function(){return this}())},function(b,a){var c={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},function(b,a,c){(function(b){function d(a,b){if(!a)return a;if(f(a)){var c={_placeholder:!0,num:b.length};return b.push(a),c}if(n(a)){c=Array(a.length);for(var u=0;u<a.length;u++)c[u]=d(a[u],b);return c}if("object"==typeof a&&!(a instanceof Date)){c={};for(u in a)c[u]=
d(a[u],b);return c}return a}function e(a,b){if(!a)return a;if(a&&a._placeholder)return b[a.num];if(n(a))for(var c=0;c<a.length;c++)a[c]=e(a[c],b);else if("object"==typeof a)for(c in a)a[c]=e(a[c],b);return a}var n=c(10),f=c(12),h=Object.prototype.toString,l="function"==typeof b.Blob||"[object BlobConstructor]"===h.call(b.Blob),r="function"==typeof b.File||"[object FileConstructor]"===h.call(b.File);a.deconstructPacket=function(a){var b=[];return a.data=d(a.data,b),a.attachments=b.length,{packet:a,
buffers:b}};a.reconstructPacket=function(a,b){return a.data=e(a.data,b),a.attachments=void 0,a};a.removeBlobs=function(a,b){function c(a,k,u){if(!a)return a;if(l&&a instanceof Blob||r&&a instanceof File){d++;var h=new FileReader;h.onload=function(){u?u[k]=this.result:e=this.result;--d||b(e)};h.readAsArrayBuffer(a)}else if(n(a))for(h=0;h<a.length;h++)c(a[h],h,a);else if("object"==typeof a&&!f(a))for(h in a)c(a[h],h,a)}var d=0,e=a;c(e);d||b(e)}}).call(a,function(){return this}())},function(b,a){(function(a){b.exports=
function(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}}).call(a,function(){return this}())},function(b,a,c){function e(a,b){if(!(this instanceof e))return new e(a,b);a&&"object"===("undefined"==typeof a?"undefined":d(a))&&(b=a,a=void 0);b=b||{};b.path=b.path||"/socket.io";this.nsps={};this.subs=[];this.opts=b;this.reconnection(!1!==b.reconnection);this.reconnectionAttempts(b.reconnectionAttempts||1/0);this.reconnectionDelay(b.reconnectionDelay||1E3);this.reconnectionDelayMax(b.reconnectionDelayMax||
5E3);this.randomizationFactor(b.randomizationFactor||.5);this.backoff=new t({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==b.timeout?2E4:b.timeout);this.readyState="closed";this.uri=a;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];a=b.parser||f;this.encoder=new a.Encoder;this.decoder=new a.Decoder;(this.autoConnect=!1!==b.autoConnect)&&this.open()}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?
function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},m=c(14),n=c(39);a=c(8);var f=c(7),h=c(41),l=c(42),r=c(3)("socket.io-client:manager"),w=c(37),t=c(43),k=Object.prototype.hasOwnProperty;b.exports=e;e.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)k.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)};e.prototype.updateSocketIds=function(){for(var a in this.nsps)k.call(this.nsps,
a)&&(this.nsps[a].id=this.generateId(a))};e.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};a(e.prototype);e.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};e.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};e.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),
this):this._reconnectionDelay};e.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};e.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};e.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout};e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&
this._reconnection&&0===this.backoff.attempts&&this.reconnect()};e.prototype.open=e.prototype.connect=function(a,b){if(r("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;r("opening %s",this.uri);var c=this.engine=m(this.uri,this.opts),d=this;this.readyState="opening";this.skipReconnect=!1;var k=h(c,"open",function(){d.onopen();a&&a()});b=h(c,"error",function(b){if(r("connect_error"),d.cleanup(),d.readyState="closed",d.emitAll("connect_error",b),a){var c=Error("Connection error");
c.data=b;a(c)}else d.maybeReconnectOnOpen()});if(!1!==this._timeout){var f=this._timeout;r("connect attempt will timeout after %d",f);var u=setTimeout(function(){r("connect attempt timed out after %d",f);k.destroy();c.close();c.emit("error","timeout");d.emitAll("connect_timeout",f)},f);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(k),this.subs.push(b),this};e.prototype.onopen=function(){r("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;
this.subs.push(h(a,"data",l(this,"ondata")));this.subs.push(h(a,"ping",l(this,"onping")));this.subs.push(h(a,"pong",l(this,"onpong")));this.subs.push(h(a,"error",l(this,"onerror")));this.subs.push(h(a,"close",l(this,"onclose")));this.subs.push(h(this.decoder,"decoded",l(this,"ondecoded")))};e.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};e.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};e.prototype.ondata=function(a){this.decoder.add(a)};e.prototype.ondecoded=
function(a){this.emit("packet",a)};e.prototype.onerror=function(a){r("error",a);this.emitAll("error",a)};e.prototype.socket=function(a,b){function c(){~w(k.connecting,d)||k.connecting.push(d)}var d=this.nsps[a];if(!d){d=new n(this,a,b);this.nsps[a]=d;var k=this;d.on("connecting",c);d.on("connect",function(){d.id=k.generateId(a)});this.autoConnect&&c()}return d};e.prototype.destroy=function(a){a=w(this.connecting,a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};e.prototype.packet=
function(a){r("writing packet %j",a);var b=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1;b.processPacketQueue()}))};e.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};e.prototype.cleanup=function(){r("cleanup");for(var a=this.subs.length,b=0;b<a;b++)this.subs.shift().destroy();
this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};e.prototype.close=e.prototype.disconnect=function(){r("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};e.prototype.onclose=function(a){r("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};
e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)r("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();r("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(r("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),
a.skipReconnect||a.open(function(b){b?(r("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(r("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}};e.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(b,a,c){b.exports=c(15)},function(b,a,c){b.exports=c(16);b.exports.parser=c(23)},function(b,a,
c){(function(a){function d(b,c){if(!(this instanceof d))return new d(b,c);c=c||{};b&&"object"==typeof b&&(c=b,b=null);b?(b=r(b),c.hostname=b.host,c.secure="https"===b.protocol||"wss"===b.protocol,c.port=b.port,b.query&&(c.query=b.query)):c.host&&(c.hostname=r(c.host).host);this.secure=null!=c.secure?c.secure:a.location&&"https:"===location.protocol;c.hostname&&!c.port&&(c.port=this.secure?"443":"80");this.agent=c.agent||!1;this.hostname=c.hostname||(a.location?location.hostname:"localhost");this.port=
c.port||(a.location&&location.port?location.port:this.secure?443:80);this.query=c.query||{};"string"==typeof this.query&&(this.query=t.decode(this.query));this.upgrade=!1!==c.upgrade;this.path=(c.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!c.forceJSONP;this.jsonp=!1!==c.jsonp;this.forceBase64=!!c.forceBase64;this.enablesXDR=!!c.enablesXDR;this.timestampParam=c.timestampParam||"t";this.timestampRequests=c.timestampRequests;this.transports=c.transports||["polling","websocket"];this.transportOptions=
c.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=c.policyPort||843;this.rememberUpgrade=c.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=c.onlyBinaryUpgrades;this.perMessageDeflate=!1!==c.perMessageDeflate&&(c.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024);this.pfx=c.pfx||null;this.key=c.key||null;
this.passphrase=c.passphrase||null;this.cert=c.cert||null;this.ca=c.ca||null;this.ciphers=c.ciphers||null;this.rejectUnauthorized=void 0===c.rejectUnauthorized||c.rejectUnauthorized;this.forceNode=!!c.forceNode;b="object"==typeof a&&a;b.global===b&&(c.extraHeaders&&0<Object.keys(c.extraHeaders).length&&(this.extraHeaders=c.extraHeaders),c.localAddress&&(this.localAddress=c.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}
var e=c(17),n=c(8),f=c(3)("engine.io-client:socket"),h=c(37),l=c(23),r=c(2),w=c(38),t=c(31);b.exports=d;d.priorWebsocketSuccess=!1;n(d.prototype);d.protocol=l.protocol;d.Socket=d;d.Transport=c(22);d.transports=c(17);d.parser=c(23);d.prototype.createTransport=function(a){f('creating transport "%s"',a);var b=this.query,c={},d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);c.EIO=l.protocol;c.transport=a;b=this.transportOptions[a]||{};this.id&&(c.sid=this.id);return new e[a]({query:c,socket:this,agent:b.agent||
this.agent,hostname:b.hostname||this.hostname,port:b.port||this.port,secure:b.secure||this.secure,path:b.path||this.path,forceJSONP:b.forceJSONP||this.forceJSONP,jsonp:b.jsonp||this.jsonp,forceBase64:b.forceBase64||this.forceBase64,enablesXDR:b.enablesXDR||this.enablesXDR,timestampRequests:b.timestampRequests||this.timestampRequests,timestampParam:b.timestampParam||this.timestampParam,policyPort:b.policyPort||this.policyPort,pfx:b.pfx||this.pfx,key:b.key||this.key,passphrase:b.passphrase||this.passphrase,
cert:b.cert||this.cert,ca:b.ca||this.ca,ciphers:b.ciphers||this.ciphers,rejectUnauthorized:b.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:b.perMessageDeflate||this.perMessageDeflate,extraHeaders:b.extraHeaders||this.extraHeaders,forceNode:b.forceNode||this.forceNode,localAddress:b.localAddress||this.localAddress,requestTimeout:b.requestTimeout||this.requestTimeout,protocols:b.protocols||void 0})};d.prototype.open=function(){if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var a=
"websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(F){return this.transports.shift(),void this.open()}a.open();this.setTransport(a)};d.prototype.setTransport=function(a){f("setting transport %s",a.name);var b=this;this.transport&&(f("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=
a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};d.prototype.probe=function(a){function b(){if(w.onlyBinaryUpgrades){var b=!this.supportsBinary&&w.transport.supportsBinary;n=n||b}n||(f('probe transport "%s" opened',a),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(b){if(!n)if("pong"===b.type&&"probe"===b.data){if(f('probe transport "%s" pong',a),w.upgrading=!0,
w.emit("upgrading",t),t)d.priorWebsocketSuccess="websocket"===t.name,f('pausing current transport "%s"',w.transport.name),w.transport.pause(function(){n||"closed"!==w.readyState&&(f("changing transport and sending upgrade packet"),m(),w.setTransport(t),t.send([{type:"upgrade"}]),w.emit("upgrade",t),t=null,w.upgrading=!1,w.flush())})}else f('probe transport "%s" failed',a),b=Error("probe error"),b.transport=t.name,w.emit("upgradeError",b)}))}function c(){n||(n=!0,m(),t.close(),t=null)}function k(b){var d=
Error("probe error: "+b);d.transport=t.name;c();f('probe transport "%s" failed because of error: %s',a,b);w.emit("upgradeError",d)}function e(){k("transport closed")}function l(){k("socket closed")}function h(a){t&&a.name!==t.name&&(f('"%s" works - aborting "%s"',a.name,t.name),c())}function m(){t.removeListener("open",b);t.removeListener("error",k);t.removeListener("close",e);w.removeListener("close",l);w.removeListener("upgrading",h)}f('probing transport "%s"',a);var t=this.createTransport(a,{probe:1}),
n=!1,w=this;d.priorWebsocketSuccess=!1;t.once("open",b);t.once("error",k);t.once("close",e);this.once("close",l);this.once("upgrading",h);t.open()};d.prototype.onOpen=function(){if(f("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){f("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}};d.prototype.onPacket=function(a){if("opening"===
this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(f('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(w(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",a.data),this.emit("message",a.data)}else f('packet received with socket readyState "%s"',this.readyState)};d.prototype.onHandshake=
function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},
a||b.pingInterval+b.pingTimeout)};d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){f("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};d.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):
this.flush()};d.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(f("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};d.prototype.write=d.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};d.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=
c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)c=c||{},c.compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),d&&this.once("flush",d),this.flush()};d.prototype.close=function(){function a(){d.onClose("forced close");f("socket closing - telling transport to close");d.transport.close()}function b(){d.removeListener("upgrade",b);d.removeListener("upgradeError",b);a()}function c(){d.once("upgrade",b);d.once("upgradeError",b)}if("opening"===
this.readyState||"open"===this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};d.prototype.onError=function(a){f("socket error %j",a);d.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",a)};d.prototype.onClose=function(a,b){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)f('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),
clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0};d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~h(this.transports,a[c])&&b.push(a[c]);return b}}).call(a,function(){return this}())},function(b,a,c){(function(b){var d=c(18),e=c(20),n=c(34),f=c(35);a.polling=function(a){var c,f=!1,h=
!1,t=!1!==a.jsonp;b.location&&(h="https:"===location.protocol,(f=location.port)||(f=h?443:80),f=a.hostname!==location.hostname||f!==a.port,h=a.secure!==h);if(a.xdomain=f,a.xscheme=h,c=new d(a),"open"in c&&!a.forceJSONP)return new e(a);if(!t)throw Error("JSONP disabled");return new n(a)};a.websocket=f}).call(a,function(){return this}())},function(b,a,c){(function(a){var d=c(19);b.exports=function(b){var c=b.xdomain,f=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!c||d))return new XMLHttpRequest}catch(h){}try{if("undefined"!=
typeof XDomainRequest&&!f&&b)return new XDomainRequest}catch(h){}if(!c)try{return new (a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(h){}}}).call(a,function(){return this}())},function(b,a){try{b.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(c){b.exports=!1}},function(b,a,c){(function(a){function d(){}function e(b){if(l.call(this,b),this.requestTimeout=b.requestTimeout,this.extraHeaders=b.extraHeaders,a.location){var c="https:"===location.protocol,
d=location.port;d||(d=c?443:80);this.xd=b.hostname!==a.location.hostname||d!==b.port;this.xs=b.secure!==c}}function n(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=
a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function f(){for(var a in n.requests)n.requests.hasOwnProperty(a)&&n.requests[a].abort()}var h=c(18),l=c(21),r=c(8),w=c(32),t=c(3)("engine.io-client:polling-xhr");b.exports=e;b.exports.Request=n;w(e,l);e.prototype.supportsBinary=!0;e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,
a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new n(a)};e.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};e.prototype.doPoll=function(){t("xhr poll");var a=
this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};r(n.prototype);n.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var c=this.xhr=new h(b),d=this;try{t("xhr open %s: %s",this.method,this.uri);c.open(this.method,
this.uri,this.async);try{if(this.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(var f in this.extraHeaders)this.extraHeaders.hasOwnProperty(f)&&c.setRequestHeader(f,this.extraHeaders[f])}}catch(B){}if("POST"===this.method)try{this.isBinary?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8")}catch(B){}try{c.setRequestHeader("Accept","*/*")}catch(B){}"withCredentials"in c&&(c.withCredentials=!0);this.requestTimeout&&
(c.timeout=this.requestTimeout);this.hasXDR()?(c.onload=function(){d.onLoad()},c.onerror=function(){d.onError(c.responseText)}):c.onreadystatechange=function(){if(2===c.readyState){try{var a=c.getResponseHeader("Content-Type")}catch(G){}"application/octet-stream"===a&&(c.responseType="arraybuffer")}4===c.readyState&&(200===c.status||1223===c.status?d.onLoad():setTimeout(function(){d.onError(c.status)},0))};t("xhr data %s",this.data);c.send(this.data)}catch(B){return void setTimeout(function(){d.onError(B)},
0)}a.document&&(this.index=n.requestsCount++,n.requests[this.index]=this)};n.prototype.onSuccess=function(){this.emit("success");this.cleanup()};n.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};n.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};n.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,b)try{this.xhr.abort()}catch(u){}a.document&&delete n.requests[this.index];
this.xhr=null}};n.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(F){}var b="application/octet-stream"===a?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(F){this.onError(F)}null!=b&&this.onData(b)};n.prototype.hasXDR=function(){return"undefined"!=typeof a.XDomainRequest&&!this.xs&&this.enablesXDR};n.prototype.abort=function(){this.cleanup()};n.requestsCount=0;n.requests={};a.document&&(a.attachEvent?a.attachEvent("onunload",f):a.addEventListener&&
a.addEventListener("beforeunload",f,!1))}).call(a,function(){return this}())},function(b,a,c){function e(a){var b=a&&a.forceBase64;l&&!b||(this.supportsBinary=!1);d.call(this,a)}var d=c(22),m=c(31),n=c(23);a=c(32);var f=c(33),h=c(3)("engine.io-client:polling");b.exports=e;var l=null!=(new (c(18))({xdomain:!1})).responseType;a(e,d);e.prototype.name="polling";e.prototype.doOpen=function(){this.poll()};e.prototype.pause=function(a){function b(){h("paused");c.readyState="paused";a()}var c=this;if(this.readyState=
"pausing",this.polling||!this.writable){var d=0;this.polling&&(h("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){h("pre-pause polling complete");--d||b()}));this.writable||(h("we are currently writing - waiting to pause"),d++,this.once("drain",function(){h("pre-pause writing complete");--d||b()}))}else b()};e.prototype.poll=function(){h("polling");this.polling=!0;this.doPoll();this.emit("poll")};e.prototype.onData=function(a){var b=this;h("polling got data %s",
a);n.decodePayload(a,this.socket.binaryType,function(a,c,d){return"opening"===b.readyState&&b.onOpen(),"close"===a.type?(b.onClose(),!1):void b.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():h('ignoring poll - transport state "%s"',this.readyState))};e.prototype.doClose=function(){function a(){h("writing close packet");b.write([{type:"close"}])}var b=this;"open"===this.readyState?(h("transport open - closing"),a()):(h("transport not open - deferring close"),
this.once("open",a))};e.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0;b.emit("drain")};n.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})};e.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=f());this.supportsBinary||a.sid||(a.b64=1);a=m.encode(a);this.port&&("https"===b&&443!==Number(this.port)||"http"===b&&80!==Number(this.port))&&(c=":"+this.port);a.length&&
(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a}},function(b,a,c){function e(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=
a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var d=c(23);a=c(8);b.exports=e;a(e.prototype);e.prototype.onError=function(a,b){a=Error(a);return a.type="TransportError",a.description=b,this.emit("error",a),this};e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};e.prototype.close=function(){return"opening"!==
this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};e.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};e.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};e.prototype.onData=function(a){a=d.decodePacket(a,this.socket.binaryType);this.onPacket(a)};e.prototype.onPacket=function(a){this.emit("packet",a)};e.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},
function(b,a,c){(function(b){function d(b,c,d){if(!c)return a.encodeBase64Packet(b,d);var f=new FileReader;return f.onload=function(){b.data=f.result;a.encodePacket(b,c,!0,d)},f.readAsArrayBuffer(b.data)}function e(a,b,c){var d=Array(a.length);c=r(a.length,c);for(var f=function(a,c,f){b(c,function(b,c){d[a]=c;f(b,d)})},e=0;e<a.length;e++)f(e,a[e],c)}var n,f=c(24),h=c(9),l=c(25),r=c(26),w=c(27);b&&b.ArrayBuffer&&(n=c(29));var t="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),k=
"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=t||k;a.protocol=3;var F=a.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},P=f(F),B={type:"error",data:"parser error"},G=c(30);a.encodePacket=function(c,f,e,k){"function"==typeof f&&(k=f,f=!1);"function"==typeof e&&(k=e,e=null);var l=void 0===c.data?void 0:c.data.buffer||c.data;if(b.ArrayBuffer&&l instanceof ArrayBuffer){if(f){e=c.data;f=new Uint8Array(e);e=new Uint8Array(1+e.byteLength);e[0]=F[c.type];for(c=
0;c<f.length;c++)e[c+1]=f[c];c=k(e.buffer)}else c=a.encodeBase64Packet(c,k);return c}if(G&&l instanceof b.Blob)return f?u?c=d(c,f,k):(f=new Uint8Array(1),f[0]=F[c.type],c=new G([f.buffer,c.data]),c=k(c)):c=a.encodeBase64Packet(c,k),c;if(l&&l.base64)return k("b"+a.packets[c.type]+c.data.data);f=F[c.type];return void 0!==c.data&&(f+=e?w.encode(String(c.data),{strict:!1}):String(c.data)),k(""+f)};a.encodeBase64Packet=function(c,d){var f="b"+a.packets[c.type];if(G&&c.data instanceof b.Blob){var e=new FileReader;
return e.onload=function(){var a=e.result.split(",")[1];d(f+a)},e.readAsDataURL(c.data)}try{var k=String.fromCharCode.apply(null,new Uint8Array(c.data))}catch(pb){c=new Uint8Array(c.data);k=Array(c.length);for(var l=0;l<c.length;l++)k[l]=c[l];k=String.fromCharCode.apply(null,k)}return f+=b.btoa(k),d(f)};a.decodePacket=function(b,c,d){if(void 0===b)return B;if("string"==typeof b){if("b"===b.charAt(0))return a.decodeBase64Packet(b.substr(1),c);if(c=d){c=b;try{c=w.decode(c,{strict:!1})}catch(ca){c=!1}c=
(b=c,!1===b)}if(c)return B;d=b.charAt(0);return Number(d)==d&&P[d]?1<b.length?{type:P[d],data:b.substring(1)}:{type:P[d]}:B}d=(new Uint8Array(b))[0];b=l(b,1);return G&&"blob"===c&&(b=new G([b])),{type:P[d],data:b}};a.decodeBase64Packet=function(a,b){var c=P[a.charAt(0)];if(!n)return{type:c,data:{base64:!0,data:a.substr(1)}};a=n.decode(a.substr(1));return"blob"===b&&G&&(a=new G([a])),{type:c,data:a}};a.encodePayload=function(b,c,d){function f(b,d){a.encodePacket(b,!!k&&c,!1,function(a){d(null,a.length+
":"+a)})}"function"==typeof c&&(d=c,c=null);var k=h(b);return c&&k?G&&!u?a.encodePayloadAsBlob(b,d):a.encodePayloadAsArrayBuffer(b,d):b.length?void e(b,f,function(a,b){return d(b.join(""))}):d("0:")};a.decodePayload=function(b,c,d){if("string"!=typeof b)return a.decodePayloadAsBinary(b,c,d);"function"==typeof c&&(d=c,c=null);var f;if(""===b)return d(B,0,1);for(var e,k,l="",h=0,t=b.length;h<t;h++){var u=b.charAt(h);if(":"===u){if(""===l||l!=(e=Number(l))||(k=b.substr(h+1,e),l!=k.length))return d(B,
0,1);if(k.length){if(f=a.decodePacket(k,c,!1),B.type===f.type&&B.data===f.data)return d(B,0,1);if(!1===d(f,h+e,t))return}h+=e;l=""}else l+=u}return""!==l?d(B,0,1):void 0};a.encodePayloadAsArrayBuffer=function(b,c){function d(b,c){a.encodePacket(b,!0,!0,function(a){return c(null,a)})}return b.length?void e(b,d,function(a,b){a=b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var d=new Uint8Array(a),f=0;return b.forEach(function(a){var b="string"==
typeof a,c=a;if(b){c=new Uint8Array(a.length);for(var e=0;e<a.length;e++)c[e]=a.charCodeAt(e);c=c.buffer}b?d[f++]=0:d[f++]=1;a=c.byteLength.toString();for(e=0;e<a.length;e++)d[f++]=parseInt(a[e]);d[f++]=255;c=new Uint8Array(c);for(e=0;e<c.length;e++)d[f++]=c[e]}),c(d.buffer)}):c(new ArrayBuffer(0))};a.encodePayloadAsBlob=function(b,c){e(b,function(b,c){a.encodePacket(b,!0,!0,function(a){var b=new Uint8Array(1);if(b[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),f=0;f<a.length;f++)d[f]=
a.charCodeAt(f);a=d.buffer;b[0]=0}d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString();var e=new Uint8Array(d.length+1);for(f=0;f<d.length;f++)e[f]=parseInt(d[f]);if(e[d.length]=255,G)a=new G([b.buffer,e.buffer,a]),c(null,a)})},function(a,b){return c(new G(b))})};a.decodePayloadAsBinary=function(b,c,d){"function"==typeof c&&(d=c,c=null);for(var f=[];0<b.byteLength;){for(var e=new Uint8Array(b),k=0===e[0],h="",t=1;255!==e[t];t++){if(310<h.length)return d(B,0,1);h+=e[t]}b=l(b,2+h.length);h=parseInt(h);
e=l(b,0,h);if(k)try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(Pa){for(k=new Uint8Array(e),e="",t=0;t<k.length;t++)e+=String.fromCharCode(k[t])}f.push(e);b=l(b,h)}var u=f.length;f.forEach(function(b,f){d(a.decodePacket(b,c,!0),f,u)})}}).call(a,function(){return this}())},function(b,a){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty,m;for(m in a)c.call(a,m)&&b.push(m);return b}},function(b,a){b.exports=function(a,b,d){var c=a.byteLength;if(b=b||0,d=d||c,
a.slice)return a.slice(b,d);if(0>b&&(b+=c),0>d&&(d+=c),d>c&&(d=c),b>=c||b>=d||0===c)return new ArrayBuffer(0);a=new Uint8Array(a);c=new Uint8Array(d-b);for(var e=0;b<d;b++,e++)c[e]=a[b];return c.buffer}},function(b,a){function c(){}b.exports=function(a,b,m){function d(a,c){if(0>=d.count)throw Error("after called too many times");--d.count;a?(f=!0,b(a),b=m):0!==d.count||f||b(null,c)}var f=!1;return m=m||c,d.count=a,0===a?b():d}},function(b,a,c){var e;(function(b,c){!function(c){function d(a){for(var b,
c,d=[],f=0,e=a.length;f<e;)b=a.charCodeAt(f++),55296<=b&&56319>=b&&f<e?(c=a.charCodeAt(f++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),f--)):d.push(b);return d}function h(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function l(){if(k>=t)throw Error("Invalid byte index");var a=255&m[k];if(k++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function n(a){var b,c,d,f,
e;if(k>t)throw Error("Invalid byte index");if(k==t)return!1;if(b=255&m[k],k++,0==(128&b))return b;if(192==(224&b)){if(c=l(),e=(31&b)<<6|c,128<=e)return e;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=l(),d=l(),e=(15&b)<<12|c<<6|d,2048<=e)return h(e,a)?e:65533;throw Error("Invalid continuation byte");}if(240==(248&b)&&(c=l(),d=l(),f=l(),e=(7&b)<<18|c<<12|d<<6|f,65536<=e&&1114111>=e))return e;throw Error("Invalid UTF-8 detected");}c="object"==typeof a&&a;"object"==typeof b&&b&&b.exports==
c&&b;var m,t,k,u=String.fromCharCode;e={version:"2.1.2",encode:function(a,b){b=b||{};b=!1!==b.strict;a=d(a);for(var c=a.length,f=-1,e="";++f<c;){var k=a[f];var l=b;if(0==(4294967168&k))l=u(k);else{var t="";l=(0==(4294965248&k)?t=u(k>>6&31|192):0==(4294901760&k)?(h(k,l)||(k=65533),t=u(k>>12&15|224),t+=u(k>>6&63|128)):0==(4292870144&k)&&(t=u(k>>18&7|240),t+=u(k>>12&63|128),t+=u(k>>6&63|128)),t+u(63&k|128))}e+=l}return e},decode:function(a,b){b=b||{};b=!1!==b.strict;m=d(a);t=m.length;k=0;var c;for(a=
[];!1!==(c=n(b));)a.push(c);c=a.length;for(var f=-1,e="";++f<c;)b=a[f],65535<b&&(b-=65536,e+=u(b>>>10&1023|55296),b=56320|1023&b),e+=u(b);return e}};!(void 0!==e&&(b.exports=e))}(this)}).call(a,c(28)(b),function(){return this}())},function(b,a){b.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(b,a){!function(){for(var b=new Uint8Array(256),e=0;64>e;e++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=
e;a.encode=function(a){var b=new Uint8Array(a),c=b.length,d="";for(a=0;a<c;a+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[a]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&b[a])<<4|b[a+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&b[a+1])<<2|b[a+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&b[a+2]];return 2===c%3?d=d.substring(0,d.length-1)+"\x3d":1===c%3&&(d=d.substring(0,
d.length-2)+"\x3d\x3d"),d};a.decode=function(a){var c=.75*a.length;var d=a.length,f=0;"\x3d"===a[a.length-1]&&(c--,"\x3d"===a[a.length-2]&&c--);var e=new ArrayBuffer(c),l=new Uint8Array(e);for(c=0;c<d;c+=4){var r=b[a.charCodeAt(c)];var w=b[a.charCodeAt(c+1)];var t=b[a.charCodeAt(c+2)];var k=b[a.charCodeAt(c+3)];l[f++]=r<<2|w>>4;l[f++]=(15&w)<<4|t>>2;l[f++]=(3&t)<<6|63&k}return e}}()},function(b,a){(function(a){function c(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=
c.buffer;if(c.byteLength!==d.byteLength){var f=new Uint8Array(c.byteLength);f.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=f.buffer}a[b]=d}}}function d(a,b){b=b||{};var d=new n;c(a);for(var f=0;f<a.length;f++)d.append(a[f]);return b.type?d.getBlob(b.type):d.getBlob()}function m(a,b){return c(a),new Blob(a,b||{})}var n=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder;try{var f=2===(new Blob(["hi"])).size}catch(r){f=!1}var h;if(h=f)try{h=2===(new Blob([new Uint8Array([1,2])])).size}catch(r){h=
!1}var l=n&&n.prototype.append&&n.prototype.getBlob;b.exports=f?h?a.Blob:m:l?d:void 0}).call(a,function(){return this}())},function(b,a){a.encode=function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b.length&&(b+="\x26"),b+=encodeURIComponent(c)+"\x3d"+encodeURIComponent(a[c]));return b};a.decode=function(a){var b={};a=a.split("\x26");for(var c=0,m=a.length;c<m;c++){var n=a[c].split("\x3d");b[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return b}},function(b,a){b.exports=function(a,b){var c=
function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}},function(b,a){function c(a){var b="";do b=m[a%n]+b,a=Math.floor(a/n);while(0<a);return b}function e(){var a=c(+new Date);return a!==d?(h=0,d=a):a+"."+c(h++)}for(var d,m="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),n=64,f={},h=0,l=0;l<n;l++)f[m[l]]=l;e.encode=c;e.decode=function(a){var b=0;for(l=0;l<a.length;l++)b=b*n+f[a.charAt(l)];return b};b.exports=e},function(b,a,c){(function(a){function d(){}
function e(b){n.call(this,b);this.query=this.query||{};h||(a.___eio||(a.___eio=[]),h=a.___eio);this.index=h.length;var c=this;h.push(function(a){c.onData(a)});this.query.j=this.index;a.document&&a.addEventListener&&a.addEventListener("beforeunload",function(){c.script&&(c.script.onerror=d)},!1)}var n=c(21),f=c(32);b.exports=e;var h,l=/\n/g,r=/\\n/g;f(e,n);e.prototype.supportsBinary=!1;e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&
(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);n.prototype.doClose.call(this)};e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=
typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};e.prototype.doWrite=function(a,b){function c(){d();b()}function d(){if(f.iframe)try{f.form.removeChild(f.iframe)}catch(J){f.onError("jsonp polling iframe removal error",J)}try{e=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+f.iframeId+'"\x3e')}catch(J){e=document.createElement("iframe"),e.name=f.iframeId,
e.src="javascript:0"}e.id=f.iframeId;f.form.appendChild(e);f.iframe=e}var f=this;if(!this.form){var e,h=document.createElement("form"),t=document.createElement("textarea"),n=this.iframeId="eio_iframe_"+this.index;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=n;h.method="POST";h.setAttribute("accept-charset","utf-8");t.name="d";h.appendChild(t);document.body.appendChild(h);this.form=h;this.area=t}this.form.action=this.uri();d();a=a.replace(r,
"\\\n");this.area.value=a.replace(l,"\\n");try{this.form.submit()}catch(J){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===f.iframe.readyState&&c()}:this.iframe.onload=c}}).call(a,function(){return this}())},function(b,a,c){(function(a){function d(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;this.usingBrowserWebSocket=w&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(k=t);e.call(this,a)}var e=c(22),n=
c(23),f=c(31),h=c(32),l=c(33),r=c(3)("engine.io-client:websocket"),w=a.WebSocket||a.MozWebSocket;if("undefined"==typeof window)try{var t=c(36)}catch(u){}var k=w;k||"undefined"!=typeof window||(k=t);b.exports=d;h(d,e);d.prototype.name="websocket";d.prototype.supportsBinary=!0;d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;
c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new k(a,b):new k(a):new k(a,b,c)}catch(B){return this.emit("error",B)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};d.prototype.addEventListeners=
function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};d.prototype.write=function(b){function c(){d.emit("flush");setTimeout(function(){d.writable=!0;d.emit("drain")},0)}var d=this;this.writable=!1;for(var f=b.length,e=0,k=f;e<k;e++)!function(b){n.encodePacket(b,d.supportsBinary,function(e){if(!d.usingBrowserWebSocket){var k={};(b.options&&(k.compress=
b.options.compress),d.perMessageDeflate)&&("string"==typeof e?a.Buffer.byteLength(e):e.length)<d.perMessageDeflate.threshold&&(k.compress=!1)}try{d.usingBrowserWebSocket?d.ws.send(e):d.ws.send(e,k)}catch(K){r("websocket closed before onclose event")}--f||c()})}(b[e])};d.prototype.onClose=function(){e.prototype.onClose.call(this)};d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===
b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=l());this.supportsBinary||(a.b64=1);a=f.encode(a);a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a};d.prototype.check=function(){return!(!k||"__initialize"in k&&this.name===d.prototype.name)}}).call(a,function(){return this}())},function(b,a){},function(b,a){var c=[].indexOf;b.exports=function(a,
b){if(c)return a.indexOf(b);for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}},function(b,a){(function(a){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,m=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,n=/(?:^|:|,)(?:\s*\[)+/g,f=/^\s+/,h=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(f,"").replace(h,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(d,"@").replace(m,"]").replace(n,""))?(new Function("return "+b))():void 0):null}}).call(a,
function(){return this}())},function(b,a,c){function e(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},m=c(7);a=c(8);var n=c(40),
f=c(41),h=c(42),l=c(3)("socket.io-client:socket"),r=c(31);b.exports=e;var w={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},t=a.prototype.emit;a(e.prototype);e.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[f(a,"open",h(this,"onopen")),f(a,"packet",h(this,"onpacket")),f(a,"close",h(this,"onclose"))]}};e.prototype.open=e.prototype.connect=function(){return this.connected?
this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};e.prototype.send=function(){var a=n(arguments);return a.unshift("message"),this.emit.apply(this,a),this};e.prototype.emit=function(a){if(w.hasOwnProperty(a))return t.apply(this,arguments),this;var b=n(arguments),c={type:m.EVENT,data:b};return c.options={},c.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(l("emitting packet with ack id %d",this.ids),
this.acks[this.ids]=b.pop(),c.id=this.ids++),this.connected?this.packet(c):this.sendBuffer.push(c),delete this.flags,this};e.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};e.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var a="object"===d(this.query)?r.encode(this.query):this.query;l("sending connect packet with query %s",a);this.packet({type:m.CONNECT,query:a})}else this.packet({type:m.CONNECT})};e.prototype.onclose=function(a){l("close (%s)",
a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};e.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case m.CONNECT:this.onconnect();break;case m.EVENT:this.onevent(a);break;case m.BINARY_EVENT:this.onevent(a);break;case m.ACK:this.onack(a);break;case m.BINARY_ACK:this.onack(a);break;case m.DISCONNECT:this.ondisconnect();break;case m.ERROR:this.emit("error",a.data)}};e.prototype.onevent=function(a){var b=a.data||[];l("emitting event %j",b);null!=
a.id&&(l("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?t.apply(this,b):this.receiveBuffer.push(b)};e.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=n(arguments);l("sending ack %j",d);b.packet({type:m.ACK,id:a,data:d})}}};e.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(l("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):l("bad ack %s",a.id)};e.prototype.onconnect=function(){this.connected=
!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};e.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)t.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};e.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};e.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();
this.subs=null}this.io.destroy(this)};e.prototype.close=e.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:m.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};e.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},function(b,a){b.exports=function(a,b){for(var c=[],e=(b=b||0)||0;e<a.length;e++)c[e-b]=a[e];return c}},function(b,a){b.exports=function(a,b,d){return a.on(b,
d),{destroy:function(){a.removeListener(b,d)}}}},function(b,a){var c=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw Error("bind() requires a function");var d=c.call(arguments,2);return function(){return b.apply(a,d.concat(c.call(arguments)))}}},function(b,a){function c(a){a=a||{};this.ms=a.min||100;this.max=a.max||1E4;this.factor=a.factor||2;this.jitter=0<a.jitter&&1>=a.jitter?a.jitter:0;this.attempts=0}b.exports=c;c.prototype.duration=function(){var a=
this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)};c.prototype.reset=function(){this.attempts=0};c.prototype.setMin=function(a){this.ms=a};c.prototype.setMax=function(a){this.max=a};c.prototype.setJitter=function(a){this.jitter=a}}])});window.TK=window.TK||{};
TK.EventDispatcher=function(b){var a={};b=b||{};b.dispatcher={};b.dispatcher.eventListeners={};b.dispatcher.backupListerners={};a.addEventListener=function(a,e,d){void 0!==a&&null!==a&&(void 0===b.dispatcher.eventListeners[a]&&(b.dispatcher.eventListeners[a]=[]),b.dispatcher.eventListeners[a].push(e),d&&(void 0===b.dispatcher.backupListerners[d]&&(b.dispatcher.backupListerners[d]=[]),b.dispatcher.backupListerners[d].push({eventType:a,listener:e})))};a.removeEventListener=function(a,e){b.dispatcher.eventListeners[a]?
(e=b.dispatcher.eventListeners[a].indexOf(e),-1!==e&&b.dispatcher.eventListeners[a].splice(e,1)):L.Logger.info("[tk-sdk]not event type: "+a)};a.removeAllEventListener=function(c){if(c&&"object"===typeof c&&"number"===typeof c.length&&"function"===typeof c.splice&&!c.propertyIsEnumerable("length"))for(var e in c){var d=c[e];delete b.dispatcher.eventListeners[d]}else if("string"===typeof c)delete b.dispatcher.eventListeners[c];else if("object"===typeof c)for(var m in c)d=m,a.removeEventListener(d,c[m])};
a.dispatchEvent=function(a,e){var c;(void 0!=e?e:1)&&L.Logger.debug("sdk-dispatchEvent , event type: "+a.type);for(c in b.dispatcher.eventListeners[a.type])if(b.dispatcher.eventListeners[a.type].hasOwnProperty(c))b.dispatcher.eventListeners[a.type][c](a)};a.removeBackupListerner=function(c){if(c&&b.dispatcher.backupListerners[c]){for(var e=0;e<b.dispatcher.backupListerners[c].length;e++){var d=b.dispatcher.backupListerners[c][e];a.removeEventListener(d.eventType,d.listener)}b.dispatcher.backupListerners[c].length=
0;delete b.dispatcher.backupListerners[c]}};return a};TK.TalkEvent=function(b){var a={};a.type=b.type;a.data=b.data;return a};TK.RoomEvent=function(b,a){var c=TK.TalkEvent(b);c.streams=b.streams;c.message=b.message;c.user=b.user;c.userid=b.user?b.user.id:void 0;if(a&&"object"===typeof a)for(var e in a)c[e]=a[e];return c};
TK.StreamEvent=function(b,a){var c=TK.TalkEvent(b);c.stream=b.stream;c.message=b.message;c.bandwidth=b.bandwidth;c.attrs=b.attrs;c.userid=b.stream&&b.stream.extensionId&&b.stream.getAttributes&&b.stream.getAttributes()&&b.stream.getAttributes().type?b.stream.extensionId.replace(new RegExp(":"+b.stream.getAttributes().type,"g"),""):void 0;c.streamType=b.stream&&b.stream.extensionId&&b.stream.getAttributes&&b.stream.getAttributes()&&b.stream.getAttributes().type?b.stream.getAttributes().type:void 0;
c.streamInfo={audio:b.stream&&b.stream.hasAudio?b.stream.hasAudio():!1,video:b.stream&&b.stream.hasVideo?b.stream.hasVideo():!1,attributes:b.stream&&b.stream.getAttributes?b.stream.getAttributes():{}};if(a&&"object"===typeof a)for(var e in a)c[e]=a[e];return c};TK.PublisherEvent=function(b,a){b=TK.TalkEvent(b);if(a&&"object"===typeof a)for(var c in a)b[c]=a[c];return b};TK.coreEventController=TK.EventDispatcher({});window.TK=window.TK||{};
TK.FcStack=function(b){var a={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0};window.L=window.L||{};a.close=function(){L.Logger.debug("[tk-sdk]Close FcStack")};a.createOffer=function(){L.Logger.debug("[tk-sdk]FCSTACK: CreateOffer")};a.addStream=function(a){L.Logger.debug("[tk-sdk]FCSTACK: addStream",a)};a.removeStream=function(a){L.Logger.debug("[tk-sdk]FCSTACK: removeStream",a)};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]FCSTACK: processSignaling",b);void 0!==a.signalCallback&&
a.signalCallback(b)};a.sendSignalingMessage=function(a){L.Logger.debug("[tk-sdk]FCSTACK: Sending signaling Message",a);b.callback(a)};a.setSignalingCallback=function(b){L.Logger.debug("[tk-sdk]FCSTACK: Setting signalling callback");a.signalCallback=b};return a};window.TK=window.TK||{};
TK.FirefoxStack=function(b){var a={},c=mozRTCPeerConnection,e=mozRTCSessionDescription,d=mozRTCIceCandidate;a.pcConfig={iceServers:[]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,mozDontOfferDataChannel:!0};var m=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)},n=function(){b.video&&b.simulcast&&a.peerConnection.getSenders().forEach(function(a){"video"===a.track.kind&&
(a.getParameters(),a.setParameters({encodings:[{rid:"spam",active:!0,priority:"high",maxBitrate:4E4,maxHeight:640,maxWidth:480},{rid:"egg",active:!0,priority:"medium",maxBitrate:1E4,maxHeight:320,maxWidth:240}]}))})},f=!1;a.peerConnection=new c(a.pcConfig,a.con);b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(f=!0,a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a=a.candidate,b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.debug("[tk-sdk]Local Candidates stored: ",b.localCandidates.length,b.localCandidates))):L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate")};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};
var h=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},l=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);
null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a},r,w=function(a){a.sdp=l(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(a);r=a},t=function(c){c.sdp=l(c.sdp);c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(c);(r=c)?
a.peerConnection.setLocalDescription(r):L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=function(a){if(a.maxVideoBW||a.maxAudioBW){a.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested",a.maxVideoBW,"limit",b.limitMaxVideoBW),a.maxVideoBW>b.limitMaxVideoBW&&(a.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=a.maxVideoBW);a.maxAudioBW&&(a.maxAudioBW>b.limitMaxAudioBW&&(a.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=a.maxAudioBW);if(!r){L.Logger.error("[tk-sdk]localDesc is not exist!");
return}r.sdp=l(r.sdp);a.Sdp?L.Logger.error("[tk-sdk]Cannot update with renegotiation in Firefox, try without renegotiation"):(L.Logger.debug("[tk-sdk]Updating without renegotiation, newVideoBW:",b.maxVideoBW,", newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:r.sdp}))}if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",a.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",a.slideShowMode),
L.Logger.debug("[tk-sdk]muteStream changed to ",a.muteStream),b.callback({type:"updatestream",config:a})};a.createOffer=function(b){!0!==b&&(n(),a.mediaConstraints={offerToReceiveAudio:!1,offerToReceiveVideo:!1,mozDontOfferDataChannel:!0});a.peerConnection.createOffer(w,m,a.mediaConstraints)};a.addStream=function(b){a.peerConnection.addStream(b)};a.removeStream=function(b){a.peerConnection.removeStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.close=function(){try{a&&a.peerConnection&&
"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(k){L.Logger.error("[tk-sdk]peerConnection close error:",k)}};a.processSignalingMessage=function(c){if("offer"===c.type)c.sdp=l(c.sdp),TK.isHiFi&&(c.sdp=h(c.sdp)),a.peerConnection.setRemoteDescription(new e(c),function(){a.peerConnection.createAnswer(t,function(a){L.Logger.error("[tk-sdk]Error",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",
a)});else if("answer"===c.type)r?(TK.isHiFi&&(c.sdp=h(c.sdp)),L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Local Description to set",r.sdp),L.Logger.debug("[tk-sdk]Remote Description to set",c.sdp),c.sdp=l(c.sdp),a.peerConnection.setLocalDescription(r,function(){a.peerConnection.setRemoteDescription(new e(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Remote Description successfully set");0<b.remoteCandidates.length&&f;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),
a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(;0<b.localCandidates.length;)L.Logger.debug("[tk-sdk]Sending Candidate from list"),b.callback({type:"candidate",candidate:b.localCandidates.shift()})},function(a){L.Logger.error("[tk-sdk]Error Setting Remote Description",a)})},function(a){L.Logger.error("[tk-sdk]Failure setting Local Description",a)})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===c.type)try{var k="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);
k.candidate=k.candidate.replace(/ generation 0/g,"");k.candidate=k.candidate.replace(/ udp /g," UDP ");k.sdpMLineIndex=parseInt(k.sdpMLineIndex);var n=new d(k);if(b.remoteDescriptionSet&&f)for(a.peerConnection.addIceCandidate(n);0<b.remoteCandidates.length;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),a.peerConnection.addIceCandidate(b.remoteCandidates.shift());else b.remoteCandidates.push(n)}catch(P){L.Logger.error("[tk-sdk]Error parsing candidate",c.candidate,P)}};return a};window.TK=window.TK||{};
window.TkWebkitRTCPeerConnection=function(b,a){b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy);b=new webkitRTCPeerConnection(b,a);var c=b.getStats.bind(b);b.getStats=function(a,b,m){var d=arguments;if(0<arguments.length&&"function"===typeof a)return c(a,b);var f=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:(new Date(a.timestamp)).getTime(),type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b};if(2<=arguments.length)return c.apply(this,
[function(a){d[1](f(a))},arguments[0]])};return b};
TK.TkChromeStableStack=function(b){var a={},c=window.TkWebkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var e=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)};a.peerConnection=new c(a.pcConfig,a.con);var d=function(a){var b="a\x3dssrc-group:SIM";
a.forEach(function(a){b+=" "+a});return b+"\r\n"},m=function(a){if(!b.video||!b.simulcast)return a;var c=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!c||0>=c.length)return a;var f=b.simulcast.numSpatialLayers||2;var e=parseInt(c[1]),l=parseInt(c[2]),h=a.match(new RegExp("a\x3dssrc:"+c[1]+" cname:(.*)\r?\n"))[1],t=a.match(new RegExp("a\x3dssrc:"+c[1]+" msid:(.*)\r?\n"))[1],n=a.match(new RegExp("a\x3dssrc:"+c[1]+" mslabel:(.*)\r?\n"))[1],m=a.match(new RegExp("a\x3dssrc:"+c[1]+" label:(.*)\r?\n"))[1];
a.match(new RegExp("a\x3dssrc:"+c[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+c[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var w=[e],r=[l],K=1;K<f;K++)w.push(e+1E3*K),r.push(l+1E3*K);f=d(w);for(var W in w)e=w[W],l=r[W],f+="a\x3dssrc-group:FID "+e+" "+l+"\r\n";for(W in w)e=w[W],l=r[W],f+="a\x3dssrc:"+e+" cname:"+h+"\r\na\x3dssrc:"+e+" msid:"+t+"\r\na\x3dssrc:"+e+" mslabel:"+n+"\r\na\x3dssrc:"+e+" label:"+m+"\r\na\x3dssrc:"+l+" cname:"+
h+"\r\na\x3dssrc:"+l+" msid:"+t+"\r\na\x3dssrc:"+l+" mslabel:"+n+"\r\na\x3dssrc:"+l+" label:"+m+"\r\n";return a.replace(c[0],f+"a\x3dx-google-flag:conference\r\n")},n=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";
a=a.replace(b[0],c)}}return a},f=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&
a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(t){L.Logger.error("[tk-sdk]peerConnection close error:",t)}};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,
sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",candidate:a}):(b.localCandidates.push(a),L.Logger.debug("[tk-sdk]Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};
var h,l,r=function(a,c){a||(c.sdp=m(c.sdp));c.sdp=f(c.sdp);a=c.sdp;var d=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==d&&(a=a.replace(d[0],d[0]+"a\x3drtcp-fb:"+d[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.sdp=c.sdp.replace(/a=rtcp-fb:\d+ transport-cc\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});h=c},w=function(c){c.sdp=f(c.sdp);b.callback({type:c.type,sdp:c.sdp});(h=c)?a.peerConnection.setLocalDescription(c):L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=
function(c,d){if(c.maxVideoBW||c.maxAudioBW){c.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested:",c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=c.maxVideoBW);c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW);if(!h){L.Logger.error("[tk-sdk]localDesc is not exist!");return}h.sdp=f(h.sdp);c.Sdp||c.maxAudioBW?(L.Logger.debug("[tk-sdk]Updating with SDP renegotiation",
b.maxVideoBW,b.maxAudioBW),a.peerConnection.setLocalDescription(h,function(){l.sdp=f(l.sdp);TK.isHiFi&&(l.sdp=n(l.sdp));a.peerConnection.setRemoteDescription(new RTCSessionDescription(l),function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:h.sdp})})},function(a){L.Logger.error("[tk-sdk]Error updating configuration",a);d("error")})):(L.Logger.debug("[tk-sdk]Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",
sdp:h.sdp}))}if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",c.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("[tk-sdk]muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){!0!==b&&(a.mediaConstraints={mandatory:{OfferToReceiveVideo:!1,OfferToReceiveAudio:!1}});a.peerConnection.createOffer(r.bind(null,b),e,a.mediaConstraints)};
a.addStream=function(b){b?a.peerConnection.addStream(b):L.Logger.error("[tk-sdk]chromeStableStack addStream : stream is not exist!")};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.getStats=function(b){if(b&&"function"===typeof b)if(a.peerConnection&&a.peerConnection.getStats)try{a.peerConnection.getStats(void 0,function(a){b(a,void 0)},function(a){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",a);b(void 0,-2)})}catch(k){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",
k),b(void 0,-3)}else b(void 0,-1)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c,d){L.Logger.debug("[tk-sdk]Process Signaling Message ",L.Utils.toJsonStringify(c));if(c.sdp&&"answer"===c.type){var e=c.sdp,k=e.indexOf("udp");if(-1!==k){var m="";d&&(m+="stream sdp info:stream id:"+d.getID()+" , extensionId is "+d.extensionId+", attrs is "+L.Utils.toJsonStringify(d.getAttributes())+". \n");m+="udp info:"+(window.__TkSdkBuild__?L.Utils.encrypt(e.substr(k,58)):e.substr(k,
58));L.Logger.info(m)}}if("offer"===c.type)c.sdp=f(c.sdp),TK.isHiFi&&(c.sdp=n(c.sdp)),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){a.peerConnection.createAnswer(w,function(a){L.Logger.error("[tk-sdk]createAnswer Error: ",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===c.type)h?(TK.isHiFi&&(c.sdp=n(c.sdp)),L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Remote Description",
c.sdp),L.Logger.debug("[tk-sdk]Local Description",h.sdp),c.sdp=f(c.sdp),l=c,a.peerConnection.setLocalDescription(h,function(){a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.debug("[tk-sdk]Local candidates to send:",b.localCandidates.length);0<
b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===c.type)try{var t="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);if("end"!==t.candidate){t.candidate=t.candidate.replace(/a=/g,"");t.sdpMLineIndex=parseInt(t.sdpMLineIndex);var r=new RTCIceCandidate(t);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(r):b.remoteCandidates.push(r)}}catch(Y){L.Logger.error("[tk-sdk]Error parsing candidate",
c.candidate)}};return a};window.TK=window.TK||{};
TK.BowserStack=function(b){var a={},c=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveVideo:b.video,offerToReceiveAudio:b.audio};a.peerConnection=
new c(a.pcConfig,a.con);b.remoteDescriptionSet=!1;var e=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},d=function(a){if(b.maxVideoBW){var c=a.match(/m=video.*\r\n/);
null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(l){L.Logger.error("[tk-sdk]peerConnection close error:",
l)}};b.localCandidates=[];a.peerConnection.onicecandidate=function(c){c.candidate?(c.candidate.candidate.match(/a=/)||(c.candidate.candidate="a\x3d"+c.candidate.candidate),b.remoteDescriptionSet?b.callback({type:"candidate",candidate:c.candidate}):b.localCandidates.push(c.candidate)):L.Logger.debug("End of candidates.",a.peerConnection.localDescription)};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};
var m=function(a){L.Logger.debug("Error in Stack ",a)},n,f=function(c){c.sdp=d(c.sdp);L.Logger.debug("Set local description",c.sdp);(n=c)?a.peerConnection.setLocalDescription(n,function(){L.Logger.debug("The final LocalDesc",a.peerConnection.localDescription);b.callback(a.peerConnection.localDescription)},m):L.Logger.error("[tk-sdk]localDesc is not exist!")},h=function(c){c.sdp=d(c.sdp);b.callback(c);(n=c)?a.peerConnection.setLocalDescription(c):L.Logger.error("[tk-sdk]localDesc is not exist!")};
a.createOffer=function(b){!0===b?a.peerConnection.createOffer(f,m,a.mediaConstraints):a.peerConnection.createOffer(f,m)};a.addStream=function(b){a.peerConnection.addStream(b)};b.remoteCandidates=[];a.processSignalingMessage=function(c){L.Logger.debug("Process Signaling Message",c);if("offer"===c.type)c.sdp=d(c.sdp),TK.isHiFi&&(c.sdp=e(c.sdp)),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c)),a.peerConnection.createAnswer(h,null,a.mediaConstraints),b.remoteDescriptionSet=!0;else if("answer"===
c.type)TK.isHiFi&&(c.sdp=e(c.sdp)),L.Logger.debug("Set remote description",c.sdp),c.sdp=d(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",b.remoteCandidates.length);0<b.remoteCandidates.length;)L.Logger.debug("Candidate :",b.remoteCandidates[b.remoteCandidates.length-1]),a.peerConnection.addIceCandidate(b.remoteCandidates.shift(),function(){},m);for(;0<b.localCandidates.length;)b.callback({type:"candidate",
candidate:b.localCandidates.shift()})},function(){L.Logger.warning("Error Setting Remote Description")});else if("candidate"===c.type){L.Logger.debug("Message with candidate");try{var f="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);f.candidate=f.candidate.replace(/a=/g,"");f.sdpMLineIndex=parseInt(f.sdpMLineIndex);f.sdpMLineIndex="audio"===f.sdpMid?0:1;var l=new RTCIceCandidate(f);L.Logger.debug("Remote Candidate",l);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(l,
function(){},m):b.remoteCandidates.push(l)}catch(t){L.Logger.error("[tk-sdk]Error parsing candidate",c.candidate)}}};return a};window.TK=window.TK||{};
TK.ChromeCanaryStack=function(b){var a={},c=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new c(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("[tk-sdk]PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]State: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var e=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=
a.replace(c[0],d)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d));return a};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+a.sessionId);b=L.Utils.toJsonParse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=e(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.removeStream=function(){a.markActionNeeded()};a.close=
function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(d){L.Logger.error("[tk-sdk]peerConnection close error:",d)}};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=
e(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);
a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};
a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;"OFFER"===b?(d.offererSessionId=a.sessionId,d.answererSessionId=a.otherSessionId,d.seq=a.sequenceNumber+=1,d.tiebreaker=Math.floor(429496723*Math.random()+1)):(d.offererSessionId=a.incomingMessage.offererSessionId,d.answererSessionId=a.sessionId,d.seq=a.incomingMessage.seq);a.onsignalingmessage(L.Utils.toJsonStringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=
!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=
null;a.state="new";a.markActionNeeded();return a};window.TK=window.TK||{};
TK.ChromeRoapStack=function(b){var a={},c=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new c(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("[tk-sdk]PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]onicecandidate state: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var e=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+
"\r\n";a=a.replace(c[0],d)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d));return a};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+a.sessionId);b=L.Utils.toJsonParse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=e(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.removeStream=function(){a.markActionNeeded()};a.close=
function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(d){L.Logger.error("[tk-sdk]peerConnection close error:",d)}};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=
e(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);
a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};
a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;"OFFER"===b?(d.offererSessionId=a.sessionId,d.answererSessionId=a.otherSessionId,d.seq=a.sequenceNumber+=1,d.tiebreaker=Math.floor(429496723*Math.random()+1)):(d.offererSessionId=a.incomingMessage.offererSessionId,d.answererSessionId=a.sessionId,d.seq=a.incomingMessage.seq);a.onsignalingmessage(L.Utils.toJsonStringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=
!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=
null;a.state="new";a.markActionNeeded();return a};window.TK=window.TK||{};TK.nativeEntry=function(){var b=document.getElementById("tknative");b&&b.nodeName&&"embed"===b.nodeName.toLowerCase()||(b=document.createElement("embed"),document.body.appendChild(b),b.setAttribute("id","tknative"),b.setAttribute("mainentry",!0),b.setAttribute("hidden",!0),b.setAttribute("type","application/x-ppapi-proxy"));return b};
TK.nativePeerConnection=function(b){var a={},c={},e=b.audio,d=b.video,m=b.screen,n=!0;void 0===m&&(m=!1);a.onicecandidate=null;a.onaddstream=null;a.onremovestream=null;a.oniceconnectionstatechange=null;var f=function(){if(!b.cnnId)throw Error("Invalid native-peer-connection ID");return b.media?b.cnnId+":file":b.screen?b.cnnId+":screen":b.cnnId};tknative.addEventListener("message",function(b){var d=b.data.name;if(b.data.connectionId==f()){if("onLocalDescription"===d){var e={};e.sdp=b.data.sdp;e.type=
"offer";"function"===typeof c.createOffer_suc&&c.createOffer_suc(e);delete c.createOffer_suc;delete c.createOffer_fai}"onIceCandidate"===d&&a.onicecandidate&&(e={candidate:{}},e.candidate.sdpMLineIndex=b.data.sdpMLineIndex,e.candidate.sdpMid=b.data.sdpMid,e.candidate.candidate=b.data.candidate,a.onicecandidate(e));if("onIceStatusChanged"===d){b=b.data.state;if(1==b)a.oniceconnectionstatechange("checking");if(2==b)a.oniceconnectionstatechange("connected");if(3==b)a.oniceconnectionstatechange("completed");
if(4==b)a.oniceconnectionstatechange("failed");if(5==b)a.oniceconnectionstatechange("disconnected");if(6==b)a.oniceconnectionstatechange("closed")}if("onAddStream"===d)a.onaddstream({stream:{}})}},!1);a.close=function(){tknative.postMessage({command:"closeConnection",streamId:f().toString(),offerToSend:n,type:Number(b.media?1:b.screen?2:0)})};a.createOffer=function(a,b,r){r&&(n=!1);tknative.postMessage({command:"createOffer",streamId:f().toString(),includeLocalMedia:n,hasAudio:e,hasVideo:d,hasScreen:m,
offerToSend:n});c.createOffer_suc=a;c.createOffer_fai=b};a.setRemoteDescription=function(a,b,c){tknative.postMessage({command:"setRemoteDescription",sdpAnswer:a.sdp,streamId:f().toString()});b&&"function"===typeof b&&b()};a.addIceCandidate=function(a){tknative.postMessage({command:"setIceCandidate",candidate:a.candidate,sdpMid:0,sdpMLineIndex:a.sdpMLineIndex,streamId:f().toString()})};a.addStream=function(a){tknative.postMessage({command:"addStream",streamId:f().toString(),type:Number(b.media?1:b.screen?
2:0)})};a.removeStream=function(a){tknative.postMessage({command:"removeStream",streamId:f().toString(),type:Number(b.media?1:b.screen?2:0)})};a.setLocalDescription=function(a){};a.getStats=function(a){a&&"function"===typeof a&&a(void 0,-1)};return a};window.TK=window.TK||{};
TK.TkNativeStack=function(b){var a={},c=TK.nativePeerConnection;a.isNative=!0;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var e=function(a){L.Logger.error("Error in Stack ",a)};a.peerConnection=new c(b);var d=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=
" "+a});return b+"\r\n"},m=function(a){if(!b.video||!b.simulcast)return a;var c=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!c||0>=c.length)return a;var f=b.simulcast.numSpatialLayers||2;var e=parseInt(c[1]),l=parseInt(c[2]),h=a.match(new RegExp("a\x3dssrc:"+c[1]+" cname:(.*)\r?\n"))[1],n=a.match(new RegExp("a\x3dssrc:"+c[1]+" msid:(.*)\r?\n"))[1],m=a.match(new RegExp("a\x3dssrc:"+c[1]+" mslabel:(.*)\r?\n"))[1],w=a.match(new RegExp("a\x3dssrc:"+c[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
c[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+c[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var r=[e],Z=[l],ca=1;ca<f;ca++)r.push(e+1E3*ca),Z.push(l+1E3*ca);f=d(r);for(var K in r)e=r[K],l=Z[K],f+="a\x3dssrc-group:FID "+e+" "+l+"\r\n";for(K in r)e=r[K],l=Z[K],f+="a\x3dssrc:"+e+" cname:"+h+"\r\na\x3dssrc:"+e+" msid:"+n+"\r\na\x3dssrc:"+e+" mslabel:"+m+"\r\na\x3dssrc:"+e+" label:"+w+"\r\na\x3dssrc:"+l+" cname:"+h+"\r\na\x3dssrc:"+l+" msid:"+
n+"\r\na\x3dssrc:"+l+" mslabel:"+m+"\r\na\x3dssrc:"+l+" label:"+w+"\r\n";return a.replace(c[0],f+"a\x3dx-google-flag:conference\r\n")},n=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";
a=a.replace(b[0],c)}}return a},f=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&
a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(w){L.Logger.error("[tk-sdk]peerConnection close error:",w)}};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,
sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",candidate:a}):(b.localCandidates.push(a),L.Logger.debug("Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b)};var h,l=function(a,c){a||(c.sdp=
m(c.sdp));c.sdp=f(c.sdp);a=c.sdp;var d=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==d&&(a=a.replace(d[0],d[0]+"a\x3drtcp-fb:"+d[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});h=c},r=function(c){c.sdp=f(c.sdp);b.callback({type:c.type,sdp:c.sdp});(h=c)?a.peerConnection.setLocalDescription(c):L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=function(c,d){if(c.maxVideoBW||c.maxAudioBW){c.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",
c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=c.maxVideoBW,L.Logger.debug("Result",b.maxVideoBW));c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW);if(!h){L.Logger.error("[tk-sdk]localDesc is not exist!");return}h.sdp=f(h.sdp);c.Sdp||c.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),(void 0).sdp=f((void 0).sdp),TK.isHiFi&&((void 0).sdp=
n((void 0).sdp)),a.peerConnection.setRemoteDescription(void 0,function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:h.sdp})})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:h.sdp}))}if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("MinVideo Changed to ",c.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("muteStream changed to ",
c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){a.peerConnection.createOffer(l.bind(null,b),e,b)};a.addStream=function(b){a.peerConnection.addStream(b)};a.removeStream=function(b){a.peerConnection.removeStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c){L.Logger.debug("Process Signaling Message",c);if("offer"===c.type)c.sdp=f(c.sdp),TK.isHiFi&&(c.sdp=n(c.sdp)),a.peerConnection.setRemoteDescription(c.sdp,r,function(a){L.Logger.error("Error: ",
a)});else if("answer"===c.type)h?(TK.isHiFi&&(c.sdp=n(c.sdp)),L.Logger.debug("Set remote and local description"),L.Logger.debug("Remote Description",c.sdp),L.Logger.debug("Local Description",h.sdp),c.sdp=f(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.debug("Local candidates to send:",
b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===c.type)try{var d="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);if("end"!==d.candidate){d.candidate=d.candidate.replace(/a=/g,"");d.sdpMLineIndex=parseInt(d.sdpMLineIndex);var e=new RTCIceCandidate(d);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(e):b.remoteCandidates.push(e)}}catch(u){L.Logger.error("Error parsing candidate",
c.candidate)}};return a};window.TK=window.TK||{};TK.sessionId=103;
TK.Connection=function(b,a){var c={};b.sessionId=TK.sessionId+=1;c.browser=TK.getBrowser();if(!0===a)L.Logger.debug("Talk-Client Stack"),c=TK.TkNativeStack(b);else if("mozilla"===c.browser)L.Logger.debug("[tk-sdk]Firefox Stack"),c=TK.FirefoxStack(b);else if("bowser"===c.browser)L.Logger.debug("[tk-sdk]Bowser Stack"),c=TK.BowserStack(b);else if("chrome-stable"===c.browser||"electron"===c.browser)L.Logger.debug("[tk-sdk]Chrome Stable Stack"),c=TK.TkChromeStableStack(b);else throw L.Logger.error("[tk-sdk]No stack available for this browser"),
"WebRTC stack not available";c.updateSpec||(c.updateSpec=function(a,b){L.Logger.error("[tk-sdk]Update Configuration not implemented in this browser");b&&b("unimplemented")});return c};
TK.getBrowser=function(){var b="none";null!==window.navigator.userAgent.match("Firefox")?b="mozilla":null!==window.navigator.userAgent.match("Bowser")?b="bowser":null!==window.navigator.userAgent.match("Chrome")?(b="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(b="electron")):null!==window.navigator.userAgent.match("Safari")?b="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(b="bowser");return b};window.TK=window.TK||{};TK.Stream=function(b,a){return!0===a?TK.NativeStream(b):TK.StreamInner(b)};
TK.StreamInner=function(b){var a=TK.EventDispatcher(b),c="destroy";void 0!==b.video&&"number"===typeof b.video&&(b.video=0!==b.video);void 0!==b.audio&&"number"===typeof b.audio&&(b.audio=0!==b.audio);a.classInstanceName="Stream";a.stream=b.stream;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;a.url=b.url;a.recording=b.recording;a.room=b.room;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.videoSize=b.videoSize;a.videoFrameRate=
b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.videoMuted=!1;a.audioMuted=!1;a.attributes=b.attributes||{};a.isTkNative=!1;a.checkMyAudioAndVideoEnable=b.checkMyAudioAndVideoEnable;a.isInit=!1;var e={isWaiting:!1};void 0===a.attributes.type&&L.Logger.error("[tk-sdk]create stream spec.attributes.type is not exist , call video stream type must is video!");if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");
if(void 0===b.local||!0===b.local)a.local=!0;a.getID=function(){return a.local&&!b.streamID?"local":b.streamID};a.id=a.getID();a.publisherId=function(){return b.extensionId.replace(new RegExp(":"+b.attributes.type,"g"),"")};a.getAttributes=function(){return b.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.changeAudio=function(a){b.audio=a};
a.hasVideo=function(){return b.video};a.changeVideo=function(a){b.video=a};a.hasData=function(){return b.data};a.changeData=function(a){b.data=a};a.hasScreen=function(){return b.screen};a.hasMedia=function(){return!1};a.changeScreen=function(a){b.screen=a};a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(c,d,e){d=d||{};if(TK.isPlayback)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else if("video"===
a.getAttributes().type&&a.local)if(a.isIniting||a.isInit)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else{d.initDeviceId&&("object"===typeof d.initDeviceId?(d.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.initDeviceId.videoinput),d.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.initDeviceId.audioinput),d.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,
d.initDeviceId.audiooutput)):L.Logger.warning("[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{a.isIniting=!0;L.Logger.debug("[tk-sdk]Requested access to local media");var f=function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");var c=void 0;b&&void 0!==b.getUserMediaFailureCode&&(c=b.getUserMediaFailureCode);a.stream=b;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;k=
TK.StreamEvent({type:"access-accepted",stream:a,message:{getUserMediaFailureCode:c}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(k);e&&"function"===typeof e&&e({type:"access-accepted",stream:a,message:{getUserMediaFailureCode:c}});a.stream.getTracks().forEach(function(b){b.onended=function(){a.stream.getTracks().forEach(function(a){a.onended=null});k=TK.StreamEvent({type:"stream-ended",stream:a,message:b.kind});a.dispatchEvent(k)}})},h=function(b){L.Logger.error("[tk-sdk]Failed to get access to local media. Error name was "+
b.name+".");var c=L.Constant.accessDenied.streamFail,d=TK.StreamEvent({type:"access-denied",stream:a,message:{code:c,msg:b}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(d);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:{code:c,msg:b}})},n={dispatchEvent:c,isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:TK.isInnerVersions,isStopLocalStream:!0};if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)){var m=
{audio:b.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:b.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:!1};TK.DeviceMgr.getUserMedia(f,h,m,n)}else TK.DeviceMgr.enumerateDevices(function(a){a={audio:b.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:b.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:!1};TK.DeviceMgr.getUserMedia(f,h,a,n)},{isSetlocalStorage:!0})}catch(u){c=
L.Constant.accessDenied.ohterError;d="[tk-sdk]Failed to get access to local media. Error was "+u+".";L.Logger.error(d);var k=TK.StreamEvent({type:"access-denied",stream:a,message:{code:c,msg:d}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(k);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:{code:c,msg:d}})}}else L.Logger.warning("[tk-sdk]stream init must is localStream and stream type must is video!"),e&&"function"===typeof e&&e({type:"access-denied",stream:a})};a.close=function(){a.local&&
(a.room&&a.room.unpublish&&a.room.unpublish(a),a.hide(),void 0!==a.stream&&a.stream.getTracks().forEach(function(a){a.onended=null;a.stop()}),a.stream=null,a.stream=void 0,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream,a.isInit=!1,a.isIniting=!1)};a.play=function(b,d){function f(){d=d||{};a.elementID=b;if(void 0!==b)if(a.player&&a.stop(),"living"!==c)L.Logger.warning("[tk-sdk]stream.play:player life state not is living , not play stream!");else{var f=new TK.VideoPlayer({id:a.getID(),
stream:a,elementID:b,options:d,bundleId:a.extensionId});a.player=f;a.playing=!0;e.isWaiting&&a.player.startIntervalGetRealtimeVolume&&a.player.startIntervalGetRealtimeVolume(e.onSuccess,e.interval,e.onFailure)}}c="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?f():(L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",
L.Utils.toJsonStringify(a));f()}))};a.stop=function(){c="destroy";a.playing&&(void 0!==a.player&&a.player.destroy(),a.player=void 0,a.playing=!1)};a.updateVideoPlayerOptions=function(b){a.player&&a.player.updateVideoPlayerOptions&&a.player.updateVideoPlayerOptions(b)};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};a.setMute=function(b){void 0!==a.player&&a.player.setMute&&a.player.setMute(b)};a.setVolume=function(b){void 0!==a.player&&
a.player.setVolume&&("number"!==typeof b?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):a.player.setVolume(b))};a.getVolume=function(b){if(void 0!==a.player&&a.player.getVolume)return a.player.getVolume(b)};a.startIntervalGetRealtimeVolume=function(b,c,d){void 0!==a.player&&a.player.startIntervalGetRealtimeVolume&&a.player.startIntervalGetRealtimeVolume(b,c,d);e.isWaiting=!0;e.onSuccess=b;e.onFailure=d;e.interval=c};a.stopIntervalGetRealtimeVolume=function(){void 0!==a.player&&
a.player.stopIntervalGetRealtimeVolume&&a.player.stopIntervalGetRealtimeVolume();e={isWaiting:!1}};a.hideLoading=function(){void 0!==a.player&&a.player.hideLoading&&a.player.hideLoading()};a.showLoading=function(){void 0!==a.player&&a.player.showLoading&&a.player.showLoading()};var d=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),e=parseInt(c.getPropertyValue("height"),10),m=parseInt(c.getPropertyValue("left"),
10);c=parseInt(c.getPropertyValue("top"),10);var w="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var t=document.defaultView.getComputedStyle(w);w=parseInt(t.getPropertyValue("width"),10);t=parseInt(t.getPropertyValue("height"),10);var k=document.createElement("canvas");k.id="testing";k.width=w;k.height=t;k.setAttribute("style","display: none");k.getContext("2d").drawImage(b,m,c,d,e);return k}return null};a.getVideoFrameURL=
function(a){var b=d();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=d();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),
b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==
a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),d("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:c}},a.checkOptions(b,!0),a.pc.updateSpec(b,d))};var m=function(b,c,d){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];a.room&&a.room.sendControlMessage&&0<b.length&&
a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:d,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){m(a,b,!1)};a.enableHandlers=function(a,b){m(a,b,!0)};a.updateConfiguration=function(b,c){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room&&a.room.p2p)for(var d in a.pc)a.pc[d].updateSpec(b,c);else a.pc.updateSpec(b,c);else a.pc.updateSpec(b,c);else c("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,c){L.Logger.debug("[tk-sdk]call muteVideo , video muted state:"+
b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.videoMuted=b;void 0!==a.peerConnectionStream&&a.peerConnectionStream&&a.peerConnectionStream.getTracks&&a.peerConnectionStream.getTracks().forEach(function(a){"video"===a.kind&&(a.enabled=!b)});a.updateMuteToServer(c)};a.muteAudio=function(b,c){L.Logger.debug("[tk-sdk]call muteAudio , audio muted state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+
L.Utils.toJsonStringify(a.getAttributes()));a.audioMuted=b;void 0!==a.peerConnectionStream&&a.peerConnectionStream&&a.peerConnectionStream.getTracks&&a.peerConnectionStream.getTracks().forEach(function(a){"audio"===a.kind&&(a.enabled=!b)});a.updateMuteToServer(c)};return a};window.TK=window.TK||{};
TK.NativeStream=function(b){var a=TK.EventDispatcher(b),c="destroy";a.classInstanceName="Stream";a.stream=b.stream;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;a.url=b.url;a.recording=b.recording;a.room=b.room;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.media=b.media;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.path=b.path;a.videoMuted=!1;a.audioMuted=
!1;a.isTkNative=!0;a.checkMyAudioAndVideoEnable=b.checkMyAudioAndVideoEnable;a.pushVideoMuted=!0;a.pushAudioMuted=!0;a.isInit=!1;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===b.local||!0===b.local)a.local=!0;if(b.screen&&b.media)throw Error("Wrong stream type which contains both media and screen");a.path||(a.path="");var e=function(){return a.media?1:a.screen?2:0};a.getID=function(){return a.local&&!b.streamID?"local":
b.streamID};a.publisherId=function(){return b.extensionId.replace(new RegExp(":"+b.attributes.type,"g"),"")};a.getAttributes=function(){return b.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.hasVideo=function(){return b.video};a.hasData=function(){return b.data};a.hasScreen=function(){return b.screen};a.hasMedia=function(){return b.media};
a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(c,d,e){d=d||{};if(TK.isPlayback)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else if("video"===a.getAttributes().type&&a.local)if(a.isIniting||a.isInit)e&&"function"===typeof e&&e({type:"access-denied",stream:a});else{d.initDeviceId&&("object"===typeof d.initDeviceId?(d.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,
d.initDeviceId.videoinput),d.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.initDeviceId.audioinput),d.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,d.initDeviceId.audiooutput)):L.Logger.warning("[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{if(b.audio||b.video){a.isIniting=!0;L.Logger.debug("[tk-sdk]Requested access to local media");var f=b.video;
!0===f||!0===b.screen?(f=!0===f?{}:f,void 0!==a.videoSize&&(f.mandatory=f.mandatory||{},f.mandatory.minWidth=a.videoSize[0],f.mandatory.minHeight=a.videoSize[1],f.mandatory.maxWidth=a.videoSize[2],f.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&(f.optional=f.optional||[],f.optional.push({minFrameRate:a.videoFrameRate[0]}),f.optional.push({maxFrameRate:a.videoFrameRate[1]}))):!0===b.screen&&void 0===f&&(f=!0);var h={video:f,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:a.extensionId,
desktopStreamId:a.desktopStreamId},m=function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");a.stream=b;a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream;k=TK.StreamEvent({type:"access-accepted",stream:a});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(k);e&&"function"===typeof e&&e({type:"access-accepted",stream:a})},n=function(b){var c=TK.StreamEvent({type:"access-denied",stream:a,message:b});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(c);
e&&"function"===typeof e&&e({type:"access-denied",message:b,stream:a})};L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?TK.DeviceMgr.getUserMedia(m,n,h,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0}):TK.DeviceMgr.enumerateDevices(function(a){TK.DeviceMgr.getUserMedia(m,n,h,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})},{isSetlocalStorage:!0})}else{L.Logger.warning("[tk-sdk]The stream has no audio and video needs to be initialized.");
var k=TK.StreamEvent({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(k);e&&"function"===typeof e&&e({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."})}}catch(u){k=TK.StreamEvent({type:"access-denied",stream:a,message:u}),a.isInit=!0,a.isIniting=!1,a.dispatchEvent(k),e&&"function"===typeof e&&e({type:"access-denied",message:u,stream:a})}}else L.Logger.warning("[tk-sdk]stream init must is localStream and stream type must is video!"),
e&&"function"===typeof e&&e({type:"access-denied",stream:a})};a.close=function(){a.local&&(a.room&&a.room.unpublish&&a.room.unpublish(a),a.hide(),a.stream=void 0,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream)};a.create=function(){a.local?tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e()),args:{path:a.path.toString()}}):tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),
isLocal:!1,type:Number(e())})};a.destroy=function(){a.local?tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e())}):tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(e())})};a.play=function(d,f){function h(){f=f||{};a.elementID=d;if(void 0!==d){a.player&&a.stop();if("living"!==c){L.Logger.warning("[tk-sdk]stream.play:player life state not is living , not play stream!");return}var l=new TK.NativeVideoPlayer({id:b.extensionId,
stream:a,elementID:d,options:f,bundleId:a.extensionId});a.player=l;a.playing=!0;TK.isOnlyAudioRoom&&a.player.hideVideo();a.local?tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e()),args:{path:a.path.toString()}}):tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(e())})}a&&a.getAttributes&&a.getAttributes()&&"video"===a.getAttributes().type&&a.extensionId&&a.checkMyAudioAndVideoEnable&&"function"===
typeof a.checkMyAudioAndVideoEnable&&a.checkMyAudioAndVideoEnable(a.extensionId)}c="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?h():(L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(a));h()}))};a.stop=function(){c="destroy";a.playing&&(void 0!==a.player&&a.player.destroy(),a.player=
void 0,a.playing=!1,a.local?tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(e())}):tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(e())}))};a.updateVideoPlayerOptions=function(b){a.player&&a.player.updateVideoPlayerOptions&&a.player.updateVideoPlayerOptions(b)};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};a.setMute=
function(b){void 0!==a.player&&a.player.setMute&&a.player.setMute(b)};a.setVolume=function(b){void 0!==a.player&&a.player.setVolume&&("number"!==typeof b?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):a.player.setVolume(b))};a.getVolume=function(b){if(void 0!==a.player&&a.player.getVolume)return a.player.getVolume(b)};a.startIntervalGetRealtimeVolume=function(b,c,d){void 0!==a.player&&a.player.startIntervalGetRealtimeVolume&&a.player.startIntervalGetRealtimeVolume(b,c,d)};
a.stopIntervalGetRealtimeVolume=function(){void 0!==a.player&&a.player.stopIntervalGetRealtimeVolume&&a.player.stopIntervalGetRealtimeVolume()};a.hideLoading=function(){void 0!==a.player&&a.player.hideLoading&&a.player.hideLoading()};a.showLoading=function(){void 0!==a.player&&a.player.showLoading&&a.player.showLoading()};var d=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),e=parseInt(c.getPropertyValue("height"),
10),m=parseInt(c.getPropertyValue("left"),10);c=parseInt(c.getPropertyValue("top"),10);var w="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var t=document.defaultView.getComputedStyle(w);w=parseInt(t.getPropertyValue("width"),10);t=parseInt(t.getPropertyValue("height"),10);var k=document.createElement("canvas");k.id="testing";k.width=w;k.height=t;k.setAttribute("style","display: none");k.getContext("2d").drawImage(b,m,c,
d,e);return k}return null};a.getVideoFrameURL=function(a){var b=d();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=d();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),
b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==
a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),d("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:c}},a.checkOptions(b,!0),a.pc.updateSpec(b,d))};a.pushVideo=function(b){a.pushVideoMuted!=b&&(a.pushVideoMuted=b,tknative.postMessage({command:"pushVideo",enable:b}))};a.pushAudio=function(b){a.pushAudioMuted!=
b&&(a.pushAudioMuted=b,tknative.postMessage({command:"pushAudio",enable:b}))};var m=function(b,c,d){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];a.room&&a.room.sendControlMessage&&0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:d,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){m(a,b,!1)};a.enableHandlers=function(a,b){m(a,b,!0)};a.updateConfiguration=function(b,c){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room&&
a.room.p2p)for(var d in a.pc)a.pc[d].updateSpec(b,c);else a.pc.updateSpec(b,c);else a.pc.updateSpec(b,c);else c("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,c){a.videoMuted=b;!0===a.local&&tknative.postMessage({command:"enableVideo",enable:!b});a.updateMuteToServer(c)};a.muteAudio=function(b,c){a.audioMuted=b;!0===a.local&&tknative.postMessage({command:"enableAudio",enable:!b});void 0===a.stream&&L.Logger.warning("[tk-sdk]not deviceStream to muteAudio");a.updateMuteToServer(c)};
return a};window.TK=window.TK||{};TK.MSG_TO_ALLUSER="__all";TK.MSG_TO_ALLEXCEPTSENDER="__allExceptSender";TK.MSG_TO_ALLEXCEPTAUDITOR="__allExceptAuditor";TK.MSG_TO_NONEUSER="__None";TK.STREAM_VIDEO="video";TK.STREAM_MEDIA="media";TK.STREAM_SCREEN="screen";TK.STREAM_FILE="file";TK.LOG_DEBUG=0;TK.LOG_TRACE=1;TK.LOG_INFO=2;TK.LOG_WARNING=3;TK.LOG_ERROR=4;TK.LOG_NONE=5;TK.REC_TYPE_RECFILE="0";TK.REC_TYPE_VIDEOLIST="1";TK.REC_TYPE_MP3="2";TK.REC_TYPE_MIXVIDEO="3";TK.nativeCallSeq=0;TK.waitNativeToCallbackList={};
TK.SDKTYPE="pc";TK.isInnerVersions=!1;TK.isHiFi=!1;TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;TK.isRetainPublishstateOnOnlyAudioRoom=!1;var tknative;TK.SDKVERSIONS="2.2.0.6";TK.SDKVERSIONSTIME="2018062000";TK.getSdkVersion=function(){return TK.SDKVERSIONS};TK.NativeInfo=function(){try{var b={};return b=talk_window}catch(a){return null}};TK.CheckNativeInterfaceAvailable=function(){tknative=tknative||TK.nativeEntry();return!L.Utils.isNull(tknative)&&L.Utils.isFunction(tknative.postMessage)?!0:!1};
TK.Initialize=function(b,a){try{if(b){if(TK.isTkNative=!0,TK.isTkMacNative=a,tknative=tknative||TK.nativeEntry(),TK.NativeProxy.initialize(),TK.DeviceMgr=null,TK.DeviceMgr=TK.NativeAVMgr(),tknative.postMessage({command:"maximizeNativeClient"}),m=void 0,d=TK.NativeInfo())m=d.clientversion}else{TK.isTkNative=!1;TK.isTkMacNative=!1;var c=document.getElementById("tknative");if(c&&c.nodeName&&"embed"===c.nodeName.toLowerCase()){var e=c.parentNode;e&&e.removeChild(c)}var d=TK.NativeInfo(),m=void 0;d&&d.maxmizeWindow&&
"function"===typeof d.maxmizeWindow&&(d.maxmizeWindow(),m=d.clientversion)}TK.clientversion=m;TK.subscribe_from_native=TK.isTkNative&&!TK.isTkMacNative&&2018031E3<=m;L.Logger.info("[tk-sdk]isClient:"+TK.isTkNative+",clientVersion:"+m)}catch(n){L.Logger.error("[tk-sdk]Initialize error:",n)}};
TK.Room=function(b){function a(b,c){var q=c?"audioinput":"videoinput";if(1>b.length){L.Logger.error("[tk-sdk] "+q+" devices are un-available. reason: maybe NotReadable");var d=TK.RoomEvent({type:"device-failure",message:{kind:q}},{code:TK_ERR.DEVICE_ERROR_UnknownError});g.dispatchEvent(d)}else TK.DeviceMgr.getUserMedia(function(a){a.getTracks().forEach(function(a){a.stop()});a=null;L.Logger.info("[tk-sdk] "+q+" devices are available");a=TK.RoomEvent({type:"device-success",message:{kind:q}});g.dispatchEvent(a)},
function(d){switch(d.name){case "NotAllowedError":case "PermissionDeniedError":L.Logger.error("[tk-sdk] "+q+" devices are un-available. reason: NotAllowed");d=TK.RoomEvent({type:"device-failure",message:{kind:q}},{code:window.TK_ERR.DEVICE_ERROR_NotAllowedError});g.dispatchEvent(d);return}b.splice(0,1);a(b,c)},{video:c?!1:b[0].deviceId,audio:c?b[0].deviceId:!1})}function c(){function a(){if(void 0===y||void 0===C||void 0===p)return L.Logger.warning("[tk-sdk]web_host or web_port or myself is undefined , web_host is "+
y+" , web_port is "+C+",myself is "+p),-1;if(!T)return L.Logger.warning("[tk-sdk]No checkroom cannot joinroom , room_properties is "+T),-1;p.publishstate!==TK.PUBLISH_STATE_NONE&&(p.publishstate=TK.PUBLISH_STATE_NONE);g.needReconnectSocket=!0;v.checkMyAudioAndVideoEnable=function(a){p&&p.id&&(a=a||p.id,a===p.id&&(TK.isTkNative&&(r(!0),w(!0)),p.publishstate>TK.PUBLISH_STATE_NONE&&l()))};if(x&&x.userProperties&&"object"===typeof x.userProperties)for(var a in x.userProperties)void 0===p[a]&&(p[a]=x.userProperties[a]);
x&&x.group&&(Array.isArray(x.group)?p.group=x.group:L.Logger.warning("[tk-sdk]joinroomOptions.group must is a array!"));L.Logger.info("[tk-sdk]joinroom:my device info  [hasvideo , hasaudio] is ["+p.hasvideo+" ,"+p.hasaudio+"]");L.Logger.debug("[tk-sdk]joinroom:my room user",p);D={};U={};J(y,C,function(a,b){0!==a?L.Logger.error("[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b):0==a&&2==A?Z(y,C,function(a,b){L.Logger.debug("[tk-sdk]step2GetFileList result \x3d "+a+" , message:"+
L.Utils.toJsonStringify(b));-1!==a?(void 0!==b?(R=b,a=TK.RoomEvent({type:"room-files",message:R})):(R=[],a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETFILELISTERROR,error:a}})),g.dispatchEvent(a)):L.Logger.info("[tk-sdk]step2GetFileList code is "+a);K()}):(L.Logger.error("[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b," , _status \x3d "+A),a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),g.dispatchEvent(a))})}
0!==g.state&&L.Logger.warning("[tk-sdk]Room already connected",g.state);TK.default_stream=v;x&&x.userDeviceId&&"object"===typeof x.userDeviceId&&(x.userDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,x.userDeviceId.videoinput),x.userDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,x.userDeviceId.audioinput),x.userDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,x.userDeviceId.audiooutput));
"function"===typeof callback&&callback(v);x&&x.initMyStreamJurisdiction&&!v.isInit&&!z?(L.Logger.info("[tk-sdk]joinroom:my stream is not init , call stream init start!"),v.init(!0,void 0,function(b){L.Logger.info("[tk-sdk]joinroom:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(b));Qa(b);a()})):a()}function e(){var a=void 0;x&&"object"===typeof x&&"Stream"===x.classInstanceName?(a=x,"video"!==a.getAttributes().type&&a.updateLocalAttributes({type:"video"}),a.extensionId!==
p.id&&(a.extensionId=p.id),void 0===p.hasvideo||void 0===p.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),pa.enumerateDevices(function(b){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");b=b.hasdevice;p.hasvideo=b.videoinput;p.hasaudio=b.audioinput;v=a;c()})):(v=a,c())):(x.initMyStreamJurisdiction=void 0!==x.initMyStreamJurisdiction?x.initMyStreamJurisdiction:!1,z?(v=a=
Ca("video",{video:!1,audio:!1,attributes:{}}),c()):x&&"object"===typeof x&&void 0!==x.video&&void 0!==x.audio?(L.Utils.isNull(v)&&(v=a=Ca("video",{video:x.video,audio:x.audio,attributes:{}})),void 0===p.hasvideo||void 0===p.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),pa.enumerateDevices(function(a){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");a=a.hasdevice;p.hasvideo=
a.videoinput;p.hasaudio=a.audioinput;c()})):c()):void 0===p.hasvideo||void 0===p.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream start!"),pa.enumerateDevices(function(b){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream finshed!");b=b.hasdevice;p.hasvideo=b.videoinput;p.hasaudio=b.audioinput;L.Utils.isNull(v)&&(v=a=Ca("video",{video:x&&"object"===typeof x&&
void 0!==x.video?x.video:p.hasvideo,audio:x&&"object"===typeof x&&void 0!==x.audio?x.audio:p.hasaudio,attributes:{}}));c()})):(L.Utils.isNull(v)&&(v=a=Ca("video",{video:x&&"object"===typeof x&&void 0!==x.video?x.video:p.hasvideo,audio:x&&"object"===typeof x&&void 0!==x.audio?x.audio:p.hasaudio,attributes:{}})),c()))}function d(a,b,c){L.Logger.info("[tk-sdk]calling publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));b=b||{};b.maxVideoBW=
b.maxVideoBW||E.defaultVideoBW;b.maxVideoBW>E.maxVideoBW&&(b.maxVideoBW=E.maxVideoBW);"screen"===a.getAttributes().type?b.maxVideoBW=E.maxScreenBW:"file"===a.getAttributes().type&&(b.maxVideoBW=E.maxLocalFileMediaBW);void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>E.maxVideoBW&&(b.minVideoBW=E.maxVideoBW);b.simulcast=b.simulcast||b._simulcast||!1;a&&void 0===g.localStreams[a.getID()]?a.hasAudio()||a.hasVideo()||a.hasScreen()?void 0===a.url&&void 0===a.recording&&(a.failed&&delete a.failed,clearTimeout(a._publishTimer),
a._publishTimer=setTimeout(function(){g.unpublish(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]publish timeout 15s: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(a.extensionId===p.id)if(3>a.timeoutRePublishNumber)void 0===a.timeoutRePublishNumber&&(a.timeoutRePublishNumber=0),p.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]publish timeout 15s--\x3epublish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.timeoutRePublishNumber++,g.publish(a,{timeoutPublishReconnection:!0})):L.Logger.warning("[tk-sdk]publish timeout 15s--\x3emy publishstate is 0 , not need afresh publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));else{L.Logger.info("[tk-sdk]publish timeout 15s--\x3erePublish number \x3e 3 , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.extensionId===p.id&&p.publishstate>TK.PUBLISH_STATE_NONE&&g.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE});var q=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishTimeout",errorCode:-1,timeoutRePublishNumber:a.timeoutRePublishNumber,timeoutPublishReconnection:!0}});g.dispatchEvent(q);c&&c(void 0,void 0)}else q=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishTimeout",
errorCode:-1}}),g.dispatchEvent(q),L.Logger.info("[tk-sdk]publish timeout 15s--\x3e publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)})},15E3),L.Logger.debug("[tk-sdk]Publishing to ms Normally, is createOffer",b.createOffer,a.extensionId),ia("publish",{state:"ms",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo()&&!TK.isOnlyAudioRoom,screen:a.hasScreen(),minVideoBW:b.minVideoBW,
attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:b.createOffer,metadata:b.metadata,scheme:b.scheme},void 0,function(q,d){a.isPublishing=!1;clearTimeout(a._publishTimer);if(0!=q)if(L.Logger.error("[tk-sdk]Error when publishing the stream: ",q,d),L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.extensionId===p.id)if(3>a.publishReconnectionNumber)void 0===a.publishReconnectionNumber&&
(a.publishReconnectionNumber=0),g.unpublish(a,function(b){setTimeout(function(){p.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]stream-publish-fail:publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber++,g.publish(a,{publishReconnection:!0})):L.Logger.warning("[tk-sdk]stream-publish-fail:my publishstate is 0 , not need afresh publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{publishReconnection:!0});else{a.extensionId===p.id&&p.publishstate>TK.PUBLISH_STATE_NONE?g.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):g.unpublish(a);var e=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishFail",errorCode:q,publishReconnectionNumber:a.publishReconnectionNumber,publishReconnection:!0,hasdata:!1}});g.dispatchEvent(e);c&&c(void 0,q)}else L.Logger.info("[tk-sdk]stream-publish-fail:publish stream stream.extensionId !\x3d _myself.id   , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.unpublish(a),e=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishFail",errorCode:q,id:d,hasdata:!1}}),g.dispatchEvent(e),c&&c(void 0,q);else L.Logger.debug("[tk-sdk]Stream assigned an Id, starting the publish process , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber=0,a.timeoutRePublishNumber=
0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return d},a.id=a.getID(),a.hasData()&&(a.sendData=function(b){qb(a,b)}),a.setAttributes=function(b){rb(a,b)},a.hasScreen()&&(Da=!0),g.localStreams[d]=a,a.room=g,a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message",b);b=Ea(b);ia("signaling_message",{streamId:a.getID(),msg:b},void 0,function(){})},iceServers:g.iceServers,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,
limitMaxVideoBW:b.maxVideoBW,simulcast:b.simulcast,audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),media:a.hasMedia(),cnnId:p.id},TK.isTkNative),a.peerConnectionStream=a.mediaStreamClone||(a.stream&&a.stream.clone&&"function"===typeof a.stream.clone?a.stream.clone():a.stream),a.pc.addStream(a.peerConnectionStream),a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]publish ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
"failed"===b&&0!==g.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Publishing Stream",a.getID(),"has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),t(a,b,"publish"))},b.createOffer||a.pc.createOffer(),c&&c(!0,d)})):(L.Logger.error("[tk-sdk]Either screen or audio or video is at least one true for streaming",a),c&&c(void 0,"Either screen or audio or video is at least one true for streaming")):
(L.Logger.error("[tk-sdk]Trying to publish invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(void 0,"Trying to publish invalid stream"))}function m(a){M=a.web_protocol||M;y=a.web_host||y;C=a.web_port||C;ua=a.doc_protocol||ua;la=a.doc_host||la;ma=a.doc_port||ma;$a=a.socket_protocol||$a;ab=a.socket_host||ab;bb=a.socket_port||bb;ra=a.backup_doc_protocol||ra;ja=a.backup_doc_host||ja;ka=a.backup_doc_port||ka;void 0===
la&&(la=y);void 0===ma&&(ma=C);void 0===ja&&(ja=y);void 0===ka&&(ka=C);cb||(la=y,ma=C);db||(ja=y,ka=C);N&&N.changeCommonWhiteBoardConfigration&&N.changeCommonWhiteBoardConfigration({webAddress:M+"://"+y+":"+C,docAddress:ua+"://"+la+":"+ma,backupDocAddress:ra+"://"+ja+":"+ka});a=TK.RoomEvent({type:"room-updateWebAddressInfo",message:{protocol:M,web_protocol:M,web_host:y,web_port:C,doc_protocol:ua,doc_host:la,doc_port:ma,backup_doc_protocol:ra,backup_doc_host:ja,backup_doc_port:ka}});g.dispatchEvent(a);
a=TK.RoomEvent({type:"room-serveraddress-update",message:{protocol:M,web_protocol:M,web_host:y,web_port:C,doc_protocol:ua,doc_host:la,doc_port:ma,backup_doc_protocol:ra,backup_doc_host:ja,backup_doc_port:ka}});g.dispatchEvent(a)}function n(a,b,c){var q=X;a=a||{};a.source=a.source||"unknown source";var d=a.source;J(y,C,function(a,e){if(0!==a)L.Logger.error("[tk-sdk]"+d+":step2GetConfig failure --\x3e result and responseText:",a,e);else if(0==a&&2==A){if(q!==X||"forceReconnect room"===d){g.needReconnectSocket=
!0;sa&&g.stopIntervalRtcStatsrObserver();v.rtcStatsrObserverTimer&&g.stopIntervalRtcStatsrObserverByStream(v);TK.isTkNative&&(va=!1,tknative.postMessage({command:"nativeClear"}));Da=!1;try{g.socket&&g.socket.disconnect&&g.socket.disconnect()}catch(Gb){L.Logger.debug("[tk-sdk]"+d+":Socket already disconnected , disconnect errorInfo:",Gb)}g.socket=void 0;if("select service reconnect"===d||"forceReconnect room"===d)k(),a=TK.RoomEvent({type:"room-disconnected",message:"select service reconnect , need socket disconnect"}),
g.dispatchEvent(a)}Z(y,C,function(a,e){L.Logger.debug("[tk-sdk]reconnected room:step2GetFileList result \x3d "+a+" , message:"+L.Utils.toJsonStringify(e));-1!==a?(void 0!==e?(R=e,a=TK.RoomEvent({type:"room-files",message:R})):(R=[],a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETFILELISTERROR,error:a}})),g.dispatchEvent(a)):L.Logger.info("[tk-sdk]"+d+":step2GetFileList code is "+a);"forceReconnect room"===d?(L.Logger.info("[tk-sdk]"+d+":room socket force reconnect room  ,room socket url:"+
(window.__TkSdkBuild__?L.Utils.encrypt(X):X)+"! "),K()):q===X?(L.Logger.info("[tk-sdk]"+d+":room socket url not change  , room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(X):X)+"! "),"reconnected room"===d?W(b,c):"select service reconnect"===d&&(L.Logger.warning("[tk-sdk]room uri is not change , no need to perform a reload server"),da&&p&&p.id&&D[p.id]&&S!==p.servername&&g.changeUserProperty(p.id,"__all",{servername:S}))):(L.Logger.info("[tk-sdk]"+d+":room socket url  changed  , old room socket url:"+
(window.__TkSdkBuild__?L.Utils.encrypt(q):q)+"  , now room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(X):X)+"! "),K())})}else L.Logger.error("[tk-sdk]"+d+":step2GetConfig failure --\x3e result and responseText:",a,e," , _status \x3d "+A),a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),g.dispatchEvent(a)})}function f(a,b){a=a||O;b=b||S;if("object"===typeof a&&L.Utils.getJsonLength(a)&&void 0!==b)for(var c in a)a[c].isUseServer=b===c?!0:!1}function h(){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(y)&&
S)if(void 0!==y){var a=y.indexOf(".");0<a?(a=y.substring(0,a),a=new RegExp(a),Ra=y,a=y.replace(a,S),a!==y?(L.Logger.info("[tk-sdk]changeWebRequest host , old host is "+(window.__TkSdkBuild__?L.Utils.encrypt(Ra):Ra)+", now host is "+(window.__TkSdkBuild__?L.Utils.encrypt(a):a)),m({web_host:a})):L.Logger.info("[tk-sdk]changeWebRequest host , host is not change ,   host is "+(window.__TkSdkBuild__?L.Utils.encrypt(y):y))):L.Logger.error("[tk-sdk]web request host not find first dot , cannot address to replace , current host is "+
(window.__TkSdkBuild__?L.Utils.encrypt(y):y)+" ! ")}else L.Logger.error("[tk-sdk]web request host is not exist , cannot call changeWebRequestAddress ! ")}function l(a,b,c){a=a||p.publishstate;b=b||{hasvideo:p.hasvideo,disablevideo:p.disablevideo};c=c||{hasaudio:p.hasaudio,disableaudio:p.disableaudio};a>TK.PUBLISH_STATE_NONE&&(w(b.hasvideo&&!b.disablevideo&&(a===TK.PUBLISH_STATE_VIDEOONLY||a===TK.PUBLISH_STATE_BOTH)),r(c.hasaudio&&!c.disableaudio&&(a===TK.PUBLISH_STATE_AUDIOONLY||a===TK.PUBLISH_STATE_BOTH)))}
function r(a){v.muteAudio(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=Ea(a),ia("signaling_message",{streamId:v.getID(),msg:a})})}function w(a){TK.isOnlyAudioRoom&&(a=!1);v.muteVideo(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=Ea(a),ia("signaling_message",{streamId:v.getID(),msg:a})})}function t(a,b,c){"failed"===b&&(void 0===a.reconnectionNumber&&(a.reconnectionNumber=0),0!==g.state&&
a&&3>a.reconnectionNumber?"publish"===c?a.extensionId===p.id?(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.unpublish(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+
" !");if(p.publishstate>TK.PUBLISH_STATE_NONE)L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.reconnectionNumber++,g.publish(a,{reconnection:!0});else{L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed --\x3emy publishstate is 0 , not need afresh publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
var q=TK.StreamEvent({type:"stream-reconnection-failed",message:{reconnectionNumber:a.reconnectionNumber,source:c,isCompleted:a.isCompleted,code:L.Constant.streamReconnection.midwayReconnectionChangePublishstate_0},stream:a});g.dispatchEvent(q)}},1E3)},{reconnection:!0})):(g.unpublish(a),L.Logger.info("[tk-sdk]publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):"subscribe"===c&&(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunsubscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.unsubscribe(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(g.remoteStreams[a.getID()]){a.reconnectionNumber++;L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3estream-removed(initiative) , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var q=TK.StreamEvent({type:"stream-removed",stream:a,message:{reconnection:!0,reconnectionNumber:a.reconnectionNumber,isCompleted:a.isCompleted,source:c,isNotRemote:!0}});g.dispatchEvent(q);a.getAttributes().type===TK.STREAM_VIDEO?Sa(a):za(a,!1);L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
g.subscribe(a,{reconnection:!0})}else L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{reconnection:!0})):3<=a.reconnectionNumber&&("publish"===c?a.extensionId===p.id&&p.publishstate>TK.PUBLISH_STATE_NONE?g.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):g.unpublish(a):
"subscribe"===c&&g.unsubscribe(a),a.isCompleted||p.udpstate===L.Constant.udpState.notOnceSuccess||g.changeUserProperty(p.id,"__all",{udpstate:L.Constant.udpState.notOnceSuccess}),L.Logger.info("[tk-sdk]stream-reconnection-failed , source is "+c+", isCompleted is "+a.isCompleted+", reconnectionNumber is "+a.reconnectionNumber+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=TK.StreamEvent({type:"stream-reconnection-failed",message:{reconnectionNumber:a.reconnectionNumber,
source:c,isCompleted:a.isCompleted,code:a.isCompleted?L.Constant.streamReconnection.midwayReconnectionNotSuccess:L.Constant.streamReconnection.notOnceSuccess},stream:a}),g.dispatchEvent(b)))}function k(){var a;TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;for(a in g.remoteStreams)if(g.remoteStreams.hasOwnProperty(a)){var b=g.remoteStreams[a];eb(b);delete g.remoteStreams[a];if(b&&!b.failed){L.Logger.info("[tk-sdk]_resetRoomState--\x3estream-removed(), stream id:"+b.getID()+" , extensionId is "+b.extensionId+
", attrs is "+L.Utils.toJsonStringify(b.getAttributes()));var c=TK.StreamEvent({type:"stream-removed",stream:b});g.dispatchEvent(c);b.getAttributes().type===TK.STREAM_VIDEO?Sa(b):za(b,!1)}}g.remoteStreams={};for(a in g.localStreams)if(g.localStreams.hasOwnProperty(a)){b=g.localStreams[a];if(g.p2p)for(var d in b.pc)b.pc[d].close();else b.pc.close();g.localStreams[a]&&(g.localStreams[a].isPublishing=!1,g.localStreams[a].isUnpublishing=!1,g.localStreams[a].peerConnectionStream=void 0);delete g.localStreams[a]}v&&
v.pc&&v.pc.close&&v.pc.close();D&&(P(U),F(D));p&&(p.publishstate=TK.PUBLISH_STATE_NONE,p._videopublished_=!1,p._audiopublished_=!1,p._videoplayed_=!1,p._audioplayed_=!1);aa={};Ka={};L.Utils.isNull(I[p.id])?L.Utils.isNull(I[p.id])?I={}:(b=I._local_default_extension_id_,I={},I._local_default_extension_id_=b):(b=I[p.id],I={},I[p.id]=b);v&&(v.isPublishing=!1,v.isUnpublishing=!1);da=!1;N&&N.changeCommonWhiteBoardConfigration&&N.changeCommonWhiteBoardConfigration({isConnectedRoom:da})}function u(a){L.Logger.debug("[tk-sdk]setStatus to: "+
a);A!=a&&(A=a,6==A?(U[p.role]||(U[p.role]={}),U[p.role][p.id]=p,D[p.id]=p,p.publishstate>TK.PUBLISH_STATE_NONE&&(l(p.publishstate),g.publish(v))):8==A?k():0==A&&k())}function F(a){if(z)for(b in a)a[b].playbackLeaved=!0;else for(var b in a)delete a[b]}function P(a){if(!z)for(var b in a)delete a[b]}function B(a,b,c,d,e,f){var q=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");q.open(a,b,c);q.setRequestHeader("Content-Type",f?f:"application/x-www-form-urlencoded;charset\x3dutf-8");
q.send(d);q.onreadystatechange=e;return q}function G(a,b,c,d){c=Number(c);d=Number(d);a=c+1;ea=Ta[a][0];na=Ta[a][1];fa=10>d?10:30<d?30:d;Fa=Y(ea,fa);pa.setAVMgrProperty({room_video_width:ea,room_video_height:na,room_video_fps:fa});L.Logger.info("[tk-sdk]video config[_room_video_width * _room_video_height  , _room_video_fps , _room_video_maxbps]:"+ea+"*"+na+", "+fa+", "+Fa)}function Y(a,b){return 80>=a?20>b?64:96:176>=a?20>b?128:192:320>=a?20>b?256:384:640>=a?20>b?384:512:1280>=a?15>b?1024:15<=b&&
20>=b?1280:1536:15>b?1280:15<=b&&20>=b?1536:2048}function J(a,b,c){u(2);if(void 0==V)c(3,null);else{L.Logger.debug("[tk-sdk]Going to getConfig");b=M+"://"+a+":"+b+"/ClientAPI/getconfig?ts\x3d"+(new Date).getTime();var q=B("POST",b,!0,"serial\x3d"+V+"\x26userrole\x3d"+p.role,function(){if(4==q.readyState)if(200==q.status){var b=L.Utils.toJsonParse(q.responseText);L.Logger.debug("[tk-sdk]getConfig resp \x3d ",L.Utils.toJsonStringify(b));sb=b;var d=a,e="8889";if(void 0===fb||void 0===gb){if(void 0!==
b.courseserver){var f=b.courseserver;null!==f&&void 0!==f&&0<f.length&&(d=f)}void 0!==b.courseserverport&&(e=/https/g.test(M)?Number(b.courseserverport):Number(b.courseserverport)+1)}else d=fb,e=gb;m({socket_host:d,socket_port:e});La?b.LiveDocServerAddr&&(cb=b.LiveDocServerAddr,m({doc_host:b.LiveDocServerAddr})):b.ClassDocServerAddr&&(cb=b.ClassDocServerAddr,m({doc_host:b.ClassDocServerAddr}));La?b.LiveDocServerAddrBackup&&(db=b.LiveDocServerAddrBackup,m({backup_doc_host:b.LiveDocServerAddrBackup})):
b.ClassDocServerAddrBackup&&(db=b.ClassDocServerAddrBackup,m({backup_doc_host:b.ClassDocServerAddrBackup}));X=$a+"://"+ab+":"+bb;ca(d,tb);L.Logger.debug("[tk-sdk]_room_uri \x3d "+X);c(b?0:3,q.responseText)}else L.Logger.error("[tk-sdk]getConfig fail[readyState-status]:",q.readyState,q.status),c(3,q.responseText)})}}function Z(a,b,c){if(void 0===V)c(3,void 0);else if(ub){L.Logger.debug("[tk-sdk]Going to getFileList");a=M+"://"+a+":"+b+"/ClientAPI/getroomfile?ts\x3d"+(new Date).getTime();var q=B("POST",
a,!0,"serial\x3d"+V,function(){if(4==q.readyState)if(200==q.status){var a=L.Utils.toJsonParse(q.responseText);L.Logger.debug("[tk-sdk]getFileList resp \x3d ",L.Utils.toJsonStringify(a));var b=a.result,d;0==b&&void 0!==a.roomfile?d=a.roomfile:L.Logger.info("[tk-sdk]getFileList resp.roomfile is not exist , nRet:"+b);c(b,d)}else L.Logger.error("[tk-sdk]getFileList fail[readyState-status]:",q.readyState,q.status),c(3,void 0)})}else c(-1,void 0)}function ca(a,b){vb&&(b=M+"://"+a+":"+b+"/where.html?ts\x3d"+
(new Date).getTime(),Ua=La||/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?!1:!0,$.ajax({url:b,type:"get",async:!1}).done(function(a){L.Logger.info("[tk-sdk]getFalsificationIp resp :",window.__TkSdkBuild__?L.Utils.encrypt("object"===typeof a?L.Utils.toJsonStringify(a):a):"object"===typeof a?L.Utils.toJsonStringify(a):a);"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&"object"===typeof a?(a.name&&"string"===typeof a.name&&(S=wb=a.name.replace(/(^\s*)|(\s*$)/g,"")),a.nochange?(Ua=!1,L.Logger.info("[tk-sdk]no strings change SDP  , ipFalsificationName is "+
wb)):a.ip&&"string"===typeof a.ip&&(Va=a.ip.replace(/(^\s*)|(\s*$)/g,""))):L.Logger.warning("[tk-sdk]getFalsificationIp resp not is json")}).fail(function(a){L.Logger.error("[tk-sdk]getFalsificationIp fail:",a)}))}function K(a,b){L.Logger.debug("[tk-sdk]step3Connect");3<=A||(u(3),L.Logger.info("[tk-sdk]socket connect address:"+(window.__TkSdkBuild__?L.Utils.encrypt(X):X)),da=!1,N&&N.changeCommonWhiteBoardConfigration&&N.changeCommonWhiteBoardConfigration({isConnectedRoom:da}),Hb(X,H._handler_connectSocketSuccess,
function(a){L.Logger.error("[tk-sdk]Not Connected! Error: "+a);a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.ROOMCONNECTERROR,error:a}});g.dispatchEvent(a)}))}function W(a,b){if(!(5<=A))if(void 0==p.id||void 0==V)L.Logger.error("[tk-sdk]Invalid status",p,V);else{u(5);p&&(S&&(p.servername=S),p.udpstate=L.Constant.udpState.ok);var c={},q;for(q in p)"id"!=q&&"watchStatus"!=q&&(c[q]=p[q]);c={userId:p.id,roomId:V,maxVideo:ta,videofps:fa,videowidth:ea,videoheight:na,properties:c,
roomtype:T.roomtype};if(z){if(!Wa){L.Logger.error("[tk-sdk]The playback file address does not exist!");return}c.recordfilepath=Wa}L.Logger.info("joinRoom params info:"+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c)));ba("joinRoom",c,a,b)}}function pb(a,b,c){L.Logger.debug("[tk-sdk]Going to webInterfaceGetserver");a=M+"://"+a+":"+b+"/ClientAPI/getserverarea?ts\x3d"+(new Date).getTime();$.ajax({url:a,type:"post",async:!0}).done(function(a){L.Logger.info("[tk-sdk]webInterfaceGetserver resp \x3d ",
window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(a)):L.Utils.toJsonStringify(a));a=L.Utils.toJsonParse(a);var b=a.result;O={};if(0==b&&void 0!==a.serverarealist)for(var q in a.serverarealist){var d=a.serverarealist[q];O[d.serverareaname]=d}else L.Logger.info("[tk-sdk]webInterfaceGetserver resp.serverarealist is not exist , nRet:"+b);c(b,L.Utils.toJsonStringify(a))}).fail(function(a){L.Logger.error("[tk-sdk]webInterfaceGetserver fail[readyState-status]:",a);c(3,void 0)})}function Fb(a,
b,c){var q=void 0,d=!1,e=M+"://"+y+":"+C+"/ClientAPI/uploaddocument?ts\x3d"+(new Date).getTime();if(a)return a&&"object"===typeof a&&"function"===typeof a.get?q=a.get("fieltype"):a&&"object"===typeof a&&void 0!==a.fieltype&&(q=a.fieltype),a&&"object"===typeof a&&"function"===typeof a.get?d=1===Number(a.get("writedb")):a&&"object"===typeof a&&void 0!==a.writedb&&(d=1===Number(a.writedb)),$.ajax({url:e,dataType:"json",type:"POST",data:a,async:!0,processData:!1,contentType:!1,xhr:function(){var a=$.ajaxSettings.xhr();
if(a.upload)return c&&"function"===typeof c&&(L.Utils.removeEvent(a.upload,"progress",xb.bind(g,c),!1),L.Utils.addEvent(a.upload,"progress",xb.bind(g,c),!1)),a}}).done(function(a){L.Logger.debug("[tk-sdk]uploadFile resp \x3d ",L.Utils.toJsonStringify(a));var c=a.result;if(0===c&&d){var e=L.Utils.toJsonParse(L.Utils.toJsonStringify(a));delete e.result;e.filetype=e.filetype||q;xa(e,!1)}b&&"function"===typeof b&&b(c,a)}).fail(function(a,c,q){L.Logger.error("[tk-sdk]uploadFile fail[ jqXHR , textStatus , errorThrown ]:",
a,c,q);b&&"function"===typeof b&&b(3,void 0)});L.Logger.error("[tk-sdk]uploadFile formData is required!")}function xa(a,b){if(a&&"object"===typeof a){var c=Number(a.fileprop),q=a.filetype&&"string"===typeof a.filetype?a.filetype.toLocaleLowerCase():a.filetype,d=1===c||2===c;c=3===c;var e=!d&&!c,f=/(mp3|mp4|webm)/g.test(q);a={name:"DocumentChange",id:"DocumentChange",toID:b?"__all":"__allExceptSender",data:L.Utils.toJsonStringify({isDel:b,isGeneralFile:e,isMedia:f,isDynamicPPT:d,isH5Document:c,action:"",
mediaType:f?q:"",filedata:{fileid:Number(a.fileid),currpage:1,pagenum:Number(a.pagenum),filetype:q,filename:a.filename,swfpath:d||c?a.downloadpath:a.swfpath,pptslide:1,pptstep:0,steptotal:0,filecategory:void 0!==a.filecategory?Number(a.filecategory):0}}),save:!1};g.pubMsg(a)}}function Pa(a,b){var c=M+"://"+y+":"+C+"/ClientAPI/delroomfile?ts\x3d"+(new Date).getTime();void 0===a||null===a?L.Logger.error("[tk-sdk]deleteFile fileid is required!"):$.ajax({url:c,dataType:"json",type:"POST",anync:!1,data:{serial:T.serial,
fileid:a}}).done(function(c){L.Logger.debug("[tk-sdk]deleteFile resp \x3d ",L.Utils.toJsonStringify(c));var q=c.result,d;a:{for(d=0;d<R.length;d++)if(R[d].fileid==a){d={file:R[d],index:d};break a}d=void 0}0===q&&d&&d.file&&"object"===typeof d.file&&(d=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.file)),xa(d,!0));b&&"function"===typeof b&&b(q,c)}).fail(function(a,c,q){L.Logger.error("[tk-sdk]deleteFile fail[ jqXHR , textStatus , errorThrown ]:",a,c,q);b(3,void 0)})}function Ja(){TK.DeviceMgr.getUserMedia(function(a){if(v.stream){for(var b in a)/^customdata_/g.test(b)&&
(v.stream[b]=a[b]);var c=v.stream.getTracks();for(b=0;b<c.length;b++){var q=c[b];q.stop();v.stream.removeTrack(q)}a=a.getTracks();for(b=0;b<a.length;b++)q=a[b],v.stream.addTrack(q)}else v.stream=a;v.mediaStreamClone=v.stream&&"function"===typeof v.stream.clone?v.stream.clone():v.stream;v.player&&v.player.changeMediaStreamUrl(v.stream);var d=void 0!==p.publishstate&&null!==p.publishstate?p.publishstate:TK.PUBLISH_STATE_NONE;d>TK.PUBLISH_STATE_NONE&&g.unpublish(v,function(a,b){r(!0);w(!0);p._audiopublished_=
!1;p._videopublished_=!1;void 0!=a&&(l(p.publishstate),d>TK.PUBLISH_STATE_NONE&&g.publish(v))})},void 0,void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1})}function ob(a){clearTimeout(g._deviceChangeCallbackTimer);g._deviceChangeCallbackTimer=setTimeout(function(){if(da&&p&&void 0!=p.id&&D[p.id]&&!z){var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);TK.DeviceMgr.enumerateDevices(function(c){c=
c.hasdevice;var q={},d=!1,e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);p.hasvideo!==c.videoinput&&(q.hasvideo=c.videoinput,d=!0);p.hasaudio!==c.audioinput&&(q.hasaudio=c.audioinput,d=!0);d?(L.Logger.info("[tk-sdk]change device:my old device info  [hasvideo , hasaudio] is ["+p.hasvideo+" ,"+p.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(q)),0===g.changeUserProperty(p.id,"__all",q)&&(void 0!=
q.hasvideo&&p.hasvideo!==q.hasvideo&&(p.hasvideo=q.hasvideo),void 0!=q.hasaudio&&p.hasaudio!==q.hasaudio&&(p.hasaudio=q.hasaudio)),v&&(v.hasVideo()!==p.hasvideo&&v.changeVideo(p.hasvideo),v.hasAudio()!==p.hasaudio&&v.changeAudio(p.hasaudio)),Ja()):a===e&&b===f||Ja()},{isSetlocalStorage:!0})}var c=document.getElementsByTagName("audio"),q=document.getElementsByTagName("video"),d=[];if(c&&0<c.length)for(var e=0;e<c.length;e++)d.push(c[e]);if(q&&0<q.length)for(e=0;e<q.length;e++)d.push(q[e]);0<d.length&&
TK.DeviceMgr.setElementSinkIdToAudioouputDevice(d);g.dispatchEvent({type:"device_change"})},250)}function Ea(a){if(!Ua||!Va)return a;if("offer"===a.type||"candidate"===a.type){var b=L.Utils.toJsonStringify(a),c=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;c.test(b)&&(a=L.Utils.toJsonParse(b.replace(c,"254.254.254.254")))}return a}function Ib(a,b){var c=!1,q=!1,d=0;q=a.getID()!==v.getID();var e=0,f={frameWidth:0,frameHeight:0},Q=0,l=0,g=d=0,k=0,h=0,m=
0,u=0,t=0,n=0,p=0,r=0,F=0,w=0,P=0,W=0,B=0,G=0,K=function(a){"ssrc"===a.type&&"video"===a.mediaType&&(/send/g.test(a.id)?(t=a.bytesSent,n=a.packetsSent,g=Number(a.googRtt),B=Number(a.googNacksReceived),k=Number(a.googFrameWidthSent),h=Number(a.googFrameHeightSent),u=Number(a.googFrameRateSent),m=a.timestamp,q=!1):/recv/g.test(a.id)&&(p=Number(a.bytesReceived),W=Number(a.packetsReceived),G=Number(a.googNacksSent),r=Number(a.googCurrentDelayMs),F=Number(a.googFrameWidthReceived),w=Number(a.googFrameHeightReceived),
P=Number(a.googFrameRateReceived),m=a.timestamp,q=!0))};if(b&&"object"===typeof b&&b.forEach)b.forEach(function(a,b){K(a)});else for(var ca in b)K(b[ca]);a.report||(a.report={},c=!0);a.report.timestamp=a.report.timestamp||m;q?(a.report.bytesReceived=a.report.bytesReceived||p,a.report.packetsReceived=a.report.packetsReceived||W,a.report.googNacksSent=a.report.googNacksSent||G):(a.report.bytesSent=a.report.bytesSent||t,a.report.packetsSent=a.report.packetsSent||n,a.report.googNacksReceived=a.report.googNacksReceived||
B);if(!c)return q?(d=8*(p-a.report.bytesReceived),f.frameWidth=isNaN(k)?0:F,f.frameHeight=isNaN(h)?0:w,Q=P,e=r,l=(G-a.report.googNacksSent)/(W-a.report.packetsReceived)*100):(d=8*(t-a.report.bytesSent),f.frameWidth=isNaN(k)?0:k,f.frameHeight=isNaN(h)?0:h,Q=u,e=g,l=(B-a.report.googNacksReceived)/(n-a.report.packetsSent)*100),d=d/((m-a.report.timestamp)/1E3)/1024,q?(a.report.bytesReceived=p,a.report.packetsReceived=W,a.report.googNacksSent=G):(a.report.bytesSent=t,a.report.packetsSent=n,a.report.googNacksReceived=
B),a.report.timestamp=m,{kbps:isNaN(d)?0:Math.round(d),frameRatio:f,frameRate:isNaN(Q)?0:Math.round(Q),packetsLost:isNaN(l)?0:100>=Math.round(l)?Math.round(l):100,rtt:isNaN(e)?0:e}}function xb(a,b){var c=Math.floor(100*b.loaded/b.total);a&&"function"===typeof a&&a(b,c)}function yb(a,b,c){var q={},d=a.result;if(0==d){z&&(a.nickname="playback",a.roomrole=-1,a.thirdid=hb()+":playback");var e=a.room;var f=a.pullinfo;if(void 0===e.serial)d=-1;else{e.roomtype=Number(e.roomtype);e.maxvideo=parseInt(e.maxvideo);
a.roomrole=Number(a.roomrole);var Q={},l={};if(f&&f.data&&f.data.pullConfigureList){var ya=f.data.pullConfigureList,g;for(g in ya){var k=ya[g];Q[k.pullProtocol]=k.pullUrlList}}if(f&&f.data&&f.data.pushConfigureInfo)for(g in f=f.data.pushConfigureInfo,f)ya=f[g],l[ya.pushProtocol]=ya.pushUrl;e.pullConfigure=Q;e.pushConfigure=l;T=e;ib=e.roomname;Ma=e.roomtype;La=10===Ma;ta=e.maxvideo;q.properties={};q.properties.role=a.roomrole;q.properties.nickname=a.nickname;Q=a.thirdid;q.id=void 0!==Q&&"0"!=Q&&""!=
Q?Q:c?c:hb();"string"!==typeof q.id&&(q.id=""+q.id+"");Q=void 0;L.Utils.isNull(p.id)||!L.Utils.isNull(c)&&""!==c||(Q=p.id);p=TK.RoomUser(q);L.Utils.isNull(Q)||(p.id=Q);L.Utils.isNull(v)||(v.extensionId=p.id);L.Utils.isNull(I._local_default_extension_id_)||(c=I._local_default_extension_id_,delete I._local_default_extension_id_,I[p.id]=c);""!==jb&&(p.nickname=jb);z?(p.hasvideo=!1,p.hasaudio=!1):(L.Logger.info("[tk-sdk]call enumerateDevices to checkroom set myself.hasvideo and  myself.hasaudio start!"),
pa.enumerateDevices(function(a){L.Logger.info("[tk-sdk]call enumerateDevices to checkroom set myself.hasvideo and  myself.hasaudio finshed!");a=a.hasdevice;p.hasvideo=a.videoinput;p.hasaudio=a.audioinput}));z?(V=e.serial+"_"+p.id)&&-1===V.indexOf(":playback")&&(V+=":playback"):V=e.serial;z||(G(Ma,p.role,e.videotype,e.videoframerate),La&&3===a.roomrole&&(vb=!1));Na=a?"string"===typeof a?a:L.Utils.toJsonStringify(a):"";TK.isTkNative&&!va&&(va=!0,tknative.postMessage({command:"initNative",localId:p.id.toString(),
width:Number(ea),height:Number(na),fps:Number(fa),roomInfo:Na,webAddr:y.toString(),webPort:C.toString()}));L.Logger.info("[tk-sdk]"+(z?"initPlaybackInfo to checkroom finshed--\x3e":"")+"_room_max_videocount:"+ta,"my id:"+p.id,"room id:"+V,"room properties chairmancontrol is:"+(T.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(T.chairmancontrol):T.chairmancontrol:void 0))}}else L.Logger.warning("[tk-sdk]checkroom failure code is "+d);L.Logger.info("[tk-sdk]checkroom finshed!");b(d,q,a)}function Xa(a){if(a.extensionId&&
a.extensionId!==p.id&&D[a.extensionId]&&"video"===a.getAttributes().type&&a.stream){var b=D[a.extensionId];if(b.publishstate!==TK.PUBLISH_STATE_NONE)switch(b.publishstate){case TK.PUBLISH_STATE_VIDEOONLY:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!0);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!1);break;case TK.PUBLISH_STATE_AUDIOONLY:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!1);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!0);break;case TK.PUBLISH_STATE_BOTH:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,
!0);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!0);break;case TK.PUBLISH_STATE_MUTEALL:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!1),TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!1)}}}function oa(){if(void 0===TK.nativeCallSeq||"number"!==typeof TK.nativeCallSeq)TK.nativeCallSeq=0;return++TK.nativeCallSeq}function hb(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function eb(a){void 0!==a.stream&&(a.hide(),
a.pc&&(a.pc.close(),delete a.pc),a.local&&a.stream.stop(),delete a.stream)}function qb(a,b){a.local?ba("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("[tk-sdk]You can not send data through a remote stream")}function rb(a,b){a&&"object"===typeof b&&(g.remoteStreams[a.getID()]?(a.local&&a.updateLocalAttributes(b),ba("updateStreamAttributes",{id:a.getID(),attrs:b})):L.Logger.warning("[tk-sdk]You can not update attributes to server, because the stream does not exist on the server."))}function Hb(a,
c,d){var q=function(a,b){a.pc=TK.Connection({callback:function(c){c=Ea(c);ia("signaling_message",{streamId:a.getID(),peerSocket:b,msg:c})},iceServers:g.iceServers,maxAudioBW:E.maxAudioBW,maxVideoBW:"screen"===a.getAttributes().type?E.maxScreenBW:"file"===a.getAttributes().type?E.maxLocalFileMediaBW:E.maxVideoBW,limitMaxAudioBW:E.maxAudioBW,limitMaxVideoBW:"screen"===a.getAttributes().type?E.maxScreenBW:"file"===a.getAttributes().type?E.maxLocalFileMediaBW:E.maxVideoBW,cnnId:a.extensionId},a.isTkNative);
a.pc.onaddstream=function(b){g.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream,sa&&g.rtcStatsrObserver(a),a.extensionId!==p.id&&"video"===a.getAttributes().type&&Xa(a),b=TK.StreamEvent({type:"stream-subscribed",stream:a}),L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream), stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
g.dispatchEvent(b),"video"===a.getAttributes().type&&(Aa(a),b=g.getUser(a.publisherId()),void 0!==b&&(b._audiopublished_=!a.audioMuted,b._videopublished_=!a.videoMuted))):L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream):remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))}};g.state=1;g.socket=io.connect(X,
{secure:!0,reconnection:!0,transports:["websocket"]});g.socket.on("connect",function(){L.Logger.debug("[tk-sdk]tk connectd");g.state=2;u(4);if(0===Ya||g.needReconnectSocket)g.socket.on("onAddStream",function(a){var b=!1,c=!1;"media"===a.attributes.type?b=!0:a.attributes.type&&(b=a.extensionId.replace(new RegExp(":"+a.attributes.type,"g"),"")===p.id?!1:!0);TK.subscribe_from_native&&b&&(c=!0);c=TK.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes,
extensionId:a.extensionId,room:g,checkMyAudioAndVideoEnable:function(a){p&&p.id&&(a=a||p.id,a===p.id&&(TK.isTkNative&&(r(!0),w(!0)),p.publishstate>TK.PUBLISH_STATE_NONE&&l()))}},c);for(var q in g.remoteStreams)g.remoteStreams[q]&&g.remoteStreams[q].extensionId===c.extensionId&&delete g.remoteStreams[q];g.remoteStreams[a.id]=c;c.extensionId===p.id&&(g.publishedDefaultStream=c);b&&g.subscribe(c);sa&&a.extensionId===p.id&&g.rtcStatsrObserver(c);p.id===c.extensionId&&l(p.publishstate);a=TK.StreamEvent({type:"stream-added",
stream:c});L.Logger.info("[tk-sdk]stream-added , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));g.dispatchEvent(a);c.publisherId()===p.id&&"video"===c.getAttributes().type&&(Aa(v),p._audiopublished_=!v.audioMuted,p._videopublished_=!v.videoMuted)}),g.socket.on("signaling_message_mediaserver",function(a){L.Logger.debug("[tk-sdk]signaling_message_mediaserver",a);var c=a.mess;if(Ua&&Va&&"answer"===c.type){var q=L.Utils.toJsonStringify(c),
d=Va,e=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;e.test(q)&&(c=L.Utils.toJsonParse(q.replace(e,d)))}a.mess=c;a.peerId?(c=g.remoteStreams[a.peerId],!b.autoSubscribeAV&&a&&a.mess&&"started"===a.mess.type&&(c.video&&c.muteVideo(!0),c.audio&&c.muteAudio(!0))):c=g.localStreams[a.streamId];a&&a.mess&&"ready"===a.mess.type&&(c.isCompleted=!0,c.reconnectionNumber=0,p.udpstate!==L.Constant.udpState.ok&&g.changeUserProperty(p.id,"__all",{udpstate:L.Constant.udpState.ok}),
TK.isTkNative&&TK.subscribe_from_native&&c&&c.hideLoading&&c.hideLoading());c&&!c.failed&&(c.pc&&c.pc.processSignalingMessage?c.pc.processSignalingMessage(a.mess,c):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),g.socket.on("signaling_message_peer",function(a){var b=g.localStreams[a.streamId];L.Logger.debug("signaling_message_peer",a);b&&!b.failed?b.pc[a.peerSocket].processSignalingMessage(a.msg):(b=g.remoteStreams[a.streamId],b.pc||q(b,a.peerSocket),b.pc&&
b.pc.processSignalingMessage?b.pc.processSignalingMessage(a.msg):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),g.socket.on("publish_me",function(a){var b=g.localStreams[a.streamId];void 0===b.pc&&(b.pc={});b.pc[a.peerSocket]=TK.Connection({callback:function(b){b=Ea(b);ia("signaling_message",{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:b.hasAudio(),video:b.hasVideo(),media:b.hasMedia(),iceServers:g.iceServers,cnnId:b.extensionId},TK.isTkNative);
b.pc[a.peerSocket].oniceconnectionstatechange=function(c){"failed"===c&&(b.pc[a.peerSocket].close(),delete b.pc[a.peerSocket])};b.pc[a.peerSocket].addStream(b.stream);b.pc[a.peerSocket].createOffer()}),g.socket.on("onBandwidthAlert",function(a){L.Logger.debug("[tk-sdk]Bandwidth Alert on",a.streamID,"message",a.message,"BW:",a.bandwidth);if(a.streamID){var b=g.remoteStreams[a.streamID];b&&!b.failed&&(a=TK.StreamEvent({type:"bandwidth-alert",stream:b,message:a.message,bandwidth:a.bandwidth}),g.dispatchEvent(a))}}),
g.socket.on("onDataStream",function(a){a=TK.StreamEvent({type:"stream-data",message:a.msg,stream:g.remoteStreams[a.id]});g.dispatchEvent(a)}),g.socket.on("onUpdateAttributeStream",function(a){var b=g.remoteStreams[a.id],c=TK.StreamEvent({type:"stream-attributes-update",attrs:a.attrs,stream:b});void 0!==b?(b.updateLocalAttributes(a.attrs),g.dispatchEvent(c)):L.Logger.warning("[tk-sdk]onUpdateAttributeStream stream invalid",a)}),g.socket.on("publish_failed",function(a){L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed server info: "+
L.Utils.toJsonStringify(a));var b=g.localStreams[a.streamId];g.localStreams[a.streamId]&&(g.localStreams[a.streamId].peerConnectionStream=void 0);delete g.localStreams[a.streamId];b?(a=TK.StreamEvent({type:"stream-publish_mediaserver_failed",stream:b}),L.Logger.info("[tk-sdk]stream-publish_mediaserver_failed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(a)):L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed stream is not exist , server info: "+
L.Utils.toJsonStringify(a))}),g.socket.on("subscribe_failed",function(a){L.Logger.warning("[tk-sdk]stream-subscribe_mediaserver_failed server info: "+L.Utils.toJsonStringify(a));var b=g.remoteStreams[a.streamId];b?(a=TK.StreamEvent({type:"stream-subscribe_mediaserver_failed",stream:b}),L.Logger.info("[tk-sdk]stream-subscribe_mediaserver_failed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(a)):L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed stream is not exist , server info: "+
L.Utils.toJsonStringify(a))}),g.socket.on("onRemoveStream",function(a){var b=g.remoteStreams[a.id];b&&b.failed?L.Logger.debug("[tk-sdk]Received onRemoveStream for a stream that we already marked as failed ",a.id):b?(g.localStreams[a.id]&&(g.localStreams[a.id].peerConnectionStream=void 0),b&&b.stop&&b.stop(),delete g.remoteStreams[a.id],delete g.localStreams[a.id],eb(b),a=TK.StreamEvent({type:"stream-removed",stream:b}),L.Logger.info("[tk-sdk]stream-removed , stream id:"+b.getID()+" , extensionId is "+
b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(a),"video"===b.getAttributes().type?(Aa(b,!0),b=g.getUser(b.publisherId()),void 0!==b&&(b._audiopublished_=!1,b._videopublished_=!1)):za(b,!1)):L.Logger.debug("[tk-sdk]Received a removeStream for",a.id,"and it has not been registered here, ignoring.")}),g.socket.on("disconnect",function(a){g.needReconnectSocket||(L.Logger.debug("[tk-sdk]Socket disconnected, lost connection to TKController",a),0!==g.state&&(u(8),
g.state=0,sa&&g.stopIntervalRtcStatsrObserver(),v.rtcStatsrObserverTimer&&g.stopIntervalRtcStatsrObserverByStream(v),TK.isTkNative&&(va=!1,tknative.postMessage({command:"nativeClear"})),Da=!1,a=TK.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"}),g.dispatchEvent(a)))}),g.socket.on("connection_failed",function(a){L.Logger.debug("[tk-sdk]Socket connection_failed , arg is "+L.Utils.toJsonStringify(a))}),g.socket.on("error",function(a){L.Logger.error("[tk-sdk]Cannot connect to Controller");
d&&d("Cannot connect to TKController (socket.io error)",a)}),g.socket.on("reconnecting",function(a){L.Logger.debug("[tk-sdk]reconnecting info:",a);a=TK.RoomEvent({type:"room-reconnecting",message:{number:a,info:"room-reconnecting number:"+a}});g.dispatchEvent(a)}),g.socket.on("participantLeft",H._handler_participantLeft),g.socket.on("participantJoined",H._handler_participantJoined),g.socket.on("participantEvicted",function(a){a=a||{};L.Logger.info("[tk-sdk]user evicted room  , user info: "+L.Utils.toJsonStringify(p)+
" , participantEvicted  messages:"+L.Utils.toJsonStringify(a));g.leaveroom(!0);a=TK.RoomEvent({type:"room-participant_evicted",message:a,user:p});g.dispatchEvent(a)}),g.socket.on("sendMessage",H._handler_sendMessage),g.socket.on("msgList",function(a){L.Logger.debug("[tk-sdk]msgList info:",L.Utils.toJsonStringify(a));a=TK.RoomEvent({type:"room-msglist",message:a});g.dispatchEvent(a)}),g.socket.on("pubMsg",H._handler_pubMsg),g.socket.on("delMsg",H._handler_delMsg),g.socket.on("setProperty",H._handler_setProperty),
g.socket.on("playback_clearAll",H._handler_playback_clearAll),g.socket.on("duration",H._handler_duration),g.socket.on("playbackEnd",H._handler_playbackEnd),g.socket.on("playback_updatetime",H._handler_playback_updatetime),g.socket.on("forceReconnect",function(){L.Logger.info("[tk-sdk]service notice forceReconnect , call reconnected room! ");n({source:"forceReconnect room"},c,d)}),Ya++,L.Logger.info("[tk-sdk]connected room  , current connected number is "+Ya+"! "),g.needReconnectSocket||L.Logger.info("[tk-sdk]Reconnect Socket ,  join room start! "),
g.needReconnectSocket=!1,W(c,d);else{L.Logger.info("[tk-sdk]reconnected room! ");var a=TK.RoomEvent({type:"room-reconnected"});g.dispatchEvent(a);n({source:"reconnected room"},c,d)}})}function ba(a,b,c,d){L.Logger.debug("[tk-sdk]sendMessageSocket",a,b);g.socket.emit(a,b,function(a,q){"success"===a?(L.Logger.debug("[tk-sdk]sendMessageSocket success",b,q),c&&c(q)):"error"===a?d&&d(q):c&&c(a,q)})}function ia(a,b,c,d){0!==g.state?g.socket.emit(a,b,c,function(a,b){d&&d(a,b)}):L.Logger.warning("[tk-sdk]Trying to send a message over a disconnected Socket")}
function wa(a){var b=!1;a&&a.getAttributes&&a.getAttributes()&&a.extensionId&&("media"===a.getAttributes().type?b=!1:a.getAttributes().type&&(b=new RegExp(":"+a.getAttributes().type,"g"),a=a.extensionId.replace(b,""),b=a===p.id||"_local_default_extension_id_"===a));return b}function ha(a,b){var c=void 0;if("media"===b)for(var q in g.remoteStreams){var d=g.remoteStreams[q];if(d.extensionId===a+":"+b){c=d;break}}else if(b)if(a===p.id||"_local_default_extension_id_"===a)c="video"===b?v:Ka[a+":"+b];else for(q in g.remoteStreams)if(d=
g.remoteStreams[q],"video"===b){if(d.extensionId===a){c=d;break}}else if(d.extensionId===a+":"+b){c=d;break}return c}function qa(a,b,c){c=c||{};b.playInfo=b.playInfo||{video:!1,audio:!1};void 0!==c.video&&(TK.isOnlyAudioRoom&&(c.video=!1),b.playInfo.video=c.video);void 0!==c.audio&&(b.playInfo.audio=c.audio);b&&b.player?a!==b.player.elementID&&(b.stop(),b.play(a,c),I[b.extensionId]=b):(b.play(a,c),I[b.extensionId]=b);b.video&&(b.playInfo.video?(b.updateVideoPlayerOptions(c),b.show()):b.hide());"video"!==
b.getAttributes().type&&b.audio&&(b.playInfo.audio?b.setMute(!1):b.setMute(!0));wa(b)||(b.video&&b.muteVideo(!b.playInfo.video),b.audio&&b.muteAudio(!b.playInfo.audio))}function Ga(a,b){b=b||{};a.playInfo=a.playInfo||{video:!1,audio:!1};void 0!==b.video&&a.playInfo.video&&b.video&&(a.playInfo.video=!b.video,a.video&&(a.playInfo.video?a.show():a.hide()),wa(a)||a.video&&a.muteVideo(!a.playInfo.video));void 0!==b.audio&&a.playInfo.audio&&b.audio&&(a.playInfo.audio=!b.audio,"video"!==a.getAttributes().type&&
a.audio&&(a.playInfo.audio?a.setMute(!1):a.setMute(!0)),wa(a)||a.audio&&a.muteAudio(!a.playInfo.audio));a&&a.stop&&!a.playInfo.video&&!a.playInfo.audio&&(a.stop(),delete I[a.extensionId])}function Jb(a,b){return"string"!==typeof a?a:a.replace(new RegExp(":"+b,"g"))}function Ca(a,b){var c={};b=b||{};var q={type:a};if(b.attributes&&"object"===typeof b.attributes)for(var d in b.attributes)"type"!==d&&(q[d]=b.attributes[d]);c.audio=b.audio||!1;c.video=b.video||!1;c.data=!1;c.attributes=q;switch(a){case "video":c.screen=
!1;c.media=!1;c.extensionId=L.Utils.isNull(p.id)?"_local_default_extension_id_":p.id;break;case "screen":c.screen=!0;c.media=!1;c.extensionId=p.id+":"+a;break;case "file":c.screen=!1,c.media=!0,c.path=b.path,c.extensionId=p.id+":"+a}b=TK.Stream(c,TK.isTkNative);return Ka[p.id+":"+a]=b}function kb(a){if(TK.isOnlyAudioRoom!==a){TK.isOnlyAudioRoom=a;if(TK.isOnlyAudioRoom)for(var b in g.remoteStreams)a=g.remoteStreams[b],"file"===a.getAttributes().type&&a.extensionId===p.id+":file"?g.unpublishLocalFile(a):
"screen"===a.getAttributes().type&&a.extensionId===p.id+":screen"?g.unpublishScreen(a):"media"===a.getAttributes().type&&a.extensionId===p.id+":media"&&!0===a.video&&g.unpublishMedia(a);v&&(p.publishstate>TK.PUBLISH_STATE_NONE?g.unpublish(v,function(a){p.publishstate>TK.PUBLISH_STATE_NONE&&(TK.isOnlyAudioRoom?p.publishstate===TK.PUBLISH_STATE_AUDIOONLY?g.publish(v):TK.isRetainPublishstateOnOnlyAudioRoom?p.publishstate===TK.PUBLISH_STATE_VIDEOONLY||p.publishstate===TK.PUBLISH_STATE_MUTEALL?p.publishstate===
TK.PUBLISH_STATE_MUTEALL?g.publish(v):g.changeUserProperty(p.id,"__all",{publishstate:TK.PUBLISH_STATE_MUTEALL}):g.changeUserProperty(p.id,"__all",{publishstate:TK.PUBLISH_STATE_AUDIOONLY}):g.changeUserProperty(p.id,"__all",{publishstate:TK.PUBLISH_STATE_AUDIOONLY}):p.publishstate===TK.PUBLISH_STATE_BOTH?g.publish(v):TK.isRetainPublishstateOnOnlyAudioRoom?p.publishstate===TK.PUBLISH_STATE_VIDEOONLY||p.publishstate===TK.PUBLISH_STATE_MUTEALL?g.publish(v):g.changeUserProperty(p.id,"__all",{publishstate:TK.PUBLISH_STATE_BOTH}):
g.changeUserProperty(p.id,"__all",{publishstate:TK.PUBLISH_STATE_BOTH}));TK.isOnlyAudioRoom?(v.hide(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!1):(v.show(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!0)}):TK.isOnlyAudioRoom?(v.hide(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!1):(v.show(),v.playInfo=v.playInfo||{video:!1,audio:!1},v.playInfo.video=!0))}}function zb(a){"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&a.data&&"string"===typeof a.data&&
(a.data=L.Utils.toJsonParse(a.data));var b=a.fromID,c=a.data;a:{for(a=0;a<R.length;a++)if(R[a].fileid==c.filedata.fileid){a={file:R[a],index:a};break a}a=void 0}if(c.isDel)a&&a.file&&(R.splice(a.index,1),b=TK.RoomEvent({type:"room-delete-file",message:{fileid:a.file.fileid,fileinfo:a.file,fromID:b}}),g.dispatchEvent(b));else{var q=D[b],d=c.filedata;c={fileid:Number(d.fileid),companyid:T.companyid,filename:d.filename,uploaduserid:b,uploadusername:q?q.nickname:"",downloadpath:d.swfpath,swfpath:d.swfpath,
filetype:d.filetype&&"string"===typeof d.filetype?d.filetype.toLocaleLowerCase():d.filetype,pagenum:Number(d.pagenum),dynamicppt:c.isDynamicPPT?1:0,filecategory:Number(d.filecategory),fileprop:c.isDynamicPPT?2:c.isH5Document?3:0,type:0};if(a){q={};d=!1;for(var e in c)a.file[e]!==c[e]&&(a.file[e]=c[e],q[e]=c[e],d=!0);d&&(b=TK.RoomEvent({type:"room-update-file",message:{fileid:c.fileid,updateFileinfo:q,fromID:b}}),g.dispatchEvent(b))}else R.push(c),b=TK.RoomEvent({type:"room-add-file",message:{fileid:c.fileid,
fromID:b}}),g.dispatchEvent(b)}}function Aa(a,b){if("video"===a.getAttributes().type){void 0===b&&(b=!1);var c=g.getUser(a.publisherId());if(c){void 0===c._audiopublished_&&(c._audiopublished_=!1);void 0===c._videopublished_&&(c._videopublished_=!1);var d=c.publishstate,q=d===TK.PUBLISH_STATE_AUDIOONLY||d===TK.PUBLISH_STATE_BOTH;d=d===TK.PUBLISH_STATE_VIDEOONLY||d===TK.PUBLISH_STATE_BOTH;a.audio&&(c._audiopublished_!==q||b&&c._audiopublished_)&&(q={userId:a.publisherId(),published:b?!1:q,type:a.getAttributes().type},
q=TK.RoomEvent({type:"room-useraudiostate-changed",message:q}),g.dispatchEvent(q));a.video&&(c._videopublished_!==d||b&&c._videopublished_)&&(q={userId:a.publisherId(),published:b?!1:d,type:a.getAttributes().type},a=TK.RoomEvent({type:"room-uservideostate-changed",message:q}),g.dispatchEvent(a))}}}function Sa(a){if("video"===a.getAttributes().type){var b=g.getUser(a.publisherId());b&&(b._audiopublished_=!1,b._videopublished_=!1,a.audio&&(b={userId:a.publisherId(),published:!1,type:a.getAttributes().type},
b=TK.RoomEvent({type:"room-useraudiostate-changed",message:b}),g.dispatchEvent(b)),a.video&&(b={userId:a.publisherId(),published:!1,type:a.getAttributes().type},a=TK.RoomEvent({type:"room-uservideostate-changed",message:b}),g.dispatchEvent(a)))}}function za(a,b){if(a&&void 0!==b){var c=void 0,d={};a.getAttributes().type===TK.STREAM_MEDIA?(c="room-usermediastate-changed",d.duration=a.getAttributes().duration):a.getAttributes().type===TK.STREAM_SCREEN?c="room-userscreenstate-changed":a.getAttributes().type===
TK.STREAM_FILE&&(c="room-userfilestate-changed");void 0!==c&&(d.userId=a.publisherId(),d.published=b,d.type=a.getAttributes().type,d.attributes=a.getAttributes(),d.attributes.video=a.hasVideo(),d.attributes.audio=a.hasAudio(),a=TK.RoomEvent({type:c,message:d}),g.dispatchEvent(a))}}function Qa(a){Oa&&(qa(Ha.elementId,v,Ha.options),Oa=!1,Ha={});lb&&(p.publishstate>TK.PUBLISH_STATE_NONE?d(v):v.isPublishing=!1,lb=!1);L.Utils.isNull(a)||L.Utils.isNull(a.type)||"access-denied"===a.type&&L.Utils.isNull(a.message)||
(L.Utils.isNull(a.stream)||delete a.stream,a=TK.RoomEvent(a),g.dispatchEvent(a))}b=b||{};if("object"!==typeof b)L.Logger.error("[tk-sdk]TK.Room roomOptios must is json!");else{b.autoSubscribeAV=void 0!==b.autoSubscribeAV?b.autoSubscribeAV:!0;L.Logger.info("[tk-sdk-version]sdk-version:"+TK.SDKVERSIONS+" , sdk-time: "+TK.SDKVERSIONSTIME);var E={},g=TK.EventDispatcher(E),M="https",ua="https",$a="https",ra="https",y=void 0,Ab=void 0,Ra=void 0,Bb=void 0,C=void 0,la=void 0,ma=void 0,ab=void 0,bb=void 0,
ja=void 0,ka=void 0,X=void 0,V=void 0,Ma=0,ib=void 0,T=void 0,ea=320,na=240,fa=15,Fa=256,ta=6,sb=void 0,fb=void 0,gb=void 0,v=void 0,Ia=void 0,p={},O={},S=void 0,pa=TK.DeviceMgr,Ua=!1,vb=!0,Va=void 0,wb=void 0,z=!1,ub=!0,Wa=void 0,mb=3E3,sa=!1,Da=!1,tb=8080,Ya=0,da=!1,Cb=!0,H={},va=!1,cb=void 0,db=void 0,La=!1,Na="",Ka={},N=void 0,I={},Za={1:"video",2:"media",3:"screen",4:"file"},x={},Db=!1,jb,nb=TK.NativeProxy,Ba={},R=[];g.remoteStreams={};g.localStreams={};g.roomID="";g.socket={};g.p2p=!1;g.state=
0;var D={},U={},aa={},lb=!1,Oa=!1,Ha={},Ta=[[80,60],[200,150],[320,240],[640,480],[1280,720],[1920,1080]],A=0;TK.default_stream=v;TK.isPlayback=z;g.init=function(b){L.Logger.warning("[tk-sdk] room-sdk initializing. ",b);L.Utils.isNull(b)&&L.Logger.error("[tk-sdk] the appKey can not be empty when initializing room-sdk");b={video:!0,audio:!0};var c=function(){TK.DeviceMgr.getDevices(function(b){var c=b.devices;b=c.audioinput;c=c.videoinput;if(0===b.length){L.Logger.error("[tk-sdk] audioinput devices are un-available. reason: NotFound");
var d=TK.RoomEvent({type:"device-failure",message:{kind:"audioinput"}},{code:window.TK_ERR.DEVICE_ERROR_NotFoundError});g.dispatchEvent(d)}0===c.length&&(L.Logger.error("[tk-sdk] videoinput devices are un-available. reason: NotFound"),d=TK.RoomEvent({type:"device-failure",message:{kind:"videoinput"}},{code:window.TK_ERR.DEVICE_ERROR_NotFoundError}),g.dispatchEvent(d));0<b.length&&a(b,!0);0<c.length&&a(c,!1)})},d=function(a){a.getTracks().forEach(function(a){a.stop()});a=null;c()},q=function(a){L.Logger.warning("[tk-sdk] failed to getUserMedia when initilize the room sdk.",
a);c()};TK.isTkNative||TK.DeviceMgr.getUserMedia(d,q,b)};g.isOnlyAudioRoom=function(){return TK.isOnlyAudioRoom};g.updateProtocol=function(a){tb=/https/g.test(a)?8080:81;m({web_protocol:a,doc_protocol:a,socket_protocol:a,backup_doc_protocol:a})};g.updateRequestServerListPermission=function(a){Cb=a};g.setIsGetFileList=function(a){ub=a};g.setIsGetRtcStatsrObserver=function(a){sa=a};g.setRtcStatsrObserverTimer=function(a){mb=a};g.setLogIsDebug=function(a,b){a=a||!1;void 0!==b&&(a=0===b?!0:!1);TK.tkLogPrintConfig({debug:a},
{development:a,logLevel:void 0!==b&&"number"===typeof b?b:a?L.Constant.LOGLEVEL.DEBUG:L.Constant.LOGLEVEL.INFO},{webrtcLogDebug:a})};g.updateRoomMaxVideocount=function(a){ta=a;L.Logger.info("[tk-sdk]updateRoomMaxVideocount --\x3e update room_max_videocount to "+ta)};g.getWhiteboardManagerInstance=function(){return N};g.getFileList=function(){return R};g.getFileinfo=function(a){for(var b=void 0,c=0,d=R.length;c<d;c++)if(R[c]&&R[c].fileid==a){b=R[c];break}return b};g.getAllRoleList=function(){return U};
g.getConfigInfo=function(){return sb};g.getAVMgr=function(){return pa};g.getDeviceMgr=function(){return pa};g.getRoomMaxVideocount=function(){return ta};g.getServerName=function(){return S};g.getWebAddressInfo=function(){return{web_protocol:M,web_host:y,web_port:C,doc_protocol:ua,doc_host:la,doc_port:ma,backup_doc_protocol:ra,backup_doc_host:ja,backup_doc_port:ka}};g.getRoomType=function(){return Ma};g.getRoomName=function(){return ib};g.getRoomProperties=function(){return T};g.getMySelf=function(){return p};
g.getMyStream=function(){return v};g.getUser=function(a){if(void 0!==a)return D[a]};g.getUsers=function(){return D};g.getSpecifyRoleList=function(a){return void 0===a?(L.Logger.error("[tk-sdk]getSpecifyRoleList specifyRoleIdentification is not exist!"),{}):U[a]||{}};g.isBeyondMaxVideo=function(){var a=0,b;for(b in D)if(D[b].publishstate!==TK.PUBLISH_STATE_NONE&&++a>=ta)return!0;return!1};g.changeUserProperty=function(a,b,c){if(6!=A)return 2;if(!TK.isOnlyAudioRoom||void 0===c.publishstate||c.publishstate!==
TK.PUBLISH_STATE_VIDEOONLY&&c.publishstate!==TK.PUBLISH_STATE_BOTH){if(void 0===c||void 0===a)return L.Logger.error("[tk-sdk]changeUserProperty properties or id is not exist!"),4;var d={};d.id=a;d.toID=b||"__all";if(D[a]){if(c&&"object"===typeof c)return d.properties=c,ba("setProperty",d),0;L.Logger.error("[tk-sdk]properties must be json , user id: "+a+"!")}else L.Logger.error("[tk-sdk]user is not exist , user id: "+a+"!")}else L.Logger.warning("[tk-sdk]The publishstate of a pure audio room cannot be "+
c.publishstate+"!")};g.changeUserPublish=function(a,b){if(6!=A)return 2;if(void 0===a)return 4;a===p.id&&(p.publishstate=b);g.changeUserProperty(a,"__all",{publishstate:b});return 0};g.changeMyDisableVideoState=function(a){if("boolean"!==typeof a)L.Logger.warning("[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !");else return g.changeUserProperty(p.id,"__all",{disablevideo:a}),0};g.changeMyDisableAudioState=function(a){if("boolean"!==typeof a)L.Logger.warning("[tk-sdk]changeMyDisableAudioState:disableaudio must boolean !");
else return g.changeUserProperty(p.id,"__all",{disableaudio:a}),0};g.sendMessage=function(a,b,c){if(6!=A)return 2;var d={};d.toID=b||"__all";b={};"string"===typeof a&&(a=L.Utils.toJsonParse(a));if("object"===typeof a)for(var q in a)b[q]=a[q];else b.msg=a;"string"===typeof c&&(c=L.Utils.toJsonParse(c));if(c&&"object"===typeof c)for(q in c)b[q]=c[q];d.message=L.Utils.toJsonStringify(b);ba("sendMessage",d);return 0};g.pubMsg=function(a){if(6!=A)return 2;if(1===arguments.length&&a&&"object"===typeof a){var b=
a.name||a.msgName;var c=a.id||a.msgId;var d=a.toID||a.toId;var q=a.data;var e=a.save;var f=a.expiresabs;var l=a.associatedMsgID;var g=a.associatedUserID;var k=a.expires;var h=a.type;var m=a.write2DB;var u=a.actions;var t=a.do_not_replace}else b=arguments[0],c=arguments[1],d=arguments[2],q=arguments[3],e=arguments[4],f=arguments[5],l=arguments[6],g=arguments[7],k=arguments[8],h=arguments[9],m=arguments[10],u=arguments[11],t=arguments[12];var n={};n.name=b;n.id=c||n.name;n.toID=d||"__all";n.data=q;
e||(n.do_not_save="");void 0!==k&&"number"===typeof k&&(n.expires=k);void 0!==f&&"number"===typeof f&&(n.expiresabs=f);void 0!==l&&(n.associatedMsgID=l);void 0!==g&&(n.associatedUserID=g);void 0!==h&&(n.type=h);void 0!==m&&"boolean"===typeof m&&(n.write2DB=m);void 0!==u&&(n.actions=u);void 0!==t&&(n.do_not_replace=t);if(void 0===n.name||null===n.name)L.Logger.error("[tk-sdk]pubMsg name is must exist!");else return"DocumentChange"===n.name&&"__allExceptSender"===n.toID&&(b=L.Utils.toJsonParse(L.Utils.toJsonStringify(n)),
b.fromID=p.id,b&&b.data&&"string"===typeof b.data&&(b.data=L.Utils.toJsonParse(b.data)),b&&b.data&&"string"===typeof b.data&&(b.data=L.Utils.toJsonParse(b.data)),zb(b)),ba("pubMsg",n),0};g.delMsg=function(a){if(6!=A)return 2;if(1===arguments.length&&a&&"object"===typeof a){var b=a.name||a.msgName;var c=a.id||a.msgId;var d=a.toID||a.toId;var q=a.data}else b=arguments[0],c=arguments[1],d=arguments[2],q=arguments[3];var e={};e.name=b;e.id=c||e.name;e.toID=d||"__all";e.data=q;if(void 0===e.name||null===
e.name)L.Logger.error("[tk-sdk]delMsg name is must exist!");else if(void 0===e.id||null===e.id)L.Logger.error("[tk-sdk]delMsg id is must exist!");else return ba("delMsg",e),0};g.evictUser=function(a,b){L.Logger.debug("[tk-sdk]evictUser",a);if(6!=A)return 2;var c={};c.id=a;if(b&&"object"===typeof b)for(var d in b)c[d]=b[d];ba("evictParticipant",c);return 0};g.joinroom=function(a,b,c,d,f,l,k,h){jb=c;x=x||{};x.userProperties=l;x.video=!0;x.audio=!0;fb=k;gb=h;L.Logger.info("[tk-sdk]call joinroom start!");
g.checkroom(a,b,f,function(a,b,c){0===a?e():(a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.CHECKROOMERROR,error:a}}),g.dispatchEvent(a))},d)};g.leaveroom=function(a){a=a||!1;L.Logger.debug("[tk-sdk]leaveroom:Disconnection requested");u(8);try{g.socket&&g.socket.disconnect&&g.socket.disconnect()}catch(Q){L.Logger.debug("[tk-sdk]Socket already disconnected , disconnect errorInfo:",Q)}g.socket=void 0;da=!1;N&&N.changeCommonWhiteBoardConfigration&&N.changeCommonWhiteBoardConfigration({isConnectedRoom:da});
a=TK.RoomEvent({type:"room-leaveroom",message:a});g.dispatchEvent(a)};g.publish=function(a,b,c){if(6!=A)return L.Logger.warning("[tk-sdk]publish with wrong room status",A),2;if(a.isPublishing)c(void 0,void 0);else return a.isPublishing=!0,"video"!==a.getAttributes().type||!wa(a)||a.isInit||z||a.isIniting?"video"===a.getAttributes().type&&wa(a)&&a.isIniting?lb=!0:d(a,b,c):(L.Logger.info("[tk-sdk]publish:my stream is not init , call stream init start!"),a.init(!0,void 0,function(q){L.Logger.info("[tk-sdk]publish:my stream is not init , call stream init finshed , result is :",
L.Utils.toJsonStringify(q));Qa(q);p.publishstate>TK.PUBLISH_STATE_NONE&&d(a,b,c)})),0};g.publishMedia=function(a,b,c){if(6!=A)return L.Logger.warning("[tk-sdk]publish with wrong room status",A),2;if(TK.isOnlyAudioRoom&&a.video)L.Logger.warning("[tk-sdk]only audio room not execute method publishMedia method !");else if(L.Logger.info("[tk-sdk]calling mediaPublish stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=b||{},a&&void 0===
g.remoteStreams[a.getID()]){if(a.hasAudio()||a.hasVideo()){if(void 0!==a.url||void 0!==a.recording){a.failed&&delete a.failed;if(a.url){var d="url";var q=a.url}else d="recording",q=a.recording;L.Logger.debug("[tk-sdk]Checking publish options for",a.getID());a.checkOptions(b);ia("publish",{state:d,data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo()&&!TK.isOnlyAudioRoom,attributes:a.getAttributes(),extensionId:a.extensionId,metadata:b.metadata,createOffer:b.createOffer},q,function(d,q){if(0==d)L.Logger.debug("[tk-sdk]mediaStream published , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return q},a.id=a.getID(),a.sendData=function(b){qb(a,b)},a.setAttributes=function(b){rb(a,b)},a.room=g,c&&c(q);else{L.Logger.error("[tk-sdk]Error when publishing mediaStream",d,q);var e=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{errorCode:d,id:q,hasdata:!1}});L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));g.dispatchEvent(e);c&&c(void 0,d)}})}return 0}L.Logger.error("[tk-sdk]Audio and video in the media file stream at least one is true",a);c&&c(void 0,"Audio and video in the media file stream at least one is true")}else L.Logger.error("[tk-sdk]Trying to publish invalid mediaStream",a),c&&c(void 0,"Trying to publish invalid mediaStrea")};g.unpublish=function(a,b,c){if(6!=A)return 2;c=c||{};L.Logger.info("[tk-sdk]calling unpublish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));if(a&&!a.isUnpublishing&&g.localStreams[a.getID()])return a.isUnpublishing=!0,ba("unpublish",a.getID(),function(d,q){a.isUnpublishing=!1;a.isPublishing=!1;0!==d?(L.Logger.error("[tk-sdk]Error unpublishing stream, stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),q),d=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:q}}),
L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(d),b&&b(void 0,q)):(L.Logger.debug("[tk-sdk]Stream unpublished  , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.room=void 0,(a.hasAudio()||a.hasVideo()||a.hasScreen())&&void 0===a.url&&(a.pc&&
a.pc.close(),a.pc=void 0),a.hasScreen()&&(Da=!1),g.localStreams[a.getID()]&&(g.localStreams[a.getID()].peerConnectionStream=void 0),delete g.localStreams[a.getID()],a.getID=function(){return"local"},a.id=a.getID(),a.sendData=function(){},a.setAttributes=function(){},a.failed&&delete a.failed,b&&b(!0))}),0;L.Logger.error("[tk-sdk]unpublish error:","Cannot unpublish, stream does not exist or is not local");var d=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:"Cannot unpublish, stream does not exist or is not local"}});
L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));g.dispatchEvent(d);b&&b(void 0,"Cannot unpublish, stream does not exist or is not local")};g.unpublishMedia=function(a,b,c){if(6!=A)return 2;L.Logger.info("[tk-sdk]calling unpublishMedia , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));ba("unpublish",a.getID(),function(c,
d){0!==c?(L.Logger.error("[tk-sdk]Error unpublishing stream",d),c=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:d}}),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(c),b&&b(void 0,d)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
a.failed&&delete a.failed,b&&b(!0))});return 0};g.startServerRecord=function(a){a=a||{};var b=void 0!==a.recordChat&&"boolean"===typeof a.recordChat?a.recordChat:!0,c=L.Utils.isNull(a.recordType)?TK.REC_TYPE_RECFILE:a.recordType;c!==TK.REC_TYPE_RECFILE&&c!==TK.REC_TYPE_VIDEOLIST&&c!==TK.REC_TYPE_MP3&&c!==TK.REC_TYPE_MIXVIDEO&&(c=TK.REC_TYPE_VIDEOLIST);var d=L.Utils.isNull(a.convert)?0:a.convert;a=L.Utils.isNull(a.layout)?0:a.layout;c={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{recordtype:c,
convert:d,layout:a},save:!0};b&&(c.data.recordchat=!0);c.data=L.Utils.toJsonStringify(c.data);g.pubMsg(c)};g.stopServerRecord=function(){var a={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{}};a.data=L.Utils.toJsonStringify(a.data);g.delMsg(a)};g.sendControlMessage=function(a,b,c){a&&a.getID()&&(b={type:b||"control",action:c},ia("signaling_message",{streamId:a.getID(),msg:b}))};g.subscribe=function(a,b,c){if(6!=A)return L.Logger.warning("[tk-sdk]subscribe when not ready"),2;clearTimeout(a._subscribeTimer);
a._subscribeTimer=setTimeout(function(){g.unsubscribe(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]subscribe timeout 15s: unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(g.remoteStreams[a.getID()])if(3>a.timeoutReSubcribeNumber){L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
void 0===a.timeoutReSubcribeNumber&&(a.timeoutReSubcribeNumber=0);a.timeoutReSubcribeNumber++;L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var d=TK.StreamEvent({type:"stream-removed",stream:a,message:{timeoutSubscribeReconnection:!0,timeoutReSubcribeNumber:a.timeoutReSubcribeNumber,source:"subscribe",isNotRemote:!0}});g.dispatchEvent(d);a.getAttributes().type===
TK.STREAM_VIDEO?Sa(a):za(a,!1);g.subscribe(a,{timeoutSubscribeReconnection:!0})}else L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3ereSubscribe number \x3e 3 , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),d=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{code:"subscribeTimeout",hasdata:!1,timeoutReSubcribeNumber:a.timeoutReSubcribeNumber,hasRemoteStream:void 0!==g.remoteStreams[a.getID()]}}),g.dispatchEvent(d),
c&&c(void 0,void 0);else L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{timeoutSubscribeReconnection:!0})},15E3);b=b||{};if(!a||a.local||a.failed){var d="Error on subscribe";a?a.local?(L.Logger.warning("[tk-sdk]Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),
d="Local copy of stream"):a.failed&&(L.Logger.warning("[tk-sdk]Cannot subscribe to failed stream, you should wait a new stream-added event."),d="Failed stream"):(L.Logger.warning("[tk-sdk]Cannot subscribe to invalid stream",a),d="Invalid or undefined stream");c&&c(void 0,d)}else{if(a.hasVideo()||a.hasAudio()||a.hasScreen())a.hasVideo()||a.hasScreen()||(b.video=!1),a.hasAudio()||(b.audio=!1),b.maxVideoBW=b.maxVideoBW||E.defaultVideoBW,b.maxVideoBW>E.maxVideoBW&&(b.maxVideoBW=E.maxVideoBW),"screen"===
a.getAttributes().type?b.maxVideoBW=E.maxScreenBW:"file"===a.getAttributes().type&&(b.maxVideoBW=E.maxLocalFileMediaBW),L.Logger.debug("[tk-sdk]Checking subscribe options for",a.getID()),a.checkOptions(b),ia("subscribe",{streamId:a.getID(),audio:b.audio,video:b.video,data:b.data,browser:TK.getBrowser(),createOffer:b.createOffer,metadata:b.metadata,slideShowMode:b.slideShowMode},void 0,function(d,e){clearTimeout(a._subscribeTimer);0!==d?(L.Logger.error("[tk-sdk]Error subscribing to stream ",e),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.remoteStreams[a.getID()]?3>a.subscribeReconnectionNumber?(void 0===a.subscribeReconnectionNumber&&(a.subscribeReconnectionNumber=0),g.unsubscribe(a,function(b){setTimeout(function(){if(g.remoteStreams[a.getID()]){a.subscribeReconnectionNumber++;L.Logger.info("[tk-sdk]stream-subscribe-fail--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
var b=TK.StreamEvent({type:"stream-removed",stream:a,message:{subscribeReconnection:!0,subscribeReconnectionNumber:a.subscribeReconnectionNumber,source:"subscribe",isNotRemote:!0}});g.dispatchEvent(b);a.getAttributes().type===TK.STREAM_VIDEO?Sa(a):za(a,!1);g.subscribe(a,{subscribeReconnection:!0})}else L.Logger.info("[tk-sdk]stream-subscribe-fail(subscribe-fail):  failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{subscribeReconnection:!0})):(g.unsubscribe(a),d=TK.StreamEvent({type:"stream-subscribe-fail",error:e,message:{code:"subscribeFail",stream:a,hasdata:!1,subscribeReconnectionNumber:a.subscribeReconnectionNumber,hasRemoteStream:void 0!==g.remoteStreams[a.getID()]}}),g.dispatchEvent(d),c&&c(void 0,e)):L.Logger.info("[tk-sdk]stream-subscribe-fail:remoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+
" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):(L.Logger.debug("[tk-sdk]Subscriber added"),a.subscribeReconnectionNumber=0,a.timeoutReSubcribeNumber=0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message ",b);b=Ea(b);var c="chrome-stable";a.pc&&a.pc.browser&&(c=a.pc.browser);ia("signaling_message",{streamId:a.getID(),msg:b,browser:c},void 0,function(){})},nop2p:!0,
audio:b.audio,video:b.video,screen:!1,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,iceServers:g.iceServers,cnnId:a.extensionId},a.isTkNative),a.pc.onaddstream=function(b){g.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,a.mediaStreamClone=a.stream&&"function"===typeof a.stream.clone?a.stream.clone():a.stream,sa&&g.rtcStatsrObserver(a),a.extensionId!==p.id&&"video"===a.getAttributes().type&&Xa(a),
b=TK.StreamEvent({type:"stream-subscribed",stream:a}),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(b),a.getAttributes().type===TK.STREAM_VIDEO?(Aa(a),b=g.getUser(a.publisherId()),void 0!==b&&(b._audiopublished_=!a.audioMuted,b._videopublished_=!a.videoMuted)):za(a,!0)):L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]subscribe ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==g.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Subscribing stream",a.getID(),"has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),t(a,b,"subscribe"))},a.pc.createOffer(!0),c&&c(!0))});else if(a.hasData()&&!1!==b.data)ia("subscribe",{streamId:a.getID(),data:b.data,metadata:b.metadata},void 0,function(b,d){0!==b?(L.Logger.error("[tk-sdk]Error subscribing to stream ",d),b=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{error:d,hasdata:!0}}),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(b),c&&c(void 0,d)):g.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.extensionId!==p.id&&"video"===a.getAttributes().type&&Xa(a),d=TK.StreamEvent({type:"stream-subscribed",stream:a}),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(d),"video"===a.getAttributes().type?
(Aa(a),d=g.getUser(a.publisherId()),void 0!==d&&(d._audiopublished_=!a.audioMuted,d._videopublished_=!a.videoMuted)):za(a,!0),c&&c(!0)):(L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(!1))});else{L.Logger.warning("[tk-sdk]There's nothing to subscribe to");
c&&c(void 0,"Nothing to subscribe to");return}L.Logger.debug("[tk-sdk]Subscribing to: "+a.getID());return 0}};g.unsubscribe=function(a,b,c){void 0!==g.socket&&a&&!a.local&&(c=c||{},ba("unsubscribe",a.getID(),function(d,e){0!==d?(d=TK.StreamEvent({type:"stream-unsubscribe-fail",stream:a,message:{error:e}}),L.Logger.info("[tk-sdk]stream-unsubscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g.dispatchEvent(d),b&&b(void 0,
e)):(c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.failed&&delete a.failed,eb(a),b&&b(!0))},function(){L.Logger.error("[tk-sdk]Error calling unsubscribe.")}))};g.getStreamStats=function(a,b){L.Logger.warning("[tk-sdk]getStreamStats method is not support!")};g.getStreamsByAttribute=function(a,b){var c=[],d;for(d in g.remoteStreams)if(g.remoteStreams.hasOwnProperty(d)){var e=g.remoteStreams[d];void 0!==e.getAttributes()&&void 0!==e.getAttributes()[a]&&e.getAttributes()[a]===b&&c.push(e)}return c};
g.seekPlayback=function(a){if(z)try{a=Number(a),g.socket.emit("seekPlayback",a)}catch(Q){L.Logger.error("[tk-sdk]The seek posttion must be a number, in milliseconds !")}else L.Logger.warning("[tk-sdk]No playback environment!")};g.pausePlayback=function(){z?g.socket.emit("pausePlayback"):L.Logger.warning("[tk-sdk]No playback environment!")};g.playPlayback=function(){z?g.socket.emit("Playback"):L.Logger.warning("[tk-sdk]No playback environment!")};g.initPlaybackInfo=function(a,b,c,d,e){var f=function(){if(c){if("string"===
typeof c)try{c=L.Utils.toJsonParse(c)}catch(Kb){L.Logger.error("[tk-sdk]params type must is json! ");return}if(void 0===c.roomtype||void 0===c.serial||void 0===c.recordfilepath)L.Logger.error("[tk-sdk]The params must be included [roomtype , serial , recordfilepath] ! ");else{u(1);m({web_host:a,web_port:b});var e={room:{roomtype:c.roomtype,maxvideo:void 0!==c.maxvideo?c.maxvideo:1E4,roomrole:-1,serial:c.serial,roomname:c.roomname||"Play Back",recordfilepath:c.recordfilepath,domain:c.domain,host:c.host||
a,companyid:c.companyid||-1},nickname:"playback",roomrole:-1,thirdid:hb()+":playback"},f={};var q=e.room;q.roomtype=Number(q.roomtype);q.maxvideo=parseInt(q.maxvideo);q.roomrole=Number(q.roomrole);T=q;V=q.serial;ib=q.roomname;Ma=q.roomtype;ta=q.maxvideo;Wa=q.recordfilepath;f.properties={};f.properties.role=e.roomrole;f.properties.nickname=e.nickname;f.properties.hasvideo=!1;f.properties.hasaudio=!1;f.id=e.thirdid;z=!0;TK.isPlayback=z;p=TK.RoomUser(f);z&&(V=V+"_"+p.id)&&-1===V.indexOf(":playback")&&
(V+=":playback");g.setIsGetFileList(!1);sa=!1;Na=e?"string"===typeof e?e:L.Utils.toJsonStringify(e):"";TK.isTkNative&&!va&&(va=!0,tknative.postMessage({command:"initNative",localId:p.id.toString(),width:Number(ea),height:Number(na),fps:Number(fa),roomInfo:Na,webAddr:y.toString(),webPort:C.toString()}));L.Logger.info("[tk-sdk]initPlaybackInfo--\x3e_room_max_videocount:"+ta+" , my id:"+p.id+" , room id:"+V,"room properties chairmancontrol is:"+(T.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(T.chairmancontrol):
T.chairmancontrol:void 0));d&&"function"===typeof d&&d(0,f,e)}}else L.Logger.error("[tk-sdk]params is required ,params type is json !")};e?f():c&&"object"===typeof c?c.recordfilepath?(u(1),m({web_host:a,web_port:b}),z=!0,TK.isPlayback=z,Wa=c.recordfilepath,g.setIsGetFileList(!1),sa=!1,c.playback=!0,L.Logger.info("[tk-sdk]initPlaybackInfo to checkroom start , params is "+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c))+"!"),e=c.recordfilepath+"room.json",
/room.json/g.test(c.recordfilepath)&&(e=c.recordfilepath),/https:/g.test(window.location.protocol)&&!/https:/g.test(e)&&(e=e.replace(/http:/g,"https:").replace(/:\d+/g,"")),$.ajax({url:e,dataType:"json",type:"GET",async:!0}).done(function(a){L.Logger.debug("[tk-sdk]getPlaybackRoomJson resp \x3d ",L.Utils.toJsonStringify(a));a&&"object"===typeof a?yb(a,function(a,b,c){0===a?d&&"function"===typeof d&&d(a,b,c):f()}):(L.Logger.error("[tk-sdk]getPlaybackRoomJson resp must is json , call oldInitPlaybackInterface handler!"),
f())}).fail(function(a,b,c){L.Logger.error("[tk-sdk]getPlaybackRoomJson fail[ jqXHR , textStatus , errorThrown ]:",a,b,c);f()})):L.Logger.error("[tk-sdk]params.recordfilepath is required !"):L.Logger.error("[tk-sdk]params is required ,params type is json !")};g.checkroom=function(a,b,c,d,e,f){u(1);m({web_host:a,web_port:b});L.Utils.getJsonLength(O)||z||g.requestServerList(y,C,void 0,{checkroom:!0});a=M+"://"+y+":"+C+"/ClientAPI/checkroom?ts\x3d"+(new Date).getTime();b=!0;f="";if("string"===typeof c)f=
c,z&&(f+="\x26playback\x3dtrue");else{z&&(c.playback=!0);for(var q in c)b?b=!1:f+="\x26",f=f+q+"\x3d"+c[q]}L.Logger.debug("[tk-sdk]Going to checkroom",f);L.Logger.info("[tk-sdk]call checkroom start!");var l=B("POST",a,!0,f,function(){L.Logger.debug("[tk-sdk]Http status ",l.readyState);if(4==l.readyState)if(200==l.status){L.Logger.debug("[tk-sdk]checkroom resp : "+l.responseText);var a=L.Utils.toJsonParse(l.responseText);yb(a,d,e)}else L.Logger.error("[tk-sdk]checkroom fail[readyState-status]:",l.readyState,
l.status),d(3,l.responseText)})};g.controlMedia=function(a,b){g.socket.emit("controlmedia",a,b)};var Eb=function(a){if(v){v.hasVideo()!==p.hasvideo&&v.changeVideo(p.hasvideo);v.hasAudio()!==p.hasaudio&&v.changeAudio(p.hasaudio);if(v.stream){for(var b in a)/^customdata_/g.test(b)&&(v.stream[b]=a[b]);var c=v.stream.getTracks();for(b=0;b<c.length;b++){var d=c[b];v.stream.removeTrack(d)}a=a.getTracks();for(b=0;b<a.length;b++)d=a[b],v.stream.addTrack(d)}else v.stream=a;v.mediaStreamClone=v.stream&&"function"===
typeof v.stream.clone?v.stream.clone():v.stream;v.player&&v.player.changeMediaStreamUrl(v.stream);if(da&&p&&void 0!=p.id&&D[p.id]){var e=p.publishstate;e>TK.PUBLISH_STATE_NONE&&g.unpublish(v,function(a,b){r(!0);w(!0);l(p.publishstate);e>TK.PUBLISH_STATE_NONE&&g.publish(v)})}}else L.Logger.warning("[tk-sdk]changeLocalDeviceToLocalstream local stream is not exist!")};g.changeLocalDeviceToLocalstream=function(a,b,c){a=a||{};TK.DeviceMgr.changeLocalDeviceToLocalstream(Eb,a,b,c)};pa.onDevicesSetted=function(a){Eb(a)};
pa.onDeviceChanged=function(a){Db&&ob(a)};g.getUploadFileParams=function(a,b,c,d){a={serial:T.serial,userid:p.id,sender:p.nickname,conversion:1,isconversiondone:0,writedb:(void 0!==c?c:1)?1:0,fileoldname:a,fieltype:b,alluser:1};d&&(a.codeid=d);return a};g.docUploadFileDataInfo=function(a,b){var c=M+"://"+y+":"+C+"/ClientAPI/docupdateinfo?ts\x3d"+(new Date).getTime();if(a)return $.ajax({url:c,dataType:"json",type:"POST",data:{fileid:a},async:!0}).done(function(a){L.Logger.debug("[tk-sdk]docUploadFileDataInfo resp \x3d ",
L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.status,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]docUploadFileDataInfo fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)});L.Logger.error("[tk-sdk]docUploadFileDataInfo fileId is required!")};g.uploadFile=function(a,b,c){return Fb(a,b,c)};g.deleteFile=function(a,b){Pa(a,b)};g.stopIntervalRtcStatsrObserver=function(){clearInterval(g._rtcStatsrObserverTimer);g._rtcStatsrObserverTimer=null};g.startIntervalRtcStatsrObserver=
function(){TK.isTkNative?L.Logger.warning("[tk-sdk]Client not support startIntervalRtcStatsrObserver method!"):(clearInterval(g._rtcStatsrObserverTimer),g._rtcStatsrObserverTimer=setInterval(function(){for(var a in g.remoteStreams){var b=g.remoteStreams[a];b.extensionId===p.id&&g.localStreams[b.getID()]&&(b=v);b&&b.pc&&g.rtcStatsrObserver(b)}},mb))};g.stopIntervalRtcStatsrObserverByStream=function(a){a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null):L.Logger.error("[tk-sdk]stream is not exist!")};
g.startIntervalRtcStatsrObserverByStream=function(a,b){TK.isTkNative?L.Logger.warning("[tk-sdk]Client not support startIntervalRtcStatsrObserverByStream method!"):(b=b||mb,a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=setInterval(function(){a&&a.pc&&g.rtcStatsrObserver(a)},b)):L.Logger.error("[tk-sdk]stream is not exist!"))};g.rtcStatsrObserver=function(a){if(TK.isTkNative)L.Logger.warning("[tk-sdk]Client not support rtcStatsrObserver method!");else if(a)if(a.extensionId===p.id&&
g.localStreams[a.getID()]&&(a=v),!a.pc)L.Logger.error("[tk-sdk]stream.pc is not exist , stream id and extensionId:"+a.getID()+","+a.extensionId+"!");else{if(a&&a.pc)if(!0===a.pc.isNative){L.Logger.debug("[tk-sdk]pc.getStats has not been implemented currently!");clearTimeout(g._rtcStatsrObserverTimer);clearTimeout(a.rtcStatsrObserverTimer);g._rtcStatsrObserverTimer=null;a.rtcStatsrObserverTimer=null;var b=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"[tk_client]pc.getStats has not been implemented currently!",
code:L.Constant.getStats.nativeFailure,isNative:a.pc.isNative}});g.dispatchEvent(b)}else if(a.pc.getStats)try{a.pc.getStats(function(b,c){void 0===c||-1!==c&&-2!==c&&-3!==c?(b=Ib(a,b))?(a.networkStatus=b,b=TK.StreamEvent({type:"stream-rtcStats",stream:a,message:{networkStatus:b}},!1),g.dispatchEvent(b,!1)):g.rtcStatsrObserver(a):(L.Logger.error("[tk-sdk]pc.getStats -\x3e getStats not exist!"),clearTimeout(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null,b=TK.StreamEvent({type:"stream-rtcStats-failed",
stream:a,message:{error:"pc.getStats -\x3e getStats not exist!",code:-1===c?L.Constant.getStats.peerConnectionNotGetStats:-2===c?L.Constant.getStats.getStatsFailure:L.Constant.getStats.getStatsError,isNative:a.pc.isNative}}),g.dispatchEvent(b))})}catch(ya){L.Logger.error("[tk-sdk]pc.getStats error:",ya)}else L.Logger.error("[tk-sdk]pc.getStats is not exist!"),clearTimeout(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null,b=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"pc.getStats is not exist!",
code:L.Constant.getStats.pcNotGetStats,isNative:a.pc.isNative}}),g.dispatchEvent(b)}else L.Logger.error("[tk-sdk]stream is not exist!")};g.addOndevicechange=function(){if(TK.isTkNative)L.Logger.warning("[tk-sdk]Client not support addOndevicechange method!");else if(!z){var a=function(a){ob(a)};TK&&TK.DeviceMgr&&TK.DeviceMgr.addOndevicechange?TK.DeviceMgr.addOndevicechange(a)&&g.dispatchEvent({type:"add_device_change_listener"}):L.Logger.error("TK.DeviceMgr no initialization is done!")}};g.removeOndevicechange=
function(){TK.isTkNative?L.Logger.warning("[tk-sdk]Client not support removeOndevicechange method!"):TK&&TK.DeviceMgr&&TK.DeviceMgr.removeOndevicechange?TK.DeviceMgr.removeOndevicechange()&&g.dispatchEvent({type:"remove_device_change_listener"}):L.Logger.error("TK.DeviceMgr no initialization is done!")};g.setAutoProcessDeviceChangeEvent=function(a){"boolean"===typeof a&&(Db=a)};g.startRecordStream=function(a,b,c){if(6!=A)return 2;if(void 0===a||void 0===a.getID())return 4;var d={};d.streamId=a.getID();
d.convert=b.convert||0;ba("startRecordStream",d,function(a,b){L.Logger.debug("startRecordStream",a,b);c(a,b)});return 0};g.stopRecordStream=function(a,b,c){if(6!=A)return 2;if(void 0===a||void 0===a.getID())return 4;c={};c.streamId=a.id;ba("stopRecordStream",c,function(a){L.Logger.debug("stopRecordStream",a);b(a)});return 0};g.requestServerList=function(a,b,c,d){if(Cb)if(g.webInterfaceGetservering)L.Logger.info("[tk-sdk]requestServerList  interface is being requested and cannot be executed again requestServerList"),
c&&"function"===typeof c&&c(O,-2);else{if(L.Utils.getJsonLength(O))return c&&"function"===typeof c&&c(O,-1),O;if(void 0===a||null===a||void 0===b||null===b)L.Logger.error("[tk-sdk]first requestServerList web_host or web_port is not exist!");else{Ab=a;Bb=b;L.Logger.debug("[tk-sdk]Going to requestServerList");var e=!1,q=function(){if(e){f(O,S);L.Logger.info("[tk-sdk]requestServerList finshed , serverName is "+S+" , serverlist info : ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(O)):
L.Utils.toJsonStringify(O));var a=TK.RoomEvent({type:"room-serverlist",message:{serverList:O,serverName:S}});g.dispatchEvent(a);c&&"function"===typeof c&&c(O,0)}};g.webInterfaceGetservering=!0;L.Utils.getJsonLength(O)?(g.webInterfaceGetservering=!1,e=!0,q()):pb(a,b,function(a,b){g.webInterfaceGetservering=!1;e=!0;q()})}}else c&&"function"===typeof c&&c(void 0,-2)};g.switchServerByName=function(a){if(!L.Utils.getJsonLength(O))return L.Logger.error("[tk-sdk]selectServerByName --\x3e service list not request  , list is not exist!"),
!1;if(!O[a])return L.Logger.error("[tk-sdk]selectServerByName --\x3e the service list  has no option name  "+a+"!"),!1;void 0!==y&&void 0!==C?0<Ya?(S=a,f(O,S),h(),Ra!==y?n({source:"select service reconnect"}):L.Logger.info("[tk-sdk]web request host is not change , not need reconnect service!")):L.Logger.error("[tk-sdk]selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! "):L.Logger.error("[tk-sdk]selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");
return!0};g.selectServerToCheckroom=function(a,b,c,d,e){a=a||S;L.Utils.getJsonLength(O)?O[a]?(S=a,f(O,S),m({web_host:Ab,web_port:Bb}),void 0!==y&&void 0!==C?(h(),g.checkroom(y,C,b,c,d,e)):L.Logger.error("[tk-sdk]web request host and port is not exist , cannot call checkroom ! ")):(L.Logger.error("[tk-sdk]selectServerToCheckroom --\x3ethe service list  has no option name  "+a+"!"),c&&"function"===typeof c&&c(-2,void 0,void 0)):(L.Logger.error("[tk-sdk]selectServerToCheckroom --\x3eservice list not request  , list is not exist!"),
c&&"function"===typeof c&&c(-2,void 0,void 0))};g.stopStreamTracksFromDefaultStream=function(){v&&v.stream?TK.DeviceMgr.stopStreamTracks?TK.DeviceMgr.stopStreamTracks(v.stream):L.Logger.warning("[tk-sdk] TK.DeviceMgr.stopStreamTracks is not exist , inexecutable stopStreamTracksFromDefaultStream"):L.Logger.warning("[tk-sdk] defaultstream.stream is not exist , inexecutable stopStreamTracksFromDefaultStream")};g.enableLocalAudioOrVideo=function(a){a&&"object"===typeof a?(void 0!==a.video&&"boolean"===
typeof a.video&&w(a.video),void 0!==a.audio&&"boolean"===typeof a.audio&&r(a.audio)):L.Logger.error("[tk-sdk]enableLocalAudioOrVideo enables must is json . enables \x3d {video , audio} !")};g.publishVideo=function(){TK.isOnlyAudioRoom?L.Logger.warning("[tk-sdk]only audio room not execute method publishVideo method !"):p.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&p.publishstate!==TK.PUBLISH_STATE_BOTH&&g.changeUserPublish(p.id,p.publishstate===TK.PUBLISH_STATE_MUTEALL||p.publishstate===TK.PUBLISH_STATE_NONE?
TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_BOTH)};g.unpublishVideo=function(){TK.isOnlyAudioRoom?L.Logger.warning("[tk-sdk]only audio room not execute method unpublishVideo method !"):p.publishstate===TK.PUBLISH_STATE_NONE?L.Logger.warning("[tk-sdk]Local streams are not published and cannot be executed unpublishVideo."):p.publishstate!==TK.PUBLISH_STATE_AUDIOONLY&&g.changeUserPublish(p.id,p.publishstate===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_NONE)};g.publishAudio=function(){p.publishstate!==
TK.PUBLISH_STATE_AUDIOONLY&&p.publishstate!==TK.PUBLISH_STATE_BOTH&&g.changeUserPublish(p.id,p.publishstate===TK.PUBLISH_STATE_MUTEALL||p.publishstate===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_BOTH)};g.unpublishAudio=function(){p.publishstate===TK.PUBLISH_STATE_NONE?L.Logger.warning("[tk-sdk]Local streams are not published and cannot be executed unpublishAudio."):p.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&g.changeUserPublish(p.id,p.publishstate===TK.PUBLISH_STATE_BOTH?
TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_NONE)};g.playStream=function(a,b,c){c=c||{};if(a)if(b)if("object"!==typeof c)L.Logger.error("[tk-sdk]playStream method options not is json!");else{var d=ha(b,"video");d?(void 0===c.video&&void 0===c.audio&&(c.video=void 0!==c.video&&"boolean"===typeof c.video?c.video:!0,c.audio=void 0!==c.audio&&"boolean"===typeof c.audio?c.audio:!0),!wa(d)||"video"!==d.getAttributes().type||d.isInit||z?qa(a,d,c):(L.Logger.info("[tk-sdk]playStream:my stream is not init , call stream init start!"),
v.init(!0,void 0,function(b){L.Logger.info("[tk-sdk]playStream:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(b));qa(a,d,c);Qa(b)}))):L.Logger.warning("[tk-sdk]playStream: user is not stream  , user id is "+b)}else L.Logger.error("[tk-sdk]playStream method userid is not exist!");else L.Logger.error("[tk-sdk]playStream method elementId is not exist!")};g.unplayStream=function(a,b){b=b||{};if(a)if("object"!==typeof b)L.Logger.error("[tk-sdk]unplayStream method options not is json!");
else{var c=I[a];c?(void 0===b.video&&void 0===b.audio&&(b.video=void 0!==b.video&&"boolean"===typeof b.video?b.video:!0,b.audio=void 0!==b.audio&&"boolean"===typeof b.audio?b.audio:!0),Ga(c,b)):L.Logger.warning("[tk-sdk]unplayStream: user is not stream  , user id is "+a)}else L.Logger.error("[tk-sdk]unplayStream method userid is not exist!")};g.playShareMedia=function(a,b,c){c=c||{};if(a)if(b)if("object"!==typeof c)L.Logger.error("[tk-sdk]playShareMedia method options not is json!");else{var d=ha(b,
"media");d?(void 0===c.video&&void 0===c.audio&&(c.video=void 0!==c.video&&"boolean"===typeof c.video?c.video:!0,c.audio=void 0!==c.audio&&"boolean"===typeof c.audio?c.audio:!0),qa(a,d,c)):L.Logger.warning("[tk-sdk]playShareMedia: user is not stream  , user id is "+b)}else L.Logger.error("[tk-sdk]playShareMedia method userid is not exist!");else L.Logger.error("[tk-sdk]playShareMedia method elementId is not exist!")};g.unplayShareMedia=function(a,b){b=b||{};if(a)if("object"!==typeof b)L.Logger.error("[tk-sdk]unplayShareMedia method options not is json!");
else{var c=I[a+":media"];c?(void 0===b.video&&void 0===b.audio&&(b.video=void 0!==b.video&&"boolean"===typeof b.video?b.video:!0,b.audio=void 0!==b.audio&&"boolean"===typeof b.audio?b.audio:!0),Ga(c,b)):L.Logger.warning("[tk-sdk]unplayShareMedia: user is not stream  , user id is "+a)}else L.Logger.error("[tk-sdk]unplayShareMedia method userid is not exist!")};g.playRemoteMediaFile=function(a,b,c,d){if(a)if(b)if(c&&"object"!==typeof c)L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteMediaFile method options is not json!");
else{var e=ha(a,TK.STREAM_FILE);e?(c=c||{},c.audio=!0,c.video=!0,qa(b,e,c)):(L.Utils.isFunction(d)&&d("could not find media stream"),L.Logger.error("[tk-sdk] playRemoteMediaFile: user has not stream, user id is "+a))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteMediaFile method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteMediaFile method got invalid userId!")};g.unplayRemoteMediaFile=function(a,
b){if(a){var c=I[a+TK.STREAM_FILE];c?Ga(c,{audio:!0,video:!0}):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk] unplayRemoteMediaFile: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] unplayRemoteMediaFile method got invalid userId!")};g.playRemoteScreen=function(a,b,c,d){if(a)if(b)if(c&&"object"!==typeof c)L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteScreen method options is not json!");
else{var e=ha(a,TK.STREAM_SCREEN);e?(c=c||{},c.audio=!0,c.video=!0,qa(b,e,c)):(L.Utils.isFunction(d)&&d("could not find media stream"),L.Logger.error("[tk-sdk] playRemoteScreen: user has not stream, user id is "+a))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteScreen method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] playRemoteScreen method got invalid userId!")};g.unplayRemoteScreen=function(a,b){if(a){var c=
I[a+TK.STREAM_SCREEN];c?Ga(c,{audio:!0,video:!0}):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk] unplayRemoteScreen: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] unplayRemoteScreen method got invalid userId!")};g.setRemoteAudioVolume=function(a,b,c){if("number"!==typeof a)L.Logger.error("[tk-sdk] setRemoteAudioVolume method volume muset is number!");else{void 0===c&&(c="1");var d=Za[""+c];d?
(c=ha(b,d))?c.setVolume(a):L.Logger.warning("[tk-sdk] setRemoteAudioVolume: user is not stream  , user id is "+b):L.Logger.warning("[tk-sdk] setRemoteAudioVolume: type is not stream  , type id is "+c)}};g.getAudioVolume=function(a,b,c){if(L.Utils.isFunction(b)){void 0===c&&(c="1");var d=Za[""+c];d?(c=ha(a,d))?c.getVolume(b):L.Logger.warning("[tk-sdk] getAudioVolume: user has not stream, user id is "+a):L.Logger.warning("[tk-sdk] getAudioVolume: type is not stream , type id is "+c)}else L.Logger.warning("[tk-sdk] getAudioVolume: onVolume is not function")};
g.registerAudioVolumeListener=function(a,b,c,d,e){if(L.Utils.isNull(a))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] registerAudioVolumeListener: userId is invalid");else if("number"!==typeof b)L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] registerAudioVolumeListener: msInterval is invalid");else if(L.Utils.isFunction(c)){50>b&&(b=50);void 0===e&&(e="1");var f=Za[""+e];f?(e=ha(a,f))?e.startIntervalGetRealtimeVolume(function(a,b){"_local_default_extension_id_"!==
b||L.Utils.isNull(p.id)||(b=p.id);L.Utils.isFunction(c)&&c(a,b)},b,d):(L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"),L.Logger.error("[tk-sdk] registerAudioVolumeListener: user has not stream, user id is "+a)):L.Logger.warning("[tk-sdk] registerAudioVolumeListener: type is not stream , type id is "+e)}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] registerAudioVolumeListener: onVolume is not function")};g.unregisterAudioVolumeListener=function(a,b){void 0===b&&(b="1");
var c=Za[""+b];c?(b=ha(a,c))?b.stopIntervalGetRealtimeVolume():L.Logger.warning("[tk-sdk] unregisterAudioVolumeListener: user has not stream, user id is "+a):L.Logger.warning("[tk-sdk] unregisterAudioVolumeListener: type is not stream , type id is "+b)};g.switchOnlyAudioRoom=function(a){var b={};a?(TK.needOnlyAudioRoom=1,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b,save:!0},g.pubMsg(a)):(TK.needOnlyAudioRoom=2,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b},g.delMsg(a))};
g.startShareMedia=function(a,b,c,d,e){function f(){L.Logger.info("[tk-sdk]calling startShareMedia  , url is "+a+" , isVideo is "+b+" , toID is "+c+", attrs is "+L.Utils.toJsonStringify(d));ia("publish",{state:"url",data:k.data,audio:k.audio,video:k.video&&!TK.isOnlyAudioRoom,attributes:k.attributes,extensionId:k.extensionId,metadata:void 0,createOffer:void 0},k.url,function(a,b){if(0==a)L.Logger.debug("[tk-sdk]mediaStream published , stream id:"+b+" , extensionId is "+k.extensionId+", attrs is "+
L.Utils.toJsonStringify(k.attributes)),e&&e(b);else{L.Logger.error("[tk-sdk]Error when publishing mediaStream",a,b);var c=TK.StreamEvent({type:"stream-publish-fail",userid:Jb(k.extensionId,"media"),message:{errorCode:a,id:b,hasdata:!1}});L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+b+" , extensionId is "+k.extensionId+", attrs is "+L.Utils.toJsonStringify(k.attributes));g.dispatchEvent(c);e&&e(void 0,a)}})}if(6!==A)return L.Logger.warning("[tk-sdk]startShareMedia with wrong room status",
A),e&&"function"===typeof e&&e(void 0),2;if(a)if(TK.isOnlyAudioRoom&&b)L.Logger.warning("[tk-sdk]only audio room not execute method startShareMedia to video media !"),e&&"function"===typeof e&&e(void 0);else{var q={type:"media"};b=void 0!==b?b:!1;void 0!==c&&(q.toID=c);if(d&&"object"===typeof d)for(var l in d)"toID"!==l&&"type"!==l&&(q[l]=d[l]);var k={audio:!0,video:b,url:a,extensionId:p.id+":media",attributes:q};q=!1;for(l in g.remoteStreams){var h=g.remoteStreams[l];h&&"media"===h.getAttributes().type&&
(q=!0,g.stopShareMedia(function(a){f()}))}q||f()}else L.Logger.error("[tk-fake-sdk]startShareMedia url can not be empty!"),e&&"function"===typeof e&&e(void 0)};g.stopShareMedia=function(a){function b(b){L.Logger.info("[tk-sdk]calling stopShareMedia , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes()));ba("unpublish",b.getID(),function(c,d){0!==c?(L.Logger.error("[tk-sdk]Error unpublishing stream",d),c=TK.StreamEvent({type:"stream-unpublish-fail",
stream:b,message:{error:d}}),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),g.dispatchEvent(c),a&&a(void 0,d)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),b.failed&&delete b.failed,a&&a(!0))})}if(6!==A)return L.Logger.warning("[tk-sdk]stopShareMedia with wrong room status",
A),a&&"function"===typeof a&&a(void 0),2;for(var c in g.remoteStreams){var d=g.remoteStreams[c];d&&"media"===d.getAttributes().type&&b(d)}};g.getShareMediaController=function(){return{play:function(){for(var a in g.remoteStreams){var b=g.remoteStreams[a];"media"===b.getAttributes().type&&g.controlMedia(b.getID(),{type:"pause",pause:!1})}},pause:function(){for(var a in g.remoteStreams){var b=g.remoteStreams[a];"media"===b.getAttributes().type&&g.controlMedia(b.getID(),{type:"pause",pause:!0})}},seek:function(a){0>
a&&(a=0);1<a&&(a=1);for(var b in g.remoteStreams){var c=g.remoteStreams[b];if("media"===c.getAttributes().type){var d=parseInt(a*c.getAttributes().duration);d>c.getAttributes().duration&&(d=c.getAttributes().duration);g.controlMedia(c.getID(),{type:"seek",pos:d})}}}}};g.getShareFileController=function(){return{play:function(){var a=ha(p.id,"file");a&&"file"===a.getAttributes().type&&(g.controlMedia(a.getID(),{type:"pause",pause:!1}),g.pauseLocalFileStream(!1))},pause:function(){var a=ha(p.id,"file");
a&&"file"===a.getAttributes().type&&(g.controlMedia(a.getID(),{type:"pause",pause:!0}),g.pauseLocalFileStream(!0))},seek:function(a){0>a&&(a=0);1<a&&(a=1);var b=ha(p.id,"file");if(b&&"file"===b.getAttributes().type){var c=parseInt(a*b.getAttributes().duration);c>b.getAttributes().duration&&(c=b.getAttributes().duration);g.controlMedia(b.getID(),{type:"seek",pos:c});g.seekLocalFileStream(a)}}}};g.getPlaybackController=function(){var a=this;return{play:function(){a.playPlayback()},pause:function(){a.pausePlayback()},
seek:function(b){0>b&&(b=0);1<b&&(b=1);Ba&&void 0!==Ba.endTime&&void 0!==Ba.startTime&&(b=Ba.startTime+parseInt(b*(Ba.endTime-Ba.startTime)),a.seekPlayback(b))}}};g.registerRoomWhiteBoardDelegate=function(a){if(a&&"TKWhiteBoardManager"===a.className&&"function"===typeof a.registerRoomDelegate){if(N=a)N.registerRoomDelegate&&N.registerRoomDelegate(g),N.changeCommonWhiteBoardConfigration&&(a={},M&&y&&void 0!==C&&(a.webAddress=M+"://"+y+":"+C),ua&&la&&void 0!==ma&&(a.webAddress=M+"://"+y+":"+C),ra&&
ja&&void 0!==ka&&(a.webAddress=ra+"://"+ja+":"+ka),void 0!==p.id&&(a.myUserId=p.id),void 0!==p.nickname&&(a.myName=p.nickname),void 0!==p.role&&(a.myRole=p.role),a.isPlayback=z,N.changeCommonWhiteBoardConfigration(a))}else L.Logger.warning("[tk-sdk]register whiteboardManagerInstance not is a TKWhiteBoardManager instance class , cannot execute registerRoomWhiteBoardDelegate method.")};g.playVideo=function(a,b,c,d){L.Logger.info("[tk-sdk] playVideo. userId:",a,";elementId:",b,";options:",c);""===a&&
(a=L.Utils.isNull(p.id)?"_local_default_extension_id_":p.id);if(a)if(b){if(!L.Utils.isNull(p.id)&&a===p.id||"_local_default_extension_id_"===a){var e=I[a];if(!L.Utils.isNull(e)){L.Utils.isFunction(d)&&d("TK_ERR_OPERATION_IN_PROGRESS");L.Logger.error("[tk-sdk] video has been played already");return}}"_local_default_extension_id_"===a&&L.Utils.isNull(v)&&(v=Ca("video",{video:!0,audio:!0,attributes:{}}));for(var f in aa){if("_local_default_extension_id_"===f)break;if(f===a){var l=g.getUser(a);if(void 0===
l){L.Utils.isFunction(d)&&d("TK_ERR_NO_THIS_USER");L.Logger.error("[tk-sdk]playVideo method got invalid user!");return}if(!l._videoplayed_&&void 0!==l._audioplayed_&&!0===l._audioplayed_&&(f=aa[f],void 0!==f&&f!==b)){L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");L.Logger.error("[tk-sdk]playVideo method got invalid elementId!");return}break}}c&&"object"!==typeof c?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method options is not json!")):(e=ha(a,"video"))?(c=
c||{},l=g.getUser(a),void 0!==l?(l._videoplayed_=!0,aa[a]=b):"_local_default_extension_id_"===a&&(aa[a]=b),wa(e)&&"video"===e.getAttributes().type&&!z?(c.audio=!1,c.video=!0,e.isInit||e.isIniting?!e.isInit&&e.isIniting?(Oa=!0,Ha.elementId=b,Ha.options=c):qa(b,e,c):(L.Logger.info("[tk-sdk] playVideo:local stream has not been initialized, initialize stream now!"),v.init(!0,void 0,function(a){L.Logger.info("[tk-sdk] initialize stream finished, result is :",L.Utils.toJsonStringify(a));qa(b,e,c);Qa(a)}))):
(a=!0,e.playInfo&&e.playInfo.audio||(a=!1),c.audio=a,c.video=!0,qa(b,e,c))):(L.Utils.isFunction(d)&&d("could not find media stream"),L.Logger.error("[tk-sdk]playVideo: user has not stream, user id is "+a))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method got invalid userId!")};g.unplayVideo=function(a,b){L.Logger.info("[tk-sdk] unplayVideo. userId:",
a);""===a&&(a=L.Utils.isNull(p.id)?"_local_default_extension_id_":p.id);if(a){var c=g.getUser(a);void 0!==c?(c._videoplayed_=!1,(void 0===c._audioplayed_||void 0!==c._audioplayed_&&!1===c._audioplayed_)&&delete aa[a],c.id===p.id&&delete aa._local_default_extension_id_):"_local_default_extension_id_"===a&&(delete aa._local_default_extension_id_,L.Utils.isNull(p.id)||delete aa[p.id]);(!L.Utils.isNull(p.id)&&p.id===a||"_local_default_extension_id_"===a)&&Oa&&(Oa=!1,Ha={});(c=I[a])?(a=!1,c.playInfo&&
c.playInfo.audio||(a=!0),Ga(c,{audio:a,video:!0})):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk]unplayVideo: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]unplayVideo method got invalid userId!")};g.playAudio=function(a,b,c){L.Logger.info("[tk-sdk] playAudio. userId:",a,";elementId:",b);if(a)if(b){var d=ha(a,"video");if(d)if(wa(d)&&!z)L.Utils.isFunction(c)&&c("play local audio are not allowed!");
else{for(var e in aa)if(e===a){var f=g.getUser(a);if(void 0===f){L.Utils.isFunction(c)&&c("TK_ERR_NO_THIS_USER");L.Logger.error("[tk-sdk]playAudio method got invalid user!");return}if(!f._audioplayed_&&void 0!==f._videoplayed_&&!0===f._videoplayed_&&(e=aa[e],void 0!==e&&e!==b)){L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG");L.Logger.error("[tk-sdk]playAudio method got invalid elementId!");return}break}f=g.getUser(a);void 0!==f&&(f._audioplayed_=!0,aa[a]=b);a={};c=!0;d.playInfo&&d.playInfo.video||
(c=!1);a.audio=!0;a.video=c;qa(b,d,a)}else L.Utils.isFunction(c)&&c("could not find media stream"),L.Logger.error("[tk-sdk]playAudio: user has not stream, user id is "+a)}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playAudio method got invalid elementId!");else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playAudio method got invalid userId!")};g.unplayAudio=function(a,b){L.Logger.info("[tk-sdk] unplayAudio. userId:",a);if(a){var c=g.getUser(a);
void 0!==c&&(c._audioplayed_=!1,(void 0===c._videoplayed_||void 0!==c._videoplayed_&&!1===c._videoplayed_)&&delete aa[a]);(c=I[a])?(a=!1,c.playInfo&&c.playInfo.video||(a=!0),Ga(c,{audio:!0,video:a})):(L.Utils.isFunction(b)&&b("could not find media stream"),L.Logger.warning("[tk-sdk]unplayAudio: user has not stream, user id is "+a))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]unplayAudio method got invalid userId!")};g.getVideoProfile=function(a,b){da?L.Utils.isFunction(a)&&
a({width:ea,height:na,maxfps:fa}):(L.Utils.isFunction(b)&&b("[tk-sdk] please call this method after join room success"),L.Logger.error("[tk-sdk] please call getVideoProfile method after join room success"))};g.setVideoProfile=function(a,b){if(da)if("object"!==typeof a)L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments");else if(a.hasOwnProperty("width")&&a.hasOwnProperty("height")&&a.hasOwnProperty("maxfps"))if("number"!==typeof a.width||
"number"!==typeof a.height||"number"!==typeof a.maxfps)L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments");else{var c=Number(T.videotype)+1;b=Ta[c][0];c=Ta[c][1];var d=Number(T.videoframerate);a.width&&a.height&&a.maxfps?(a.width>b&&(a.width=b,a.height=Math.floor(a.height/a.width*b)),a.maxfps>d&&(a.maxfps=d)):(a.width=b,a.height=c,a.maxfps=d);ea=2*Math.floor(a.width/2);na=2*Math.floor(a.height/2);fa=a.maxfps;Fa=Y(ea,fa);pa.setAVMgrProperty({room_video_width:ea,
room_video_height:na,room_video_fps:fa});Ja();L.Logger.info("[tk-sdk]setVideoProfile [_room_video_width * _room_video_height, _room_video_fps, _room_video_maxbps]:"+ea+"*"+na+", "+fa+", "+Fa)}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments");else L.Utils.isFunction(b)&&b("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call setVideoProfile method after join room success")};g.getNativeInterface=function(a){if(TK.isTkNative)return nb;
L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED");L.Logger.error("[tk-sdk] getNativeInterface method must be called in the native environment!")};g.publishScreen=function(a,b,c){if(TK.isTkNative)if(TK.isOnlyAudioRoom)L.Logger.warning("[tk-sdk]only audio room not execute method publishScreen method !");else{if(6!=A)return L.Logger.warning("[tk-sdk]publish with wrong room status",A),2;if(Da)L.Logger.error("[tk-sdk]Screen has been shared already");else if(L.Logger.info("[tk-sdk]calling screenPublish stream , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a&&!a.failed&&void 0===g.remoteStreams[a.getID()]){if(a.hasScreen())return Ia=a,g.publish(Ia,b,c);L.Logger.error("[tk-sdk]Screen Shared streaming screen  must be true",a);c&&c(void 0,"Screen Shared streaming screen must be true")}else L.Logger.error("[tk-sdk]Trying to publish invalid screenStream",a),c&&c(void 0,"Trying to publish invalid screenStream")}else L.Logger.warning("[tk-sdk]publishScreen method must be in the client environment!")};
g.unpublishScreen=function(a,b){if(TK.isTkNative){if(6!=A)return 2;if(Da)return L.Logger.info("[tk-sdk]calling unpublishScreen , stream id:"+Ia.getID()+" , extensionId is "+Ia.extensionId+", attrs is "+L.Utils.toJsonStringify(Ia.getAttributes())),g.unpublish(Ia,a,b)}else L.Logger.warning("[tk-sdk]unpublishScreen method must be in the client environment!")};nb.onNativeStartShareMediaFile=function(a,b,c){L.Utils.isNull()?(a=Ca("file",a),a.play(b),g.publishLocalFile(a,void 0,c)):(L.Utils.isFunction(c)&&
c("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error("[tk-sdk]Share media file in progress."))};nb.onNativeStopShareMediaFile=function(a){var b=Ka[p.id+":file"];L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning("[tk-sdk]Could not find the specify stream while stop sharing media file.")):(b.stop(),g.unpublishLocalFile(b,a),delete Ka[p.id+":file"])};g.publishLocalFile=function(a,b,c){if(TK.isTkNative){if(6!=A)return L.Logger.warning("[tk-sdk]publish with wrong room status",
A),2;if(TK.isOnlyAudioRoom&&a.video)L.Logger.warning("[tk-sdk]only audio room not execute method publishLocalFile method !");else if(L.Logger.info("[tk-sdk]calling localFilePublish stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a&&!a.failed&&void 0===g.remoteStreams[a.getID()]){if(a.getAttributes()&&"file"===a.getAttributes().type)return g.publish(a,b,c);L.Logger.error("[tk-sdk]LocalFile stream attrs.type must be file",a);
c&&c(void 0,"LocalFile stream attrs.type must be file")}else L.Logger.error("[tk-sdk]Trying to publish invalid LocalFileStream",a),c&&c(void 0,"Trying to publish invalid LocalFileStream")}else L.Logger.warning("[tk-sdk]publishLocalFile method must be in the client environment!")};g.unpublishLocalFile=function(a,b,c){if(TK.isTkNative){if(6!=A)return 2;L.Logger.info("[tk-sdk]calling unpublishLocalFile , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
return g.unpublish(a,b,c)}L.Logger.warning("[tk-sdk]unpublishLocalFile method must be in the client environment!")};g.getValidWindowList=function(a,b){if(TK.isTkNative)if(void 0===a||null===a||"function"!==typeof b)L.Logger.error("[tk-sdk] getValidWindowList function got wrong arguments");else{var c=oa();TK.waitNativeToCallbackList[c]=b;tknative.postMessage({command:"getValidWindowList",type:Number(a),seq:c})}else L.Logger.warning("[tk-sdk]getValidWindowList method must be in the client environment!")};
g.updateWindowSource=function(a){TK.isTkNative?(a.id||(a.id=0),a.x||(a.x=0),a.y||(a.y=0),a.width||(a.width=0),a.height||(a.height=0),a.mixMic||(a.mixMic=!1),a.mixSpk||(a.mixSpk=!1),a.type||(a.type=0),tknative.postMessage({command:"updateWindowSource",id:Number(a.id),left:Number(a.x),top:Number(a.y),width:Number(a.width),height:Number(a.height),mixMic:a.mixMic,mixSpk:a.mixSpk,type:Number(a.type)})):L.Logger.warning("[tk-sdk]updateWindowSource method must be in the client environment!")};g.getMonitorCount=
function(a){if(TK.isTkNative)if("function"!==typeof a)L.Logger.error("[tk-sdk] getMonitorCount function got wrong arguments");else{var b=oa();TK.waitNativeToCallbackList[b]=a;tknative.postMessage({command:"getMonitorCount",seq:b})}else L.Logger.warning("[tk-sdk]getMonitorCount method must be in the client environment!")};g.enableViceMonitor=function(){TK.isTkNative?(TK.subscribe_from_native=!0,tknative.postMessage({command:"enableViceMonitor"})):L.Logger.warning("[tk-sdk]enableViceMonitor method must be in the client environment!")};
g.exchangeClientPosition=function(){TK.isTkNative?tknative.postMessage({command:"exchangeClientPosition"}):L.Logger.warning("[tk-sdk]enableViceMonitor method must be in the client environment!")};g.nativeUploadFile=function(a,b,c,d){TK.isTkNative?"string"!==typeof a||"string"!==typeof b||""===a||""===b?("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] uploadFile function got wrong arguments")):"string"!==typeof c?("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] uploadFile function got wrong arguments")):
(d=oa(),tknative.postMessage({command:"uploadFile",seq:d,uri:a,filename:b,params:c})):("function"===typeof d&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk]uploadFile method must be in the client environment!"))};g.nativeDownloadFile=function(a,b,c){TK.isTkNative?"string"!==typeof a||"string"!==typeof b||""===a||""===b?("function"===typeof c&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] downloadFile function got wrong arguments")):(c=oa(),tknative.postMessage({command:"downloadFile",seq:c,
uri:a,filename:b})):("function"===typeof c&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk]downloadFile method must be in the client environment!"))};g.takeSnapshot=function(a,b,c){if(TK.isTkNative)if(b)if("function"!==typeof c)L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");else{var d=oa();TK.waitNativeToCallbackList[d]=c;tknative.postMessage({command:"takeSnapshot",needMin:a,fileName:b,requestId:d})}else L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");
else L.Logger.warning("[tk-sdk]takeSnapshot method must be in the client environment!")};g.startLocalRecord=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=oa();TK.waitNativeToCallbackList[c]=b;tknative.postMessage({command:"startLocalRecord",args:a,seq:c})}else L.Logger.error("[tk-sdk] startRecordScreen function got wrong arguments");else L.Logger.warning("[tk-sdk]startLocalRecord method must be in the client environment!")};g.pauseLocalRecord=function(a,b){if(TK.isTkNative)if(a&&
"function"===typeof b){var c=oa();TK.waitNativeToCallbackList[c]=b;tknative.postMessage({command:"pauseLocalRecord",args:a,seq:c})}else L.Logger.error("[tk-sdk] pauseLocalRecord function got wrong arguments");else L.Logger.warning("[tk-sdk]pauseLocalRecord method must be in the client environment!")};g.stopLocalRecord=function(a){TK.isTkNative?tknative.postMessage({command:"stopLocalRecord",args:a}):L.Logger.warning("[tk-sdk]stopLocalRecord method must be in the client environment!")};g.getOpenLocalFileName=
function(a,b){if(TK.isTkNative)if("object"!==typeof a||"function"!==typeof b)L.Logger.error("[tk-sdk] getOpenLocalFileName function got wrong arguments ,param must is json , callback must is function! ");else{var c=oa();TK.waitNativeToCallbackList[c]=b;tknative.postMessage({command:"getOpenFileName",args:a,seq:c})}else L.Logger.warning("[tk-sdk]getOpenLocalFileName method must be in the client environment!")};g.getSaveLocalFileName=function(a,b){if(TK.isTkNative)if("object"!==typeof a||"function"!==
typeof b)L.Logger.error("[tk-sdk] getSaveLocalFileName function got wrong arguments ,param must is json , callback must is function! ");else{var c=oa();TK.waitNativeToCallbackList[c]=b;tknative.postMessage({command:"getSaveFileName",args:a,seq:c})}else L.Logger.warning("[tk-sdk]getSaveLocalFileName method must be in the client environment!")};g.getLocalFileStreamPlayerPosition=function(a){if(TK.isTkNative)if("function"!==typeof a)L.Logger.error("[tk-sdk] getFileStreamPlayerPosition function got wrong arguments , must is function!");
else{var b=oa();TK.waitNativeToCallbackList[b]=a;tknative.postMessage({command:"getMediaPlayPos",seq:b})}else L.Logger.warning("[tk-sdk]getLocalFileStreamPlayerPosition method must be in the client environment!")};g.getLocalFileMediaInfo=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=oa();TK.waitNativeToCallbackList[c]=b;tknative.postMessage({command:"getMediaFileInfo",seq:c,file:a})}else L.Logger.error("[tk-sdk] getLocalFileMediaInfo function got wrong arguments!");else L.Logger.warning("[tk-sdk]getLocalFileMediaInfo method must be in the client environment!")};
g.pauseLocalFileStream=function(a){TK.isTkNative?"boolean"!==typeof a?L.Logger.error("[tk-sdk] pauseLocalFileStream function got wrong arguments , must is boolean!"):tknative.postMessage({command:"pauseMediaFile",pause:a}):L.Logger.warning("[tk-sdk]pauseLocalFileStream method must be in the client environment!")};g.seekLocalFileStream=function(a){TK.isTkNative?"number"!==typeof a?L.Logger.error("[tk-sdk] seekLocalFileStream function got wrong arguments , must is number!"):(1<a&&(a=1),tknative.postMessage({command:"seekMediaFile",
pos:a})):L.Logger.warning("[tk-sdk]seekLocalFileStream method must be in the client environment!")};g.listenCloseEvent=function(){if(TK.isTkNative)try{talk_window&&talk_window.listenCloseEvent?talk_window.listenCloseEvent():L.Logger.error("[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(q){L.Logger.error("[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning("[tk-sdk]listenCloseEvent method must be in the client environment!")};g.shutdownNativeClient=function(){TK.isTkNative?
tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning("[tk-sdk]shutdownNativeClient method must be in the client environment!")};g.closeWindow=function(){try{talk_window&&talk_window.closeWindow?talk_window.closeWindow():L.Logger.error("[tk-sdk]talk_window.closeWindow is not exist!")}catch(q){L.Logger.error("[tk-sdk] closeWindow function can not be called")}};g.clientAudioMediaPlayer=function(a,b,c){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):
(c=c||{},b?(L.Logger.info("[tk-sdk]clientAudioMediaPlayer url is "+a+" , action is "+b+" , options is"+L.Utils.toJsonStringify(c)),c.audioUrl=a,tknative.postMessage({command:"clientAudioMediaPlayer",action:b,options:c})):L.Logger.error("[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning("[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")};g.clientPreloadMediaFile=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):
Array.isArray(a)?a&&0<a.length&&tknative.postMessage({command:"clientPreloadMediaFile",urlArray:a}):L.Logger.error("[tk-sdk]clientPreloadMediaFile args must is array!"):L.Logger.warning("[tk-sdk]clientPreloadMediaFile method must be in the client environment!")};g.clientOpenBrowserUrl=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):a?tknative.postMessage({command:"clientOpenBrowserUrl",
url:a}):L.Logger.error("[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning("[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")};g.liveSimulateServerCommunicationInterface=function(a){if(H["_handler_"+a]&&"function"===typeof H["_handler_"+a]){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);H["_handler_"+a].apply(null,b)}};g.initBroadcast=function(a,b,c,d,e){TK.isTkNative?a?(b||(b=10),c||(c=3),d&&e?tknative.postMessage({command:"initBroadcast",url:a.toString(),
fps:Number(b),key_sec:Number(c),width:Number(d),height:Number(e)}):L.Logger.error("[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error("[tk-sdk]argument url of initBroadcast function not exist!"):L.Logger.warning("[tk-sdk]initBroadcast method must be in the client environment!")};g.updateBroadcast=function(a,b,c,d){a||(a=10);b||(b=3);c&&d?tknative.postMessage({command:"updateBroadcast",fps:Number(a),key_sec:Number(b),width:Number(c),height:Number(d)}):L.Logger.error("[tk-sdk]argument width or height of updateBroadcast function not exist!")};
g.uninitBroadcast=function(){TK.isTkNative?tknative.postMessage({command:"uninitBroadcast"}):L.Logger.warning("[tk-sdk]uninitBroadcast method must be in the client environment!")};g.startBroadcast=function(a){TK.isTkNative?a?tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error("[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning("[tk-sdk]startBroadcast method must be in the client environment!")};g.stopBroadcast=function(){TK.isTkNative?tknative.postMessage({command:"stopBroadcast"}):
L.Logger.warning("[tk-sdk]stopBroadcast method must be in the client environment!")};H._handler_participantLeft=function(a,b){L.Logger.debug("[tk-sdk]participantLeft userid:"+a);var c=D[a];void 0===c?L.Logger.error("[tk-sdk]participantLeft user is not exist , userid is "+a+"!"):(L.Logger.info("[tk-sdk]user leave room  , user info: "+L.Utils.toJsonStringify(c)),z&&void 0!==b&&(c.leaveTs=b),U[c.role]||(U[c.role]={}),z?D[a]&&(D[a].playbackLeaved=!0):(delete U[c.role][a],delete D[a],delete aa[a]),z&&
"object"===typeof a&&(c.leaveTs=a.ts),a=TK.RoomEvent({type:"room-participant_leave",user:c}),g.dispatchEvent(a))};H._handler_participantJoined=function(a){L.Logger.debug("[tk-sdk]participantJoined userinfo:"+L.Utils.toJsonStringify(a));var b=TK.RoomUser(a);L.Logger.info("[tk-sdk]user join room  , user info: "+L.Utils.toJsonStringify(b));U[b.role]||(U[b.role]={});U[b.role][b.id]=b;D[b.id]=b;z&&D[b.id]&&delete D[b.id].playbackLeaved;z&&"object"===typeof a&&(b.joinTs=a.ts);a=TK.RoomEvent({type:"room-participant_join",
user:b});g.dispatchEvent(a)};H._handler_sendMessage=function(a){L.Logger.debug("[tk-sdk]room-text-message info:"+(a&&"object"===typeof a?L.Utils.toJsonStringify(a):a));if(a&&a.hasOwnProperty("message")){var b=a.fromID,c=p;if(10===T.roomtype)c=void 0;else if(void 0!==b&&(c=D[a.fromID]),!c){L.Logger.error("[tk-sdk]user is not exist , user id:"+a.fromID+", message from room-text-message!");return}z&&(b=!1,a&&a.message&&"string"===typeof a.message&&(a.message=L.Utils.toJsonParse(a.message),b=!0),a.message.ts=
a.ts,b&&"object"===typeof a.message&&(a.message=L.Utils.toJsonStringify(a.message)));a&&a.message&&"string"===typeof a.message&&(a.message=L.Utils.toJsonParse(a.message));a=TK.RoomEvent({type:"room-text-message",user:c,message:a.message});g.dispatchEvent(a)}else L.Logger.error("[tk-sdk]room-text-message messages or messages.message is not exist!")};H._handler_pubMsg=function(a){L.Logger.debug("[tk-sdk]pubMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&
"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));"OnlyAudioRoom"===a.name?(kb(!0),a=TK.RoomEvent({type:"room-audiovideostate-switched",message:{fromId:a.fromID,onlyAudio:!0}})):("DocumentChange"===a.name&&zb(a),a=TK.RoomEvent({type:"room-pubmsg",message:a}));g.dispatchEvent(a)};H._handler_delMsg=function(a){L.Logger.debug("[tk-sdk]delMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));
"OnlyAudioRoom"===a.name?(kb(!1),a=TK.RoomEvent({type:"room-audiovideostate-switched",message:{fromId:a.fromID,onlyAudio:!1}})):a=TK.RoomEvent({type:"room-delmsg",message:a});g.dispatchEvent(a)};H._handler_setProperty=function(a){L.Logger.debug("[tk-sdk]setProperty info:",L.Utils.toJsonStringify(a));var b=a.id;if(a.hasOwnProperty("properties")){var c=a.properties,d=D[b];if(p.id===b)if(d=p,c.hasOwnProperty("publishstate")){var e=c.publishstate;L.Logger.debug("[tk-sdk]onChangeMyPublishState "+p.publishstate+
" to "+e);e>TK.PUBLISH_STATE_NONE?(l(e),v&&void 0===g.localStreams[v.getID()]&&!v.isPublishing&&g.publish(v)):v&&!v.isUnpublishing&&g.localStreams[v.getID()]&&g.unpublish(v);p.publishstate=e;if(!(!0!==p._audiopublished_&&!0!==p._videopublished_&&p.publishstate>TK.PUBLISH_STATE_NONE)&&(!0!==p._audiopublished_&&!0!==p._videopublished_||p.publishstate!==TK.PUBLISH_STATE_NONE)){Aa(v);var k=p.publishstate,h=k===TK.PUBLISH_STATE_AUDIOONLY||k===TK.PUBLISH_STATE_BOTH;k=k===TK.PUBLISH_STATE_VIDEOONLY||k===
TK.PUBLISH_STATE_BOTH;p._audiopublished_=h;p._videopublished_=k}}else c.hasOwnProperty("disablevideo")?(e=c.disablevideo,L.Logger.debug("[tk-sdk]onChangeMyDisableVideoState "+p.disablevideo+" to "+e),p.disablevideo!=e&&(p.disablevideo=e,p.publishstate>TK.PUBLISH_STATE_NONE&&l())):c.hasOwnProperty("disableaudio")?(e=c.disableaudio,L.Logger.debug("[tk-sdk]onChangeMyDisableAudioState "+p.disableaudio+" to "+e),p.disableaudio!=e&&(p.disableaudio=e,p.publishstate>TK.PUBLISH_STATE_NONE&&l())):c.hasOwnProperty("hasaudio")?
v.audio=c.hasaudio:c.hasOwnProperty("hasvideo")&&(v.video=c.hasvideo);if(void 0===d)L.Logger.error("[tk-sdk]setProperty user is not exist , userid is "+b+"!");else{e=d.servername;for(var m in c)"id"!=m&&"watchStatus"!=m&&(d[m]=c[m]);if(p.id!==d.id&&c.hasOwnProperty("publishstate"))for(m in g.remoteStreams)h=g.remoteStreams[m],h.extensionId!==p.id&&h.extensionId===d.id&&"video"===h.getAttributes().type&&(Xa(h),!0!==d._audiopublished_&&!0!==d._videopublished_&&d.publishstate>TK.PUBLISH_STATE_NONE||
(!0===d._audiopublished_||!0===d._videopublished_)&&d.publishstate===TK.PUBLISH_STATE_NONE||(Aa(h),k=d.publishstate,h=k===TK.PUBLISH_STATE_AUDIOONLY||k===TK.PUBLISH_STATE_BOTH,k=k===TK.PUBLISH_STATE_VIDEOONLY||k===TK.PUBLISH_STATE_BOTH,d._audiopublished_=h,d._videopublished_=k));d=TK.RoomEvent({type:"room-userproperty-changed",user:d,message:c},{fromID:a.fromID});g.dispatchEvent(d);p.id==b&&c.hasOwnProperty("servername")&&(p.id!==a.fromID?c.servername&&c.servername!==e&&g.switchServerByName(c.servername):
c.servername&&c.servername!==e&&(S=c.servername,f(O,S)))}}};H._handler_playback_clearAll=function(){if(z){var a=TK.RoomEvent({type:"room-playback-clear_all"});g.dispatchEvent(a);z?(void 0!=D&&(P(U),F(D)),null!=p&&(p.publishstate=TK.PUBLISH_STATE_NONE)):L.Logger.error("[tk-sdk]No playback environment, no execution playbackClearAll!")}else L.Logger.warning("[tk-sdk]No playback environment!")};H._handler_duration=function(a){if(z){var b=TK.RoomEvent({type:"room-playback-duration",message:a});Ba=a;g.dispatchEvent(b)}else L.Logger.warning("[tk-sdk]No playback environment!")};
H._handler_playbackEnd=function(){if(z){var a=TK.RoomEvent({type:"room-playback-playbackEnd"});g.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")};H._handler_playback_updatetime=function(a){z?(a=TK.RoomEvent({type:"room-playback-playback_updatetime",message:a}),g.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")};H._handler_connectSocketSuccess=function(a,b){TK.isTkNative&&!va&&(va=!0,tknative.postMessage({command:"initNative",localId:p.id.toString(),
width:Number(ea),height:Number(na),fps:Number(fa),roomInfo:Na,webAddr:y.toString(),webPort:C.toString()}));var c=b.roominfo;a=b.msglist;var d=b.userlist,e=[];var f=c.streams||[];g.p2p=c.p2p;var k=c.id;g.iceServers=c.iceServers;E.defaultVideoBW=Fa;E.maxVideoBW=Fa;E.defaultScreenBW=Y(1280,20);E.maxScreenBW=Y(1280,20);E.defaultLocalFileMediaBW=Y(640,30);E.maxLocalFileMediaBW=Y(640,30);D={};U={};u(6);for(var h in f)if(f.hasOwnProperty(h)){c=f[h];var m=!1;TK.subscribe_from_native&&(m=!0);m=TK.Stream({streamID:c.id,
local:!1,audio:c.audio,video:c.video,data:c.data,screen:c.screen,attributes:c.attributes,extensionId:c.extensionId,room:g,checkMyAudioAndVideoEnable:function(a){p&&p.id&&(a=a||p.id,a===p.id&&(TK.isTkNative&&(r(!0),w(!0)),p.publishstate>TK.PUBLISH_STATE_NONE&&l()))}},m);e.push(m);g.remoteStreams[c.id]=m;L.Logger.info("[tk-sdk]room-connected --\x3e stream info , stream id:"+m.getID()+" , extensionId is "+m.extensionId+", attrs is "+L.Utils.toJsonStringify(m.getAttributes()));g.subscribe(m)}for(h in d)d.hasOwnProperty(h)&&
(f=TK.RoomUser(d[h]),void 0!==f&&(U[f.role]||(U[f.role]={}),U[f.role][f.id]=f,D[f.id]=f,z&&D[f.id]&&delete D[f.id].playbackLeaved,L.Logger.info("[tk-sdk]room-connected --\x3e user info: "+L.Utils.toJsonStringify(f))));L.Logger.info("[tk-sdk]room-connected --\x3e myself info: "+L.Utils.toJsonStringify(p));h=[];a&&"string"==typeof a&&(a=L.Utils.toJsonParse(a));a.hasOwnProperty("OnlyAudioRoom")?(kb(!0),d=TK.RoomEvent({type:"room-audiovideostate-switched",message:{fromId:a.OnlyAudioRoom.fromID,onlyAudio:!0}}),
g.dispatchEvent(d),2===TK.needOnlyAudioRoom&&g.switchOnlyAudioRoom(!1)):1===TK.needOnlyAudioRoom&&g.switchOnlyAudioRoom(!0);for(var t in a)a.hasOwnProperty(t)&&h.push(a[t]);h.sort(function(a,b){return void 0!==a&&a.hasOwnProperty("seq")&&void 0!==b&&b.hasOwnProperty("seq")?a.seq-b.seq:0});g.roomID=k;da=!0;L.Logger.debug("[tk-sdk]Connected to room "+g.roomID);L.Logger.debug("[tk-sdk]connected response:",L.Utils.toJsonStringify(b));L.Logger.info("[tk-sdk]room-connected ,streams length is "+e.length+
" , signalling list length "+h.length);N&&N.changeCommonWhiteBoardConfigration&&N.changeCommonWhiteBoardConfigration({webAddress:M+"://"+y+":"+C,docAddress:ua+"://"+la+":"+ma,backupDocAddress:ra+"://"+ja+":"+ka,myUserId:p.id,myName:p.nickname,myRole:p.role,isConnectedRoom:da,isPlayback:z});b=TK.RoomEvent({type:"room-connected",streams:e,message:h});g.dispatchEvent(b);sa&&(g.stopIntervalRtcStatsrObserver(),g.startIntervalRtcStatsrObserver())};window.onNativeWindowClose=function(){if(TK.isTkNative){var a=
TK.RoomEvent({type:"room-cilent-close"});g.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]window.onNativeWindowClose method must be in the client environment!")};TK&&TK.coreEventController&&(TK.coreEventController.addEventListener("getUserMedia_success",function(a){g.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure",function(a){g.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure_reGetOnlyAudioStream",function(a){g.dispatchEvent(a)}));
return TK.roomInstance=g}};window.TK=window.TK||{};TK.PUBLISH_STATE_NONE=0;TK.PUBLISH_STATE_AUDIOONLY=1;TK.PUBLISH_STATE_VIDEOONLY=2;TK.PUBLISH_STATE_BOTH=3;TK.PUBLISH_STATE_MUTEALL=4;TK.RoomUser=function(b){if(void 0==b||void 0===b.properties)L.Logger.warning("[tk-sdk]Invalidate user info",a,c);else{var a=b.id,c=b.properties;L.Logger.debug("[tk-sdk]RoomUser",a,c);b={};b.id=a;b.watchStatus=0;for(var e in c)"id"!=e&&"watchStatus"!=e&&(b[e]=c[e]);b.publishstate=b.publishstate||TK.PUBLISH_STATE_NONE;return b}};window.L=window.L||{};window.TK=window.TK||{};
L.Logger=function(b){var a="",c=!1;var e=function(a,e){try{switch(e){case b.Logger.DEBUG:c?console.warn.apply(console,a):console.debug.apply(console,a);break;case b.Logger.TRACE:console.trace.apply(console,a);break;case b.Logger.INFO:c?console.warn.apply(console,a):console.info.apply(console,a);break;case b.Logger.WARNING:console.warn.apply(console,a);break;case b.Logger.ERROR:console.error.apply(console,a);break;case b.Logger.NONE:console.warn("log level is none!");break;default:c?console.warn.apply(console,
a):console.log.apply(console,a)}}catch(n){console.log.apply(console,a)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(a){c=a},enableLogPanel:function(){b.Logger.panel=document.createElement("textarea");b.Logger.panel.setAttribute("id","licode-logs");b.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");b.Logger.panel.setAttribute("rows",20);b.Logger.panel.setAttribute("cols",20);b.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(b.Logger.panel)},
setLogLevel:function(a){a>b.Logger.NONE?a=b.Logger.NONE:a<b.Logger.DEBUG&&(a=b.Logger.DEBUG);b.Logger.logLevel=a},setOutputFunction:function(a){e=a},setLogPrefix:function(b){a=b},print:function(c){var d=a;if(!(c<b.Logger.logLevel)){c===b.Logger.DEBUG?d=d+"DEBUG("+(new Date).toLocaleString()+")":c===b.Logger.TRACE?d=d+"TRACE("+(new Date).toLocaleString()+")":c===b.Logger.INFO?d=d+"INFO("+(new Date).toLocaleString()+")":c===b.Logger.WARNING?d=d+"WARNING("+(new Date).toLocaleString()+")":c===b.Logger.ERROR&&
(d=d+"ERROR("+(new Date).toLocaleString()+")");d+=":";for(var n=[],f=0;f<arguments.length;f++)n[f]=arguments[f];n=n.slice(1);n=[d].concat(n);if(void 0!==b.Logger.panel){d="";for(f=0;f<n.length;f++)d+=n[f];b.Logger.panel.value=b.Logger.panel.value+"\n"+d}else e.apply(b.Logger,[n,c])}},debug:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,
[b.Logger.TRACE].concat(a))},info:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.INFO].concat(a))},warning:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.WARNING].concat(a))},error:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.print.apply(b.Logger,[b.Logger.ERROR].concat(a))}}}(L);
TK.tkLogPrintConfig=function(b,a,c){a=a||{};b=b||{};c=c||{};var e=void 0!=a.logLevel?a.logLevel:0;b=void 0!=b.debug?b.debug:!0;c=void 0!=c.webrtcLogDebug?c.webrtcLogDebug:!0;L.Logger.setLogDevelopment(void 0!=a.development?a.development:!0);L.Logger.setLogLevel(e);L.Utils.localStorage&&L.Utils.localStorage.setItem("debug",b?"*":"none");window.webrtcLogDebug=c};TK.Logger=L.Logger;window.L=window.L||{};
L.Base64=function(){var b,a,c;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var d=[];for(c=0;c<e.length;c+=1)d[e[c]]=c;var m=function(c){b=c;a=0};var n=function(){if(!b||a>=b.length)return-1;var c=b.charCodeAt(a)&255;a+=1;return c};var f=function(){if(!b)return-1;for(;;){if(a>=b.length)return-1;var c=b.charAt(a);a+=1;if(d[c])return d[c];if("A"===c)return 0}};var h=function(a){a=a.toString(16);1===a.length&&(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b;
m(a);a="";var c=Array(3);var d=0;for(b=!1;!b&&-1!==(c[0]=n());)c[1]=n(),c[2]=n(),a+=e[c[0]>>2],-1!==c[1]?(a+=e[c[0]<<4&48|c[1]>>4],-1!==c[2]?(a+=e[c[1]<<2&60|c[2]>>6],a+=e[c[2]&63]):(a+=e[c[1]<<2&60],a+="\x3d",b=!0)):(a+=e[c[0]<<4&48],a+="\x3d",a+="\x3d",b=!0),d+=4,76<=d&&(a+="\n",d=0);return a},decodeBase64:function(a){var b;m(a);a="";var c=Array(4);for(b=!1;!b&&-1!==(c[0]=f())&&-1!==(c[1]=f());)c[2]=f(),c[3]=f(),a+=h(c[0]<<2&255|c[1]>>4),-1!==c[2]?(a+=h(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=h(c[2]<<
6&255|c[3]):b=!0):b=!0;return a}}}(L);window.TK=window.TK||{};TK.View=function(){var b=TK.EventDispatcher({});b.url="";return b};window.TK=window.TK||{};
TK.VideoPlayer=function(b){b.options=b.options||{};b.options.bar=void 0!==b.options.bar?b.options.bar:!1;b.options.mirror=b.options.mirror||!1;b.options.mode=b.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;var a=void 0!==b.options.audioPlayer?b.options.audioPlayer:b.stream&&b.stream.hasVideo&&b.stream.hasAudio?!b.stream.hasVideo()&&b.stream.hasAudio():!1,c=TK.View({}),e=100,d=void 0,m=void 0,n=void 0,f=void 0,h=!1,l=!1!==b.options.loader,r=void 0;c.id=b.id;c.local=b.stream.local;c.videoPlayerMediaStreamClone=
b.stream.stream;c.type=b.stream&&b.stream.getAttributes&&b.stream.getAttributes()?b.stream.getAttributes().type:void 0;c.elementID=b.elementID;c.isAudioPlayer=a;c.bundleId=b.bundleId;var w=function(){c.bar.display()};var t=function(){c.bar.hide()};c.destroy=function(){L.Utils.mediaPause(c.video);delete c.resizer;try{c.div&&c.container.removeChild(c.div),c.stopIntervalGetRealtimeVolume()}catch(F){L.Logger.error("[tk-sdk]videoplayer destroy error , removeChild method error info:",F)}};c.resize=function(){var a=
c.container.offsetWidth,d=c.container.offsetHeight;if(b.stream.screen||!1===b.options.crop)9/16*a<d?(c.video.style.width=a+"px",c.video.style.height=9/16*a+"px",c.video.style.top=-(9/16*a/2-d/2)+"px",c.video.style.left="0px"):(c.video.style.height=d+"px",c.video.style.width=16/9*d+"px",c.video.style.left=-(16/9*d/2-a/2)+"px",c.video.style.top="0px");else if(a!==c.containerWidth||d!==c.containerHeight)3/4*a>d?(c.video.style.width=a+"px",c.video.style.height=3/4*a+"px",c.video.style.top=-(3/4*a/2-d/
2)+"px",c.video.style.left="0px"):(c.video.style.height=d+"px",c.video.style.width=4/3*d+"px",c.video.style.left=-(4/3*d/2-a/2)+"px",c.video.style.top="0px");c.containerWidth=a;c.containerHeight=d};c.videoPlayerMediaStreamClone&&"object"===typeof c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream "+c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=c.videoPlayerMediaStreamClone.playbackquUrl):c.videoPlayerMediaStreamClone&&
(L.Logger.debug("[tk-sdk]Creating URL from stream "+c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=(window.URL||webkitURL).createObjectURL(c.videoPlayerMediaStreamClone));c.div=document.createElement("div");c.div.setAttribute("id","player_"+c.id);c.div.setAttribute("class","Talk_player");c.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(a?"  display: none;":" "));!1!==b.options.loader&&(c.loader=document.createElement("div"),
c.loader.setAttribute("id","back_"+c.id),c.loader.setAttribute("class","Talk_loader"),c.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'));
c.video=a?document.createElement("audio"):document.createElement("video");c.video.setAttribute("id","stream"+c.id);c.video.setAttribute("class","Talk_stream");c.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(b.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":"")+(b.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?" -webkit-object-fit:cover; -moz-object-fit:cover;-o-object-fit:cover;-ms-object-fit:cover;object-fit:cover;":
""));c.video.setAttribute("autoplay","autoplay");c.video.setAttribute("webkit-playsinline","true");c.video.setAttribute("x-webkit-airplay","true");c.video.setAttribute("playsinline","true");c.video.setAttribute("x5-video-player-type","h5");c.video.setAttribute("x5-video-player-fullscreen","true");c.videoSupernatant=document.createElement("div");c.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");c.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");
c.updateVideoPlayerOptions=function(a){a&&"object"===typeof a&&(void 0!==a.mirror&&(b.options.mirror=a.mirror,c.video.style.webkitTransform=a.mirror?"rotateY(180deg)":"",c.video.style.mozTransform=a.mirror?"rotateY(180deg)":"",c.video.style.oTransform=a.mirror?"rotateY(180deg)":"",c.video.style.msTransform=a.mirror?"rotateY(180deg)":"",c.video.style.transform=a.mirror?"rotateY(180deg)":""),void 0!==a.mode&&(b.options.mode=a.mode,c.video.style.webkitObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?
"cover":"",c.video.style.mozObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.oObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.msObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",c.video.style.objectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":""),void 0!=a.loader&&(b.options.loader=a.loader,l=!1!==b.options.loader))};c.showVideoContainer=function(){c.container&&(c.container.style.display="block")};
c.hideVideoContainer=function(){c.container&&(c.container.style.display="none")};c.showVideo=function(){c.video&&(c.video.style.display="block");l&&c.loader&&(c.loader.style.display="")};c.hideVideo=function(){c.video&&(c.video.style.display="none");l&&c.loader&&(c.loader.style.display="none")};c.changeMediaStreamUrl=function(a){if(c.video&&a&&(c.videoPlayerMediaStreamClone=a,c.videoPlayerMediaStreamClone&&"object"===typeof c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.playbackquUrl?
(L.Logger.debug("[tk-sdk]Creating palyback URL from stream:",c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=c.videoPlayerMediaStreamClone.playbackquUrl):c.videoPlayerMediaStreamClone&&(L.Logger.debug("[tk-sdk]Creating URL from stream: ",c.videoPlayerMediaStreamClone),c.videoPlayerMediaStreamCloneUrl=(window.URL||webkitURL).createObjectURL(c.videoPlayerMediaStreamClone)),c.videoPlayerMediaStreamClone&&void 0!==c.video.srcObject?(c.video.srcObject=c.videoPlayerMediaStreamClone,c.video.load()):
c.videoPlayerMediaStreamCloneUrl&&(c.video.src=c.videoPlayerMediaStreamCloneUrl,c.video.load()),void 0!==m&&void 0!==n&&void 0!==f)){a=f;var b=n,d=r;c.stopIntervalGetRealtimeVolume();c.startIntervalGetRealtimeVolume(a,b,d)}};c.setMute=function(a){"boolean"!==typeof a?L.Logger.error("[tk-sdk]Stream setMute isMute type must is boolean!"):(c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setMute:local video must is mute!"),h=!0):h=a,c.video&&void 0!==c.video.muted&&(c.video.muted=h),c.audio&&
void 0!==c.audio.muted&&(c.audio.muted=h))};c.setVolume=function(a){"number"!==typeof a?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):(c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),e=0):e=a,c.video&&void 0!==c.video.volume&&(c.video.volume=e/100),c.audio&&void 0!==c.audio.volume&&(c.audio.volume=e/100))};c.getVolume=function(a){if(a&&"function"===typeof a){if(c.video&&void 0!==c.video.volume)return a(parseInt(100*
c.video.volume)),parseInt(100*c.video.volume);L.Logger.warning("[tk-sdk]videoPlayer getVolume failure , video is not exist!");a(e);return e}L.Logger.warning("[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!");return e};c.startIntervalGetRealtimeVolume=function(a,b,e){if("function"!==typeof a)L.Logger.warning("[tk-sdk]setIntervalGetRealtimeVolume intervalCallback must is function!");else if(c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.getAudioTracks&&
c.videoPlayerMediaStreamClone.getAudioTracks().length){n="number"===typeof b?b:100;f=a;r=e;try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext}catch(G){L.Logger.error("[tk-sdk]setIntervalGetRealtimeVolume:Web Audio API(audioContext) not supported")}try{d&&d.stop&&(d.stop(),d=void 0),TK.audioContext&&c.videoPlayerMediaStreamClone&&TK.DeviceMgr&&TK.DeviceMgr.getsSoundMeterInstance?
(d=TK.DeviceMgr.getsSoundMeterInstance(TK.audioContext))&&d.connectToSource?d.connectToSource(c.videoPlayerMediaStreamClone,function(a){a?(L.Logger.error("[tk-sdk]setIntervalGetRealtimeVolume connectToSource error:",a),void 0!==r&&L.Utils.isFunction(r)&&r(a,c.bundleId)):(d.instant&&d.instant.toFixed?(a=Math.floor(100*d.instant.toFixed(2)),void 0!==f&&L.Utils.isFunction(f)&&f(a,c.bundleId)):void 0!==f&&L.Utils.isFunction(f)&&f(0,c.bundleId),clearInterval(m),m=setInterval(function(){if(d.instant&&d.instant.toFixed){var a=
Math.floor(100*d.instant.toFixed(2));void 0!==f&&L.Utils.isFunction(f)&&f(a,c.bundleId)}else void 0!==f&&L.Utils.isFunction(f)&&f(0,c.bundleId)},n))}):void 0!==f&&L.Utils.isFunction(f)&&f(0,c.bundleId):void 0!==f&&L.Utils.isFunction(f)&&f(0,c.bundleId)}catch(G){L.Logger.error("[tk-sdk]setIntervalGetRealtimeVolume error :",G),void 0!==r&&L.Utils.isFunction(r)&&r(G,c.bundleId)}}else L.Logger.warning("[tk-sdk]setIntervalGetRealtimeVolume audio track is empty!")};c.stopIntervalGetRealtimeVolume=function(){d&&
d.stop&&d.stop();clearInterval(m);r=f=n=m=d=void 0};c.hideLoading=function(){l=!1;c.loader&&(c.loader.style.display="none");c.div.style.backgroundColor="transparent"};c.showLoading=function(){l=!0;c.loader&&(c.loader.style.display="");c.div.style.backgroundColor=""};TK.isOnlyAudioRoom&&c.hideVideo();c.local&&"video"===c.type&&(c.setVolume(0),c.setMute(!0));c.container=void 0!==c.elementID?"object"===typeof c.elementID&&"function"===typeof c.elementID.appendChild?c.elementID:document.getElementById(c.elementID):
document.body;c.container.appendChild(c.div);c.loader&&c.div.appendChild(c.loader);c.div.appendChild(c.video);c.div.appendChild(c.videoSupernatant);c.containerWidth=0;c.containerHeight=0;!1!==b.options.bar?(c.bar=new TK.Bar({elementID:"player_"+c.id,id:c.id,stream:b.stream,media:c.video,options:b.options}),c.div.onmouseover=w,c.div.onmouseout=t):c.media=c.video;c.videoPlayerMediaStreamClone&&void 0!==c.video.srcObject?(c.video.srcObject=c.videoPlayerMediaStreamClone,c.video.load()):c.videoPlayerMediaStreamCloneUrl&&
(c.video.src=c.videoPlayerMediaStreamCloneUrl,c.video.load());var k=function(){c.video&&0!==c.video.readyState&&c.audio&&(c.div&&c.div.removeChild&&c.audio&&(c.audio.src="",c.div.removeChild(c.audio)),c.audio=void 0)};c.video.oncanplay=function(a){c.hideLoading();c.video.oncanplay=void 0;c.video.onloadeddata=void 0;c.video.onloadedmetadata=void 0;k()};c.video.onloadeddata=function(a){c.hideLoading();c.video.oncanplay=void 0;c.video.onloadeddata=void 0;c.video.onloadedmetadata=void 0;k()};c.video.onloadedmetadata=
function(a){c.hideLoading();c.video.oncanplay=void 0;c.video.onloadeddata=void 0;c.video.onloadedmetadata=void 0;k()};c.video.onreadystatechange=function(a){k()};c.videoPlayerMediaStreamClone?"object"===typeof c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.playbackquUrl||(w=c.videoPlayerMediaStreamClone.getVideoTracks?c.videoPlayerMediaStreamClone.getVideoTracks():void 0,w&&0<w.length||(L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not videoTracks , hide video element , VideoPlayer id is "+
c.id+"!"),c.hideVideo())):(L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not exist , hide video element , VideoPlayer id is "+c.id+"!"),c.hideVideo());var u=function(){try{if(a||!c.video||0!==c.video.readyState||c.local||setTimeout(function(){if(c&&c.video&&0===c.video.readyState&&c.videoPlayerMediaStreamCloneUrl&&c.div){c.audio=document.createElement("audio");c.audio.setAttribute("id","stream_temp_audio_"+c.id);c.audio.setAttribute("autoplay","autoplay");c.audio.style.display="none";c.div.appendChild(c.audio);
var a=c.videoPlayerMediaStreamClone&&c.videoPlayerMediaStreamClone.clone?c.videoPlayerMediaStreamClone.clone():void 0,b=c.videoPlayerMediaStreamCloneUrl;if(a&&a.getVideoTracks&&a.getVideoTracks()&&0<a.getVideoTracks().length){b=window.URL||webkitURL;for(var d=a.getVideoTracks().length-1;0<=d;d--){var e=a.getVideoTracks()[d];a.removeTrack(e)}b=b.createObjectURL(a)}a&&void 0!==c.audio.srcObject?(c.audio.srcObject=a,c.audio.load()):b&&(c.audio.src=b,c.audio.load());c.local&&"video"===c.type&&(c.setVolume(0),
c.setMute(!0));var f=function(){if(c.audio&&c.audio.play){var a=L.Utils.mediaPlay(c.audio);a&&a.catch&&a.catch(function(a){L.Logger.warning("[tk-sdk]audio.play method catch error , videoPlayer id is "+c.id+" , error info:"+a)})}};(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))?TK.DeviceMgr.setElementSinkIdToAudioouputDevice(c.audio,a,function(){f()}):f()}},250),c.video&&c.video.play){var b=L.Utils.mediaPlay(c.video);b&&b.catch&&b.catch(function(a){L.Logger.warning("[tk-sdk]video.play method catch error , videoPlayer id is "+
c.id+" , error info:"+a)})}}catch(P){L.Logger.warning("[tk-sdk]video.play method error , videoPlayer id is "+c.id+" !")}};w=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);c.video&&w?TK.DeviceMgr.setElementSinkIdToAudioouputDevice(c.video,w,function(){u()}):u();return c};window.TK=window.TK||{};
TK.NativeVideoPlayer=function(b){b.options=b.options||{};b.options.bar=void 0!==b.options.bar?b.options.bar:!1;var a=void 0!==b.options.audioPlayer?b.options.audioPlayer:!1,c=TK.View({}),e=100,d=!1,m=!1!==b.options.loader,n=0,f=void 0,h=void 0,l=void 0;c.id=b.id;c.local=b.stream.local;c.videoPlayerMediaStreamClone=b.stream.stream;c.type=b.stream&&b.stream.getAttributes&&b.stream.getAttributes()?b.stream.getAttributes().type:void 0;c.elementID=b.elementID;var r=function(){c.bar.display()};var w=function(){c.bar.hide()};
var t=function(a){if(TK.isTkNative){var b=a.data.name;"onNativeNotification"===b?(a=a.data.arg,"object"!==typeof a||"onRemoteAudioVolume"!==a.name||L.Utils.isNull(a.args)||(a=a.args,b=a.type,""!==b&&(a.id=a.id+":"+b),a.id===c.id&&(n=a.volume))):"onMicVolumeReport"===b&&c.local&&(n=a.data.volume)}};TK.isTkNative&&tknative.addEventListener("message",t,!1);c.destroy=function(){c.parentNode.removeChild(c.div)};c.resize=function(){var a=c.container.offsetWidth,d=c.container.offsetHeight;if(b.stream.screen||
!1===b.options.crop)9/16*a<d?(c.video.style.width=a+"px",c.video.style.height=9/16*a+"px",c.video.style.top=-(9/16*a/2-d/2)+"px",c.video.style.left="0px"):(c.video.style.height=d+"px",c.video.style.width=16/9*d+"px",c.video.style.left=-(16/9*d/2-a/2)+"px",c.video.style.top="0px");else if(a!==c.containerWidth||d!==c.containerHeight)3/4*a>d?(c.video.style.width=a+"px",c.video.style.height=3/4*a+"px",c.video.style.top=-(3/4*a/2-d/2)+"px",c.video.style.left="0px"):(c.video.style.height=d+"px",c.video.style.width=
4/3*d+"px",c.video.style.left=-(4/3*d/2-a/2)+"px",c.video.style.top="0px");c.containerWidth=a;c.containerHeight=d};c.div=document.createElement("div");c.div.setAttribute("id","player_"+c.id);c.div.setAttribute("class","Talk_player");c.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+(a?"  display: none;":" "));!1!==b.options.loader&&(c.loader=document.createElement("div"),c.loader.setAttribute("id","back_"+c.id),c.loader.setAttribute("class",
"Talk_loader"),c.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,R0lGODlhgACAAPIEAAAA/5mZmbu7u93d3f///////wAAAAAAACH5BAUFAAUAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAgACAAAAD/li63P4wykmrvTjrzbv/oEaMRGieaEaSaeu66/rOdBezda5P97j/wEWvFCzmhsbkDKlsFgbQwYfZCVgDTk006qFurtfsZbu19argsJhC5nK8mbR6LWm7Reev3Eqf2O8YcBZ7c30Qf1J4N3p7hmx/ijEahFiOfpAqeRiUlo92mYubhJ2enxeCEpSVpHWYFqgRnKyXrhSwD6qzpWSnmhSyurRtr76po8G7ZRW3DcDIraY8xRDOzxGIiRLMCrnWyYAQ2wXV3oeI0qGx5OUP5+g4xo10AvQCIe7a8OryH2Af9fVA4AuxLk6aDgATfqgF4hgafhkSSuzAsB9EgwUpSNzI/mFYCjkcVBXCsJHjBmUt/DESibDkRHbURI7U4NIkTG4yZ3Ko+bJcTp0eeCr09pOPC6EAkRVdNQNpQFJLfzil1ylqkKmOijZBmlXmGp5dMyapGfbivJ6GzDpKChXozbdw48qdS7eu3bt48+rdy7cv36XdfAJ2yGBw4GeGqyU+rGuxM8eEG0MGuWAyZaWWVeLMbBQzZ6bjOAvOjMsyTNJ+U6tezbq169ewY8ueTbv2DM2WcFe9nJZ3H8ZigDth2VsskJxljdfQWtxrEKvJieuAnps5DeqssJ/QLvnnR+tEwXvgHt77ePNzxYtyPsmtxc4YpcdXHlM3wYMr6ZfWvx+/0onI6wE4iIAB2neeb+2pNaCB8zEYEoEFgpaghPk5WJl7myG40m8QXmhhhv7VJVxhCnpY4k3KdQjih6OduCJ89blYnoYOqPgijG/pZ+ONFLKjo4w8ysXfjkHmOCSQPPboGY0xskgiktUReWOETkbJZJMY1iglh1CaWOWTV+7W5ZQNZtlciBds6eWXWYw4gZpJLolmmmOuaWZwddqp5C95GgGnng/N2RabWob5pqDZ3bkPonTiqNqftpEZ6YSETiqppY0yiimWjm4aj6KemhjqqJ4mAAAh+QQFBQAFACwKAAIAVwAwAAAD/li63P4wvkGHvDjrPSvlYChKnjeeKFdWaet26yu/6zffZ23hPKj3I4FQkPqhCEhCazhEGUfJJIrJzNVO0eiJ2hw9Q1lpkCv0XkVhsYjc9Z1BafWaLfpu4soUm+iOweMueyF2GXgvgipvGoaHiBqEEnh5jWSJfouAM3t8GZAQkjiOGJ4PjKF0nYqRmTyiJKoRpq2oF6QMsrO0EbYKoEAKrjAlGLg9m7WwDb6/wLoQl7GsEAHUAYHOwsTSD9XVS9hH2w3d5HqVMuLj5OVjXDPpDOvy7W3oWRjy83NlPFoZ+fqYCQQYUOAvgusMMkPITiEQht0cpqAWAaI3iSAiVrRoJw2jhoYbIXrEB1KCyJEmS15AiDKlxg0EW4a8mDGhzJkdRby8Oa1aAgAh+QQFBQAFACwfAAIAVwAwAAAD/li63P5LSAGrvTjrNuf+YKh1nWieIumhbFupkivPBUzR+GnnfLj3ooAwwPqdBshBazhEGUXJJIrJ1MGOUamJ2jQ9QVltkCv0XqFh5IncBX01afGYnDqD40u2z76JK/N0bnxweC5sRB9vF34zh4gjg4uMjXobihWTlJUZlw9+fzSHlpGYhTminKSepqebF50NmTyor6qxrLO0L7YLn0ALuhCwCrJAjrUqkrjGrsIkGMW/BcEPJcphLgTaBBjUKNEh29vdgTLLIOLpF80s5xrp8ORVONgi8PcZ8zlRJvf40tL8/QPYQ+BAgjgMxkPIQ6E6BmUYonAo7oE+iRsojoNAKgVjRo3cKnDxiAGkvDYkIVDUMDJlBYUfWrp8YBBEx5kvF9pEiZPmRhEJAAAh+QQFBQAFACw8AAIAQgBCAAAD/lgVHPowykmrna3dzXvNmSeOFqiRaGoyaTuujitv8Gx/661HtSv8gt2jlwIChYtc0XjcEUnMpu4pikpv1I71astytkGh9wJGJk3QrXlcKa+VWjeSPZHP4Rtw+I2OW81DeBZ2fCB+UYCBfWRqiQp0CnqOj4J1jZOQkpOUIYx/m4oxg5cuA6YDO4Qop6c6pKusrDevIrG2rkwptrupXB67vKAbwMHCFcTFxhLIt8oUzLHOE9Cy0hHUrdbX2KjaENzey9Dh08jkz8Tnx83q66bt8PHy8/T19vf4+fr6BP3+/wADAjQmsKDBf6AOKjS4aaHDgZMeSiTQcKLDhBYPEswoA1BBAgAh+QQFBQAFACxOAAoAMABXAAAD91i6vPGhyUkrhdDqfXHm4OZ9YSmNpKmiqVqykbuysgvX5o2HcLxzup8oKLQQix0UcqhcVo5ORi+aHFEn02sDeuWqBGCBkbYLh5/NmnldxajX7LbPBK+PH7K6narfO/t+SIBwfINmUYaHf4lghYyOhlqJWgqDlAuAlwyBmpVnnaChoqOkpaanqKmqKgOtrq+wsbA1srW2ry63urasu764Jr/CA73Du7nGt7TJsqvOz9DR0tPU1TIE2ASl2dyi3N/aneDf4uPklObj6OngWuzt7u/d8fLY9PXr9eFX+vtV1/jkAHwnB89AcwXnuEiXUOHCc1jI7JhHIQEAIfkEBQUABQAsTgAfADAAVwAAA/IYulv+MErI5mPY6omD7somOmDIgeNXmmeVSqtrye8VN3V+07m4873ZjxXcDInF1i9pPDKbw6dqKZ3Gqr4rNlvaplDeFzBMLpvP6LR6zW673/C3YE6v2+92Jn7Prxf7gHxBgYR5PYWIAoOJhH+MfXqPeHGUlZaXmJmam5xnA58DlKCjb6OmoWynpqmqq2mtqq+wp2iztLW2pLi5n7u8sryonsEiBMYEScQWx8fJucvMzc6w0NHIT9QT1tLYrtrb11K6GuDha+XmauVu6Ozgb+tt8fLv9PVs8+f56vf4/fzb4P1L086eNYEH3SVUyA1hui0JAAAh+QQFBQAFACw8ADwAQgBCAAAD+Vi63P5QhUmrvTbqHbH/FSdyYPmN6GOuWepKbPy+sTy7tXnP+bn/wKBwSCwaj8ikcslsOp/QqHRaEFgF1Nd1mx1tv9iuBvwVR8hgswNNVjPYbXcVXpbP6Vf7HR928/N2f1Z6gkYDhwM3f0SIiIp4Q42NO3SRkodAbJaXiZl1EQShBBycmEFcGqKipKVPqqobpaZMr6uxrU21oay4S7qjvJe5uiOytMQixr7Iyb1Ivyiync/MzZxK0NHKR9na19S1L9tF3d7C3NXmkujh4uNC5SnvQfHy30T16o7k6S7n/O12TGL3So+DfHYQylHohqEahw8LGnwAa2KDBAAh+QQFBQAFACwfAE4AVwAwAAAD/hga1f4wykmrW8xSnLX/IKeAj0ie6CUup5m+34qRLmxv8uzVd1/mHE3QR/wBdRNkcXkcSkbLqLHZkVpx1Op1q8pyv9MmeJzVUghowlXAFry8lnRa2m6/xRW5fFmvw45xemh8fWw3OXmCg0WFdodOE4qLFQOVAxqNhj1KEpJqFpaWmJljBZ6fFKGhFpmaX54aqqKspK+woLKXtLVbt7iyHq1cvr+qH8JXxJS5x7xRysvAzY1SpyC5usHIRdDRxiDbPtbXzODhN93eqyTnMOnqs+zO7pIo2CjtKO/wlSn5IONO3MP3z8M+ftlOFNRQ78VAf9ReNEzxkGAhG4JsVLToJgjjHI3lYPgp5WEjyS8mT25JqdIKy5ZRXsIsInMmEWk2UcbL6SABACH5BAUFAAUALAoATgBXADAAAAP+WLrcTpC4Sau9M+iAZ/xdKIabNhZfKp0sW5qimra0+HKdrNb8dWM6WW+YeVmCQqKSYaQgd8uoouR5gqTYKW5hvWa/jW4ETFaIIeXyOa3u0gbwwZcKtL7jcOzv8qzh8VE3MBVBPX9xgYJ1Xn6HeUuCg4RjQ46PFgKZAhiRW2yWcheampyRbAWgoRWjoz6dn5YYrKSuimWpsrObtbZgoB26u7xNX7/AuiSmxbHHs8m9UsbNrDbKUbghwdXWStLTrdt73d65zuHilcwi2iOvROTftO3cjY4s7PPQd/b3yC70J7CdwJdP3wh42fz9MyhCXT9zLQA25NeC4AmJEwHVsHgmkVg9VTQ4dpR0CpPCkmxEovyiciWWli6jwIypZCZNIhBvkgEnJQEAIfkEBQUABQAsAgA8AEIAQgAAA/VYRdz+8KlJq72Yxs1d/uDVjVxogmQqnaylvkQrT7A63/V47/m2/8CgcEgsGo/IpHLJbDqf0Kh0Sj0NroOqDMvVmrjgrDcTBo8v5fCZki6vC233Oq4+0832O/at3+f7fICBdzsChgJGeoWHhkV0P4yMRG1BkYeOeECWl5hXQ5uNIAGjAVKgiKKko1CnqBmqqk+nIbCkTq20taVNs7m1vKAnurtLvb6wTMbHsUq4wrrFwSzDzcrLtknW16tI2tvERt6pv0fi48jh5h/U6Zs77EXSN/BE8jP09ZFA+PmhP/xvJgAMWGBgQINvEK5ReIZhQ3QEMTBLAAAh+QQFBQAFACwCAB8AMABXAAAD9Vi6TE4syrmCvZeW97SPWEhx5GeG2USupoZa48q2EqrJMl2nNz7rwI3vF6QNicXPsZQ0LjvN1hMa9UwdVdM1q11ypcMvGCd2MstmCHrNbrvf8Lh8Tq/b762Bfs/v+/tRf4KDfEmEh4NFiIuAQYyPA4qQi4aThIGWf3ibnJ2en6ChoqOkJgKnAnioq3Wrrqlyr65xsq9vtbJtuLlsu7ZrvrPAwai6xKe9x7DDxG7HTRgezUk2FL5RLwHWtVnZGr9V2drfxVzidOdz4uNy6e3ucfBw8vPe6vbv+PH69fxv9G4ABvQ38AU6gWwQJjRYh2A/HnaimUgAACH5BAkFAAUALAIACgAwAFcAAAP3WLrc/otIAqu9bU7Mu9KaJ1bgNp5MaaKnurKiS8GtS4/yjdt6J889TC4oHBItxiOJp4Qkm44nNCKdFqrTnzXKhAy+gx62AAbrsOX0rctIu2HshXvOKlXmdFTIgs9P+35QgG9/g2VbhodWiWaFjIiPkINbcoCUlXiXbYSam1+doKGio6SlpqeoqToCrK2ur7CvMLG0ta4otrm1J7q9siO+wQK8wr24xbazyLGqzc7P0NHS09TPAdcBo9jboNve2Zff3pTi31bl4lDo6U3r5kru4/Dx2Or01+334PP0U/cs3Cr0Q/HugTsY5SCgu5FQoTwaCwXW04EuAQA7")  no-repeat center center ;background-size: cover;z-index:1;'));
c.video=document.createElement("embed");c.video.setAttribute("id",c.id);c.video.setAttribute("class","Talk_stream");c.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(b.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":""));c.video.setAttribute("type","application/x-ppapi-proxy");c.videoSupernatant=document.createElement("div");
c.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");c.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");c.updateVideoPlayerOptions=function(a){a&&"object"===typeof a&&void 0!==a.mirror&&(b.options.mirror=a.mirror,c.video.style.webkitTransform=a.mirror?"rotateY(180deg)":"",c.video.style.mozTransform=a.mirror?"rotateY(180deg)":"",c.video.style.oTransform=a.mirror?"rotateY(180deg)":"",c.video.style.msTransform=
a.mirror?"rotateY(180deg)":"",c.video.style.transform=a.mirror?"rotateY(180deg)":"")};c.showVideo=function(){c.video&&(c.video.style.opacity=1);m&&c.loader&&(c.loader.style.display="")};c.hideVideo=function(){c.video&&(c.video.style.opacity=0);m&&c.loader&&(c.loader.style.display="none")};c.changeMediaStreamUrl=function(a){};c.setMute=function(a){"boolean"!==typeof a?L.Logger.error("[tk-sdk]Stream setMute isMute type must is boolean!"):(c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setMute:local video must is mute!"),
d=!0):d=a,d?tknative.postMessage({command:"setEmbedVolume",connectionId:c.id,volume:0}):tknative.postMessage({command:"setEmbedVolume",connectionId:c.id,volume:e}))};c.setVolume=function(a){"number"!==typeof a?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):(a*=2.55,c.local&&"video"===c.type?(L.Logger.debug("[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),e=0):e=a,tknative.postMessage({command:"setEmbedVolume",connectionId:c.id,volume:a}))};c.getVolume=
function(a){if(a&&"function"===typeof a){if(TK.isTkNative)return a(e),e}else return L.Logger.warning("[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!"),e};c.startIntervalGetRealtimeVolume=function(a,b,d){"function"!==typeof a?L.Logger.warning("[tk-sdk]setIntervalGetRealtimeVolume intervalCallback must is function!"):(h="number"===typeof b?b:100,l=a,a(0),f&&clearInterval(f),f=setInterval(function(){void 0!==l&&L.Utils.isFunction(l)&&l(n,c.id)},h))};c.stopIntervalGetRealtimeVolume=
function(){f&&clearInterval(f);l=h=f=void 0;n=0};c.hideLoading=function(){m=!1;c.loader&&(c.loader.style.display="none");c.div.style.backgroundColor="transparent"};c.showLoading=function(){m=!0;c.loader&&(c.loader.style.display="");c.div.style.backgroundColor=""};TK.isOnlyAudioRoom&&c.hideVideo();c.local&&"video"===c.type&&(c.setVolume(0),c.setMute(!0));c.container=void 0!==c.elementID?"object"===typeof c.elementID&&"function"===typeof c.elementID.appendChild?c.elementID:document.getElementById(c.elementID):
document.body;c.container.appendChild(c.div);c.parentNode=c.div.parentNode;c.loader&&c.div.appendChild(c.loader);c.div.appendChild(c.video);c.div.appendChild(c.videoSupernatant);c.containerWidth=0;c.containerHeight=0;!1!==b.options.bar?(c.bar=new TK.Bar({elementID:"player_"+c.id,id:c.id,stream:b.stream,media:c.video,options:b.options}),c.div.onmouseover=r,c.div.onmouseout=w):c.media=c.video;a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);c.video&&a&&TK.DeviceMgr.setElementSinkIdToAudioouputDevice(c.video,
a);c.hideLoading();return c};window.TK=window.TK||{};
TK.Bar=function(b){var a=TK.View({}),c;a.elementID=b.elementID;a.id=b.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.div.setAttribute("class","Talk_bar");a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.bar.setAttribute("class","Talk_subbar");a.link=document.createElement("a");a.link.setAttribute("href",
b&&b.options&&b.options.link?b.options.link:"http://www.talk-cloud.com/");a.link.setAttribute("class","Talk_link");a.link.setAttribute("target","_blank");a.logo=document.createElement("div");a.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("class","Talk_logo");a.logo.setAttribute("alt","Lynckia");var e=function(b){"block"!==b?b="none":clearTimeout(c);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+
b)};a.display=function(){e("block")};a.hide=function(){c=setTimeout(e,1E3)};document.getElementById(a.elementID).appendChild(a.div);a.div.appendChild(a.bar);a.bar.appendChild(a.link);a.link.appendChild(a.logo);b.stream.screen||void 0!==b.options&&void 0!==b.options.speaker&&!0!==b.options.speaker||(a.speaker=new TK.Speaker({elementID:"subbar_"+a.id,id:a.id,stream:b.stream,media:b.media}));a.display();a.hide();return a};window.TK=window.TK||{};
TK.Speaker=function(b){function a(a,b){if(e(a,b)){for(var c=" "+a.className.replace(/[\t\r\n]/g,"")+" ";0<=c.indexOf(" "+b+" ");)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}}function c(a,b){e(a,b)||(a.className+=" "+b)}function e(a,b){b=b||"";return 0==b.replace(/\s/g,"").length?!1:(new RegExp(" "+b+" ")).test(" "+a.className+" ")}var d=TK.View({}),m=50;d.elementID=b.elementID;d.media=b.media;d.id=b.id;d.stream=b.stream;d.div=document.createElement("div");d.div.setAttribute("style",
"width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;");d.icon=document.createElement("div");d.icon.setAttribute("id","volume_"+d.id);d.icon.setAttribute("class","Talk_Volume_icon");d.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;");d.div.appendChild(d.icon);if(d.stream.local){var n=function(){d.media.muted=!0;a(d.icon,"sound");c(d.icon,"mute");d.stream.stream.getAudioTracks()[0].enabled=!1};var f=function(){d.media.muted=!1;a(d.icon,"mute");
c(d.icon,"sound");d.stream.stream.getAudioTracks()[0].enabled=!0};d.icon.onclick=function(){d.media.muted?f():n()}}else{d.picker=document.createElement("input");d.picker.setAttribute("id","picker_"+d.id);d.picker.type="range";d.picker.min=0;d.picker.max=100;d.picker.step=10;d.picker.value=m;d.picker.setAttribute("orient","vertical");d.div.appendChild(d.picker);d.media.volume=d.picker.value/100;d.media.muted=!1;d.picker.oninput=function(){d.media.muted=0<d.picker.value?!1:!0;a(d.icon,"sound");c(d.icon,
"mute");d.media.volume=d.picker.value/100};var h=function(a){d.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+d.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+a)};n=function(){a(d.icon,"sound");c(d.icon,"mute");m=d.picker.value;d.picker.value=0;d.media.volume=0;d.media.muted=!0};f=function(){a(d.icon,"mute");c(d.icon,"sound");d.picker.value=m;d.media.volume=d.picker.value/100;d.media.muted=
!1};d.icon.onclick=function(){d.media.muted?f():n()};d.div.onmouseover=function(){h("block")};d.div.onmouseout=function(){h("none")};h("none")}document.getElementById(d.elementID).appendChild(d.div);return d};window.L=window.L||{};
L.Constant=function(){return{roomError:{ROOMCONNECTERROR:0,GETCONFIGERROR:1,GETFILELISTERROR:2,CHECKROOMERROR:3},getUserMedia:{SUCCESS_ONLY_VIDEO:1,SUCCESS_ONLY_AUDIO:2,SUCCESS_ALL:3,SUCCESS_NOT_ALL:4,FAILURE_ONLY_VIDEO:-1,FAILURE_ONLY_AUDIO:-2,FAILURE_ALL:-3,FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO:0,FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO:0},accessDenied:{streamFail:0,notAudioAndVideo:1,notAudioAndVideoAndScreenOrUrlNotUndefined:2,ohterError:-1},deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",
videoinput:"videoinputDeviceId"},streamReconnection:{notOnceSuccess:1,midwayReconnectionNotSuccess:2,midwayReconnectionChangePublishstate_0:3},getStats:{nativeFailure:1,pcNotGetStats:2,peerConnectionNotGetStats:3,getStatsFailure:4,getStatsError:5},udpState:{ok:1,notOnceSuccess:2},localRecord:{onlyRecordAudio:0,recordAudioAndVideo:1},LOGLEVEL:{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5}}}(L);window.L=window.L||{};L.aexInstance=void 0;
(function(){var b={cipher:function(a,c){for(var d=c.length/4-1,e=[[],[],[],[]],f=0;16>f;f++)e[f%4][Math.floor(f/4)]=a[f];e=b.addRoundKey(e,c,0,4);for(f=1;f<d;f++)e=b.subBytes(e,4),e=b.shiftRows(e,4),e=b.mixColumns(e,4),e=b.addRoundKey(e,c,f,4);e=b.subBytes(e,4);e=b.shiftRows(e,4);e=b.addRoundKey(e,c,d,4);c=Array(16);for(f=0;16>f;f++)c[f]=e[f%4][Math.floor(f/4)];return c},keyExpansion:function(a){for(var c=a.length/4,e=c+6,n=Array(4*(e+1)),f=Array(4),h=0;h<c;h++)n[h]=[a[4*h],a[4*h+1],a[4*h+2],a[4*
h+3]];for(h=c;h<4*(e+1);h++){n[h]=Array(4);for(a=0;4>a;a++)f[a]=n[h-1][a];if(0==h%c)for(f=b.subWord(b.rotWord(f)),a=0;4>a;a++)f[a]^=b.rCon[h/c][a];else 6<c&&4==h%c&&(f=b.subWord(f));for(a=0;4>a;a++)n[h][a]=n[h-c][a]^f[a]}return n},subBytes:function(a,c){for(var d=0;4>d;d++)for(var e=0;e<c;e++)a[d][e]=b.sBox[a[d][e]];return a},shiftRows:function(a,b){for(var c=Array(4),d=1;4>d;d++){for(var e=0;4>e;e++)c[e]=a[d][(e+d)%b];for(e=0;4>e;e++)a[d][e]=c[e]}return a},mixColumns:function(a,b){for(b=0;4>b;b++){for(var c=
Array(4),d=Array(4),e=0;4>e;e++)c[e]=a[e][b],d[e]=a[e][b]&128?a[e][b]<<1^283:a[e][b]<<1;a[0][b]=d[0]^c[1]^d[1]^c[2]^c[3];a[1][b]=c[0]^d[1]^c[2]^d[2]^c[3];a[2][b]=c[0]^c[1]^d[2]^c[3]^d[3];a[3][b]=c[0]^d[0]^c[1]^c[2]^d[3]}return a},addRoundKey:function(a,b,c,n){for(var d=0;4>d;d++)for(var e=0;e<n;e++)a[d][e]^=b[4*c+e][d];return a},subWord:function(a){for(var c=0;4>c;c++)a[c]=b.sBox[a[c]];return a},rotWord:function(a){for(var b=a[0],c=0;3>c;c++)a[c]=a[c+1];a[3]=b;return a},sBox:[99,124,119,123,242,107,
111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,
34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,
0,0,0]],Ctr:{}};b.Ctr.encrypt=function(e,d,m){d=d||"talk_2018_@beijing_20180310_talk_2018_@beijing";m=m||256;if(128!=m&&192!=m&&256!=m)return"";e=c.encode(e);d=c.encode(d);var n=m/8,f=Array(n);for(m=0;m<n;m++)f[m]=isNaN(d.charCodeAt(m))?0:d.charCodeAt(m);f=b.cipher(f,b.keyExpansion(f));f=f.concat(f.slice(0,n-16));d=Array(16);m=(new Date).getTime();n=m%1E3;var h=Math.floor(m/1E3),l=Math.floor(65535*Math.random());for(m=0;2>m;m++)d[m]=n>>>8*m&255;for(m=0;2>m;m++)d[m+2]=l>>>8*m&255;for(m=0;4>m;m++)d[m+
4]=h>>>8*m&255;n="";for(m=0;8>m;m++)n+=String.fromCharCode(d[m]);f=b.keyExpansion(f);h=Math.ceil(e.length/16);l=Array(h);for(var r=0;r<h;r++){for(m=0;4>m;m++)d[15-m]=r>>>8*m&255;for(m=0;4>m;m++)d[15-m-4]=r/4294967296>>>8*m;var w=b.cipher(d,f),t=r<h-1?16:(e.length-1)%16+1,k=Array(t);for(m=0;m<t;m++)k[m]=w[m]^e.charCodeAt(16*r+m),k[m]=String.fromCharCode(k[m]);l[r]=k.join("")}e=n+l.join("");return e=a.encode(e)};b.Ctr.decrypt=function(e,d,m){d=d||"talk_2018_@beijing_20180310_talk_2018_@beijing";m=m||
256;if(128!=m&&192!=m&&256!=m)return"";e=a.decode(e);d=c.encode(d);var n=m/8,f=Array(n);for(m=0;m<n;m++)f[m]=isNaN(d.charCodeAt(m))?0:d.charCodeAt(m);f=b.cipher(f,b.keyExpansion(f));f=f.concat(f.slice(0,n-16));d=Array(8);n=e.slice(0,8);for(m=0;8>m;m++)d[m]=n.charCodeAt(m);n=b.keyExpansion(f);f=Math.ceil((e.length-8)/16);m=Array(f);for(var h=0;h<f;h++)m[h]=e.slice(8+16*h,16*h+24);e=m;var l=Array(e.length);for(h=0;h<f;h++){for(m=0;4>m;m++)d[15-m]=h>>>8*m&255;for(m=0;4>m;m++)d[15-m-4]=(h+1)/4294967296-
1>>>8*m&255;var r=b.cipher(d,n),w=Array(e[h].length);for(m=0;m<e[h].length;m++)w[m]=r[m]^e[h].charCodeAt(m),w[m]=String.fromCharCode(w[m]);l[h]=w.join("")}e=l.join("");return e=c.decode(e)};var a={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",encode:function(b,c){var d=[],e="",f=a.code;c=("undefined"==typeof c?0:c)?b.encodeUTF8():b;b=c.length%3;if(0<b)for(;3>b++;)e+="\x3d",c+="\x00";for(b=0;b<c.length;b+=3){var h=c.charCodeAt(b);var l=c.charCodeAt(b+1);var r=c.charCodeAt(b+
2);var w=h<<16|l<<8|r;h=w>>18&63;l=w>>12&63;r=w>>6&63;w&=63;d[b/3]=f.charAt(h)+f.charAt(l)+f.charAt(r)+f.charAt(w)}d=d.join("");return d=d.slice(0,d.length-e.length)+e},decode:function(b,c){c="undefined"==typeof c?!1:c;var d=[],e=a.code;var f=c?b.decodeUTF8():b;for(var h=0;h<f.length;h+=4){var l=e.indexOf(f.charAt(h));var r=e.indexOf(f.charAt(h+1));b=e.indexOf(f.charAt(h+2));var w=e.indexOf(f.charAt(h+3));var t=l<<18|r<<12|b<<6|w;l=t>>>16&255;r=t>>>8&255;t&=255;d[h/4]=String.fromCharCode(l,r,t);64==
w&&(d[h/4]=String.fromCharCode(l,r));64==b&&(d[h/4]=String.fromCharCode(l))}d=d.join("");return c?d.decodeUTF8():d}},c={encode:function(a){a=a.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return a=a.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&63,128|a&63)})},decode:function(a){a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&
63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})}};L.aexInstance=b.Ctr})();
L.Utils=function(){var b=void 0,a=!1,c=!1;b={handleMediaPlayOnEvent:function(a,c){try{if(L.Utils.removeEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c)),a&&a.play&&"function"===typeof a.play){var d=a.play();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(b){L.Logger.error("[tk-sdk]media play err:",L.Utils.toJsonStringify(b),
c?" , media element id is "+c:" media element:",c?"":a)})}}catch(n){L.Logger.error("[tk-sdk]media play error:",L.Utils.toJsonStringify(n),c?" , media element id is "+c:" media element:",c?"":a)}},handleMediaPauseOnEvent:function(a,c){try{if(L.Utils.removeEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c)),a&&a.pause&&"function"===typeof a.pause){var d=
a.pause();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(b){L.Logger.error("[tk-sdk]media pause err:",L.Utils.toJsonStringify(b),c?" , media element id is "+c:" media element:",c?"":a)})}}catch(n){L.Logger.error("[tk-sdk]media pause error:",L.Utils.toJsonStringify(n),c?" , media element id is "+c:" media element:",c?"":a)}}};return{addEvent:function(a,b,c,n){a.addEventListener?a.addEventListener(b,c,void 0!=n&&null!=n?n:!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,
b,c,n){a.removeEventListener?a.removeEventListener(b,c,void 0!=n&&null!=n?n:!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},toJsonStringify:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("object"!==typeof a)return a;var c=JSON.stringify(a);c?a=c:L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}catch(n){L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}return a},toJsonParse:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("string"!==typeof a)return a;var c=JSON.parse(a);
c?a=c:L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}catch(n){L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}return a},encrypt:function(a,b,c,n){if(!a)return a;c=c||TK.hexEncryptDecryptKey;n=n||TK.hexEncryptDecryptBit;b=void 0!=b?b:"talk_2018_@beijing";a=L.aexInstance.encrypt(a,c,n);return b+a+b},decrypt:function(a,b,c,n){if(!a)return a;c=c||TK.hexEncryptDecryptKey;n=n||TK.hexEncryptDecryptBit;a=a.replace(new RegExp(void 0!=b?b:"talk_2018_@beijing","gm"),"");return L.aexInstance.decrypt(a,
c,n)},mediaPlay:function(a){var c=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(c=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?b.handleMediaPlayOnEvent(a,c):(L.Utils.removeEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",
b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c))))},mediaPause:function(a){var c=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(c=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
(0!==a.readyState?b.handleMediaPauseOnEvent(a,c):(L.Utils.removeEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,
c))))},localStorage:{setItem:function(b,c){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(b,c):L.Logger.warning("[tk-sdk]Browser does not support localStorage.setItem , key is "+b+" , value is "+c+"!"):a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"))}catch(m){a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(m)))}},getItem:function(b){try{if(window.localStorage){if(window.localStorage.getItem)return window.localStorage.getItem(b);
L.Logger.warning("[tk-sdk]Browser does not support localStorage.getItem , key is "+b+" !");return""}a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(d){return a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(d))),""}},removeItem:function(b){try{if(window.localStorage){if(window.localStorage.removeItem)return window.localStorage.removeItem(b);L.Logger.warning("[tk-sdk]Browser does not support localStorage.removeItem , key is "+
b+" !");return""}a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(d){return a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(d))),""}}},sessionStorage:{setItem:function(a,b){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(a,b):L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.setItem , key is "+a+" , value is "+b+"!"):c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"))}catch(m){c||
(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(m)))}},getItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.getItem)return window.sessionStorage.getItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.getItem , key is "+a+" !");return""}c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(d){return c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",
L.Utils.toJsonStringify(d))),""}},removeItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.removeItem)return window.sessionStorage.removeItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.removeItem , key is "+a+" !");return""}c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(d){return c||(c=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(d))),""}}},getBrowserInfo:function(){var a=
/(msie\s|trident.*rv:)([\w.]+)/,b=/edge\/(\d+).(\d+)$/,c=/(firefox)\/([\w.]+)/,n=/(opera).+version\/([\w.]+)/,f=/(chrome)\/([\w.]+)/,h=/version\/([\w.]+).*(safari)/,l=function(d){var e=a.exec(d);return e?{browser:"IE",version:e[2]||"0"}:(e=b.exec(d))?{browser:"Edge",version:e[2]||"0"}:(e=c.exec(d))?{browser:e[1]||"Firefox",version:e[2]||"0"}:(e=n.exec(d))?{browser:e[1]||"Opera",version:e[2]||"0"}:(e=f.exec(d))?{browser:e[1]||"Chrome",version:e[2]||"0"}:(e=h.exec(d))?{browser:e[2]||"Safari",version:e[1]||
"0"}:{browser:"unknown",version:"unknown"}}(window.navigator.userAgent.toLowerCase()),r=navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||navigator.language;return{versions:function(){var a=navigator.userAgent;return{edge:-1<a.indexOf("Edge"),trident:-1<a.indexOf("Trident"),presto:-1<a.indexOf("Presto"),webKit:-1<a.indexOf("AppleWebKit"),gecko:-1<a.indexOf("Gecko")&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
android:-1<a.indexOf("Android")||-1<a.indexOf("Linux"),iPhone:-1<a.indexOf("iPhone"),iPad:-1<a.indexOf("iPad"),webApp:-1==a.indexOf("Safari")}}(),language:r?r.toLowerCase():void 0,info:{browserName:l.browser,browserVersion:l.version,appCodeName:navigator.appCodeName,appMinorVersion:navigator.appMinorVersion,appName:navigator.appName,appVersion:navigator.appVersion,browserLanguage:navigator.browserLanguage,cookieEnabled:navigator.cookieEnabled,cpuClass:navigator.cpuClass,onLine:navigator.onLine,platform:navigator.platform,
systemLanguage:navigator.systemLanguage,userAgent:navigator.userAgent,userLanguage:navigator.userLanguage}}},getJsonLength:function(a){var b=0;if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&++b;return b},isFunction:function(a){return"function"===typeof a},isString:function(a){return"string"===typeof a},isNumber:function(a){return"number"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNull:function(a){return!a&&0!==a&&("boolean"!==typeof a?!0:!1)},getFileName:function(a){if("string"!==
typeof a)return"";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return a.substring(Math.max(b,c)+1)}}}(L);window.TK_ERR={DEVICE_ERROR_UnknownError:1E4,DEVICE_ERROR_NotFoundError:10001,DEVICE_ERROR_NotAllowedError:10002,DEVICE_ERROR_NotReadableError:10003,DEVICE_ERROR_OverconstrainedError:10004,DEVICE_ERROR_TypeError:10005};window.TK_VIDEO_MODE={ASPECT_RATIO_CONTAIN:20001,ASPECT_RATIO_COVER:20002};window.TK=window.TK||{};TK.mediaStream=void 0;
TK.DeviceMgr=function(){function b(a,b,c){b=void 0!==b?b:!0;c=void 0!==c?c:!0;if(b&&c&&a&&a.getTracks&&"function"===typeof a.getTracks){if((a=a.getTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}else{if(b&&a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(b=a.getVideoTracks())&&0<b.length)for(var d=0;d<b.length;d++)b[d]&&b[d].stop&&"function"===typeof b[d].stop&&b[d].stop();if(c&&a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&
(a=a.getAudioTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}}function a(a,b,c){if(TK.roomInstance){var d="",f=window.TK_ERR.DEVICE_ERROR_UnknownError;"object"===typeof a&&(d=a.name);switch(d){case "NotFoundError":case "DevicesNotFoundError":f=window.TK_ERR.DEVICE_ERROR_NotFoundError;break;case "NotAllowedError":case "PermissionDeniedError":f=window.TK_ERR.DEVICE_ERROR_NotAllowedError;break;case "NotReadableError":case "TrackStartError":f=window.TK_ERR.DEVICE_ERROR_NotReadableError;
break;case "OverconstrainedError":case "ConstraintNotSatisfiedError":f=window.TK_ERR.DEVICE_ERROR_OverconstrainedError;break;case "TypeError":f=window.TK_ERR.DEVICE_ERROR_TypeError}L.Logger.warning("[tk-sdk]device-not-available , error code is "+f+"  , kind is "+b+" , deviceId is "+c);a=TK.RoomEvent({type:"device-not-available",message:{kind:b,deviceId:c}},{code:f});TK.roomInstance.dispatchEvent(a)}}var c={room_video_width:320,room_video_height:240,room_video_fps:10,streamJson:{selectStream:void 0},
onDevicesSetted:null,onDeviceChanged:null},e=null,d=null,m=null,n=void 0;c.setAVMgrProperty=function(a){for(var b in a)c.hasOwnProperty(b)&&(c[b]=a[b])};var f=function(a,b,c){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then(b).catch(c):(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia(a,b,c))},h=function(d,e,l){L.Logger.debug("[tk-sdk]checkGetUserMediaing , videoinputDeviceId:"+
e+" , audioinputDeviceId:"+l);d&&"function"===typeof d||L.Logger.error("[tk-sdk]checkGetUserMedia callback must function");var h=!1,k=!1,u,m,t=function(){h&&k&&d({videoinput:{old:e,now:u},audioinput:{old:l,now:m}})},n=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia video finshed , videoinputDeviceId:"+e+" , successVideoinputId:"+a);h=!0;u=a;t()},r=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia audio finshed , audioinputDeviceId:"+l+" , successAudioinputId:"+a);k=!0;m=a;t()};f({audio:{deviceId:{exact:l}},
video:{deviceId:{exact:e}}},function(a){b(a,!0,!0);n(e);r(l)},function(d){f({audio:!1,video:{deviceId:{exact:e}}},function(a){b(a,!0,!1);n(e)},function(d){a(d,"videoinput",e);c.enumerateDevices(function(a){if(a&&a.devices&&a.devices.videoinput){var c=a.devices.videoinput;if(c&&0<c.length){var d=c[0],e=function(a){f({audio:!1,video:{deviceId:{exact:a}}},function(d){c.shift();b(d,!0,!1);n(a)},function(a){c.shift();(d=c[0])?e(d.deviceId):n()})};d?e(d.deviceId):n()}else n()}else n()})});f({video:!1,audio:{deviceId:{exact:l}}},
function(a){b(a,!1,!0);r(l)},function(d){a(d,"audioinput",l);c.enumerateDevices(function(a){if(a&&a.devices&&a.devices.audioinput){var c=a.devices.audioinput;if(c&&0<c.length){var d=c[0],e=function(a){f({video:!1,audio:{deviceId:{exact:a}}},function(d){c.shift();b(d,!1,!0);r(a)},function(a){c.shift();(d=c[0])?e(d.deviceId):r()})};d?e(d.deviceId):r()}else r()}else r()})})})},l=function(b,d,e,l){var h=void 0,k,u={};var m=function(d){var f=h&&"string"===typeof h?L.Utils.toJsonParse(h):h;d.customdata_createID=
(new Date).getTime();d.customdata_deviceJsonId={};f&&(f.video&&"object"===typeof f.video&&(d.customdata_deviceJsonId.videoinput="object"===typeof f.video.deviceId?f.video.deviceId.exact:f.video.deviceId),f.audio&&"object"===typeof f.audio&&(d.customdata_deviceJsonId.audioinput="object"===typeof f.audio.deviceId?f.audio.deviceId.exact:f.audio.deviceId));c.streamJson.selectStream=d;f={videoTracks:!0,audioTracks:!0};if(d){var e=d.getVideoTracks?d.getVideoTracks():void 0,m=d.getAudioTracks?d.getAudioTracks():
void 0;e&&0<e.length||(f.videoTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not videoTracks  , currUserMediaConfig info:"+h+"!"));m&&0<m.length||(f.audioTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not audioTracks  , currUserMediaConfig info:"+h+"!"))}else L.Logger.error("[tk-sdk]getUserMedia stream is not exist!"),f.videoTracks=!1,f.audioTracks=!1;e=[];e.push(d);e.push(f);d.customdata_tracksInfo=f;l&&l.externalJson&&void 0!==l.externalJson.getUserMediaFailureCode&&(d.getUserMediaFailureCode=
l.externalJson.getUserMediaFailureCode);l.isNeedCheckChangeLocalStream&&l.deviceInfo.initDeviceId.audioinput!==d.customdata_deviceJsonId.audioinput&&(L.Logger.info("[tk-sdk]getUserMedia changed audioinput device , old device id is "+l.deviceInfo.initDeviceId.audioinput+" , now device id is "+d.customdata_deviceJsonId.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.customdata_deviceJsonId.audioinput||""));l.isNeedCheckChangeLocalStream&&l.deviceInfo.initDeviceId.videoinput!==
d.customdata_deviceJsonId.videoinput&&(L.Logger.info("[tk-sdk]getUserMedia changed videoinput device , old device id is "+l.deviceInfo.initDeviceId.videoinput+" , now device id is "+d.customdata_deviceJsonId.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.customdata_deviceJsonId.videoinput||""));l&&l.dispatchEvent&&(m=L.Constant.getUserMedia.SUCCESS_ALL,f.videoTracks||f.audioTracks?f.videoTracks?f.audioTracks||(m=L.Constant.getUserMedia.SUCCESS_ONLY_VIDEO):m=L.Constant.getUserMedia.SUCCESS_ONLY_AUDIO:
m=L.Constant.getUserMedia.SUCCESS_NOT_ALL,TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_success",message:{mediaStream:d,customdata_tracksInfo:f,code:m,externalJson:l.externalJson}},!1));l.isDemotionLocalStream&&(f=k&&"string"===typeof k?L.Utils.toJsonParse(k):k,u.videoinput&&!d.customdata_deviceJsonId.videoinput&&f.video&&"object"===typeof f.video&&a(u.videoinput,"videoinput","object"===typeof f.video.deviceId?f.video.deviceId.exact:f.video.deviceId),u.audioinput&&
!d.customdata_deviceJsonId.audioinput&&f.audio&&"object"===typeof f.audio&&a(u.audioinput,"audioinput","object"===typeof f.audio.deviceId?f.audio.deviceId.exact:f.audio.deviceId));b.apply(b,e)};var t=function(b){L.Logger.error("[tk-sdk]getUserMedia error info: name is "+b.name+" , message is "+b.message+" , constraintName is "+b.constraintName);var c=h&&"string"===typeof h?L.Utils.toJsonParse(h):h,f=k&&"string"===typeof k?L.Utils.toJsonParse(k):k;if(l.isDemotionLocalStream){if(c.video&&"object"===
typeof c.video&&!l.deviceInfo.demotion.videoinput){l.deviceInfo.demotion.videoinput=!0;f.video=!1;l.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the audio device stream , oldUserMediaConfig info:"+h+" , nowUserMediaConfig info:"+L.Utils.toJsonStringify(f)+"!");l&&l.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyAudioStream",
message:{errorMsg:e,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO,externalJson:l.externalJson}},!1);u.videoinput=b;n(f);return}if(c.audio&&"object"===typeof c.audio&&!l.deviceInfo.demotion.audioinput){l.deviceInfo.demotion.audioinput=!0;f.audio=!1;l.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the video device stream , oldUserMediaConfig info:"+h+" , nowUserMediaConfig info:"+
L.Utils.toJsonStringify(f)+"!");l&&l.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyVideoStream",message:{errorMsg:e,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO,externalJson:l.externalJson}},!1);u.audioinput=b;n(f);return}}var e="[tk-sdk]Gets the data stream failed[video , audio] ,currUserMediaConfig info:"+h+"!";L.Logger.warning(e);l.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_ALL;
l&&l.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure",message:{errorMsg:e,code:L.Constant.getUserMedia.FAILURE_ALL,externalJson:l.externalJson}},!1);l.isDemotionLocalStream&&(u.videoinput&&f.video&&"object"===typeof f.video&&a(u.videoinput,"videoinput","object"===typeof f.video.deviceId?f.video.deviceId.exact:f.video.deviceId),u.audioinput&&f.audio&&"object"===typeof f.audio&&a(u.audioinput,"audioinput","object"===typeof f.audio.deviceId?
f.audio.deviceId.exact:f.audio.deviceId),f.audio||f.video||(a(b,"videoinput",""),a(b,"audioinput","")));if(d&&"function"===typeof d){c=[];for(f=0;f<arguments.length;f++)c[f]=arguments[f];l&&l.externalJson&&void 0!==l.externalJson.getUserMediaFailureCode&&c.push({getUserMediaFailureCode:l.externalJson.getUserMediaFailureCode});d.apply(d,c)}};var n=function(a){h=a&&"object"===typeof a?L.Utils.toJsonStringify(a):a;k||(k=h);f(a,m,t)};n(e)},r=function(a,b){var d={video:{},audio:{}};a?(void 0!==a.audio&&
(d.audio=a.audio),void 0!==a.video&&(d.video=a.video),d.audio&&"object"===typeof d.audio&&void 0!==d.audio.sourceId&&(d.audio.deviceId=d.audio.sourceId,delete d.audio.sourceId),d.video&&"object"===typeof d.video&&void 0!==d.video.sourceId&&(d.video.deviceId=d.video.sourceId,delete d.video.sourceId)):(d.audio.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),d.video.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput));if(d.video&&"object"===typeof d.video){a=
c.room_video_width||320;var f=c.room_video_width||320,e=c.room_video_height||240,l=c.room_video_height||240,h=Number(c.room_video_fps||10),k=Number(c.room_video_fps||10);void 0===d.video.width&&(d.video.width={ideal:a,max:f});void 0===d.video.height&&(d.video.height={ideal:e,max:l});void 0===d.video.frameRate&&(d.video.frameRate={ideal:h,max:k})}b.audio.sourceId?(d.audio="object"===typeof d.audio?d.audio:{},d.audio.deviceId=b.audio.sourceId):b.audio.deviceId&&(d.audio="object"===typeof d.audio?d.audio:
{},d.audio.deviceId=b.audio.deviceId);b.video.sourceId?(d.video="object"===typeof d.video?d.video:{},d.video.deviceId=b.video.sourceId):b.video.deviceId&&(d.video="object"===typeof d.video?d.video:{},d.video.deviceId=b.video.deviceId);b.exclude&&b.exclude.audio?d.audio=!1:d.audio&&"object"===typeof d.audio&&void 0!==d.audio.deviceId&&(d.audio.deviceId="object"!==d.audio.deviceId?{exact:d.audio.deviceId}:d.audio.deviceId);b.exclude&&b.exclude.video?d.video=!1:d.video&&"object"===typeof d.video&&void 0!==
d.video.deviceId&&(d.video.deviceId="object"!==d.video.deviceId?{exact:d.video.deviceId}:d.video.deviceId);return d};c.getUserMedia=function(a,b,d,f){f=void 0!=f&&null!=f&&"object"===typeof f?f:{video:{},audio:{},exclude:{}};var e=function(){f.video=f.video||{};f.audio=f.audio||{};f.exclude=f.exclude||{};f.externalJson=f.externalJson||{};f.deviceInfo={initDeviceId:{videoinput:void 0,audioinput:void 0},demotion:{videoinput:!1,audioinput:!1}};d=r(d,f);d.audio&&"object"===typeof d.audio&&(f.deviceInfo.initDeviceId.audioinput=
"object"===typeof d.audio.deviceId?d.audio.deviceId.exact:d.audio.deviceId);d.video&&"object"===typeof d.video&&(f.deviceInfo.initDeviceId.videoinput="object"===typeof d.video.deviceId?d.video.deviceId.exact:d.video.deviceId);!f.isNeedCheckChangeLocalStream&&TK.isInnerVersions&&(d.video&&"object"===typeof d.video&&("object"===typeof d.video.deviceId?d.video.deviceId.exact||(d.video=!1):d.video.deviceId||(d.video=!1)),d.audio&&"object"===typeof d.audio&&("object"===typeof d.audio.deviceId?d.audio.deviceId.exact||
(d.audio=!1):d.audio.deviceId||(d.audio=!1)));f.isNeedCheckChangeLocalStream?h(function(c){var e=c.videoinput;c=c.audioinput;d.video&&"object"===typeof d.video&&e.old!==e.now?e.now?d.video.deviceId={exact:e.now}:d.video=!1:e.old||(d.video=!1);d.audio&&"object"===typeof d.audio&&c.old!==c.now?c.now?d.audio.deviceId={exact:c.now}:d.audio=!1:c.old||(d.audio=!1);l(a,b,d,f)},f.deviceInfo.initDeviceId.videoinput,f.deviceInfo.initDeviceId.audioinput):l(a,b,d,f)};!f.isNeedCheckChangeLocalStream||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&
L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?e():c.enumerateDevices(function(a){e()},{isSetlocalStorage:!0})};c.enumerateDevices=function(a,b){function c(c){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),l={},h={},k={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},
useDevices:{}},m=L.Utils.getBrowserInfo();m=m&&m.language&&m.language.toLowerCase().match(/zh/g)?"chinese":"english";var t={videoinput:{label:"chinese"===m?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===m?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===m?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}};c&&c.forEach&&c.forEach(function(a){if(a&&"communications"!=a.groupId&&"communications"!=
a.deiceId&&"\u901a\u8baf"!=a.label){var b={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!b.label&&t[a.kind]&&(b.label=t[a.kind].label+ ++t[a.kind].num);"audioinput"===a.kind&&a.deviceId===d&&(k.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===f&&(k.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===e&&(k.useDevices[a.kind]=a.deviceId);l[a.kind]=l[a.kind]||a.deviceId;k.devices[a.kind].push(b);k.hasdevice[a.kind]=!0;"default"===a.deviceId&&(h[a.kind]=
a.deviceId)}});k.useDevices.audioinput||(k.useDevices.audioinput=h.audioinput||l.audioinput||"");k.useDevices.videoinput||(k.useDevices.videoinput=h.videoinput||l.videoinput||"");k.useDevices.audiooutput||(k.useDevices.audiooutput=h.audiooutput||l.audiooutput||"");L.Utils.localStorage?b.isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,k.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,k.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,
k.useDevices.audiooutput)):L.Logger.error("[tk-sdk]not support localStorage");L.Logger.info("[tk-sdk]enumerateDevices devicesInfo:",L.Utils.toJsonStringify(k));a&&"function"===typeof a&&a(k)}b=b||{};L.Logger.debug("[tk-sdk]call enumerateDevices!");b.isSetlocalStorage=void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;(function(a){var b=[];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),
a&&"function"===typeof a&&a(b),null;navigator.mediaDevices.enumerateDevices().then(function(c){var d={};c.forEach(function(a){L.Logger.debug("[tk-sdk]"+a.kind+": "+a.label+" id \x3d "+a.deviceId,a);d[a.kind]=d[a.kind]||{};var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};d[a.kind][a.deviceId]=c;b.push(c)});L.Logger.debug("[tk-sdk]enumerateDevices devices:"+L.Utils.toJsonStringify(d));a&&"function"===typeof a&&a(b)}).catch(function(c){L.Logger.error("[tk-sdk]enumerateDevices error :"+
c.name+": "+c.message);a&&"function"===typeof a&&a(b);throw c;})})(function(a){c(a)})};c.getsSoundMeterInstance=function(a){if(a)return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,f=0;for(c=0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&(f+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=f/a.length};b.connectToSource=
function(a,c){L.Logger.debug("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&c(null)}catch(B){L.Logger.error("[tk-sdk]connecToSource error:",B),"undefined"!==typeof c&&c(B)}};b.stop=function(){b.mic&&b.mic.disconnect&&b.mic.disconnect();b.script&&b.script.disconnect&&b.script.disconnect()};return b}(a);L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};
c.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),tknative.postMessage({command:"setSpeaker",deviceId:b}),c&&"function"===typeof c&&c(!1);else{var d=0,f=function(a,f,e){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var f=a.getAttribute("id");L.Logger.debug("[tk-sdk]Audio output device set to "+
b,f?" , element id is "+f:"  element:",f?"":a);d++;d===e&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var f=void 0,l=a.getAttribute("id");b&&"SecurityError"===b.name&&(f="You need to use HTTPS for selecting audio output device  ");L.Logger.warning("[tk-sdk]setSinkId error:",b,f?f:"",l?" , element id is "+l:"  element:",l?"":a);d++;d===e&&c&&"function"===typeof c&&c(!1)})}catch(W){f=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",W,f?" , element id is "+f:"  element:",f?"":a),
d++,d===e&&c&&"function"===typeof c&&c(!1)}else f=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,f?" , element id is "+f:"  element:",f?"":a),d++,d===e&&c&&"function"===typeof c&&c(!1);else d++,d===e&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var e=document.getElementsByTagName("audio"),l=document.getElementsByTagName("video");if(e&&0<e.length)for(var h=0;h<e.length;h++){var k=e[h];a.push(k)}if(l&&0<l.length)for(h=0;h<l.length;h++)k=
l[h],a.push(k)}if(a&&0<a.length)for(e=a.length,h=0;h<a.length;h++)k=a[h],f(k,h,e);else f(a,0,1)}else c&&"function"===typeof c&&c(!1)};c.changeLocalDeviceToLocalstream=function(a,b,d,f){var e={};b=b||{};for(var l in b)L.Constant.deviceStorage[l]&&b[l]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[l])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[l],b[l]),e[l]=!0);!e.videoinput&&!e.audioinput&&TK&&TK.default_stream&&TK.default_stream.stream&&(b.videoinput&&TK.default_stream.stream.getVideoTracks&&
TK.default_stream.stream.getVideoTracks()&&0===TK.default_stream.stream.getVideoTracks().length&&(e.videoinput=!0),b.audioinput&&TK.default_stream.stream.getAudioTracks&&TK.default_stream.stream.getAudioTracks()&&0===TK.default_stream.stream.getAudioTracks().length&&(e.audioinput=!0));e.audiooutput&&c.setElementSinkIdToAudioouputDevice(f);e.videoinput||e.audioinput?c.getUserMedia(function(b){a&&"function"===typeof a&&a(b);d&&"function"===typeof d&&d(b,0)},function(a){d&&"function"===typeof d&&d(void 0,
0)},void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1}):e.audiooutput?d&&"function"===typeof d&&d(void 0,1):d&&"function"===typeof d&&d(void 0,2)};c.addOndevicechange=function(a){if(!navigator.mediaDevices)return L.Logger.error("Browser does not support navigator.mediaDevices!"),!1;if(navigator.mediaDevices)return navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(b){L.Logger.error("[tk-sdk]AVMgr:ondevicechange event:",b);
a&&"function"===typeof a&&a(b)},!0};c.removeOndevicechange=function(){if(!navigator.mediaDevices)return L.Logger.error("Browser does not support navigator.mediaDevices!"),!1;if(!navigator.mediaDevices.ondevicechange)return!1;navigator.mediaDevices.ondevicechange=null;return!0};var w=function(a){L.Logger.debug("[tk-sdk]DeviceMgr:onDeviceChangeEvent. event:",a);if(void 0!==c.onDeviceChanged&&null!==c.onDeviceChanged&&L.Utils.isFunction(c.onDeviceChanged))c.onDeviceChanged(a);void 0!==n&&null!==n&&L.Utils.isFunction(n)&&
n(a)};navigator.mediaDevices?navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=w):L.Logger.error("Browser does not support navigator.mediaDevices!");c.addDeviceChangeListener=function(a){n=null;n=a};c.removeDeviceChangeListener=function(){n=null};c.stopStreamTracks=function(a,c,d){b(a,c,d)};c.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=
b)};c.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};c.playDeviceStream=function(a,b,c,d){d=d||{};a?b?(a.videoPlayer&&a.videoPlayer.destroy&&a.videoPlayer.destroy(),a.videoPlayer=TK.VideoPlayer({id:"deviceStream_"+(new Date).getTime(),stream:{stream:a},elementID:b,options:d}),"function"===typeof c&&c(a.videoPlayer)):L.Logger.error("[tk-sdk]playDeviceStream elementID can not be empty!"):
L.Logger.error("[tk-sdk]playDeviceStream stream can not be empty!")};c.unplayDeviceStream=function(a){a?a&&a.videoPlayer&&a.videoPlayer.destroy&&(a.videoPlayer.destroy(),a.videoPlayer=void 0,delete a.videoPlayer):L.Logger.error("[tk-sdk]unplayDeviceStream stream can not be empty!")};c.stopCameraTest=function(){e&&(c.unplayDeviceStream(e),c.stopStreamTracks(e),e=null)};c.startCameraTest=function(a,b,d){a?b?(c.stopCameraTest(),c.getUserMedia(function(a){e=a;c.playDeviceStream(e,b)},function(a){L.Utils.isFunction(d)&&
d(a);L.Logger.error("[tk-sdk] getUserMedia failed when test camera, failure info:",a)},{video:{sourceId:a},audio:!1})):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid elementId")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid deviceId"))};c.stopMicrophoneTest=function(){m&&m.stopIntervalGetRealtimeVolume&&(m.stopIntervalGetRealtimeVolume(),m=null);d&&(c.unplayDeviceStream(d),c.stopStreamTracks(d),d=null)};c.startMicrophoneTest=
function(a,b,f,e){a?b?(c.stopMicrophoneTest(),c.getUserMedia(function(a){d=a;c.playDeviceStream(d,b,function(a){(m=a)&&m.startIntervalGetRealtimeVolume&&m.startIntervalGetRealtimeVolume(function(a){L.Utils.isFunction(f)&&f(a)})})},function(a){L.Utils.isFunction(e)&&e(a);L.Logger.error("[tk-sdk] getUserMedia failed when test microphone, failure info:",a)},{audio:{sourceId:a},video:!1})):(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(e)&&
e("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid deviceId"))};c.associateElementsToSpeaker=function(a,b,d){c.setElementSinkIdToAudioouputDevice(a,b,d)};c.getDevices=function(a){c.enumerateDevices(a)};c.setDevices=function(a,b){c.changeLocalDeviceToLocalstream(c.onDevicesSetted,a,function(a,c){a||0!==c||L.Utils.isFunction(b)&&b()})};return c}(TK);window.TK=window.TK||{};
TK.NativeAVMgr=function(){var b={room_video_width:320,room_video_height:240,room_video_fps:10,onMicVolumeReportCallback:void 0,onDevicesSetted:null,onDeviceChanged:null},a={},c={},e=100,d={player:null},m=null;b.setAVMgrProperty=function(a){for(var c in a)b.hasOwnProperty(c)&&(b[c]=a[c])};tknative.addEventListener("message",function(d){var f=d.data.name;if("onEnumerateDevices"===f){var e=function(){var b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),e=
L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug("devices in enumerateDevices(client):",d.data);var l=d.data.audioinput,h=d.data.videoinput,m=d.data.audiooutput,n=d.data.seq,r={},Y={},J={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},Z=L.Utils.getBrowserInfo();Z=Z&&Z.language&&Z.language.toLowerCase().match(/zh/g)?"chinese":"english";var ca={videoinput:{label:"chinese"===Z?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":
"video input device ",num:0},audioinput:{label:"chinese"===Z?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===Z?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}},K=function(a){if(null!=a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label){var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!c.label&&ca[a.kind]&&(c.label=ca[a.kind].label+ ++ca[a.kind].num);"audioinput"===a.kind&&
a.deviceId===b&&(J.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===f&&(J.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===e&&(J.useDevices[a.kind]=a.deviceId);r[a.kind]=r[a.kind]||a.deviceId;J.devices[a.kind].push(c);J.hasdevice[a.kind]=!0;"default"===a.deviceId&&(Y[a.kind]=a.deviceId)}};Array.isArray(l)&&l.forEach(function(a){K(a)});Array.isArray(h)&&h.forEach(function(a){K(a)});Array.isArray(m)&&m.forEach(function(a){K(a)});J.useDevices.audioinput||(J.useDevices.audioinput=
Y.audioinput||r.audioinput||"");J.useDevices.videoinput||(J.useDevices.videoinput=Y.videoinput||r.videoinput||"");J.useDevices.audiooutput||(J.useDevices.audiooutput=Y.audiooutput||r.audiooutput||"");L.Utils.localStorage?c[n].isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,J.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,J.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,J.useDevices.audiooutput)):
L.Logger.error("not support localStorage");a[n]&&(a[n](J),delete a[n]);c[n]&&delete c[n]};TK.isTkNative&&TK.subscribe_from_native?e():navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(a){var b=[];a.forEach(function(a){"audiooutput"===a.kind&&b.push({kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId})});d.data.audiooutput=b;e()}).catch(function(a){L.Logger.error("[tk-sdk]enumerateDevices error :"+a.name+": "+a.message);
d.data.audiooutput=[];e()}):(L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),d.data.audiooutput=[],e())}if("onMicVolumeReport"===f){var m=d.data.volume;if(null===m||void 0===m)return;if(a["detecte-mic-callback"]&&"function"===typeof a["detecte-mic-callback"])a["detecte-mic-callback"](m);if(b.onMicVolumeReportCallback&&"function"===typeof b.onMicVolumeReportCallback)b.onMicVolumeReportCallback(m/100,d.data.connectionId)}"onGetSpeakerVolume"===f&&(m=d.data.volume,
f=d.data.seq,"function"===typeof a[f]&&(m=Math.round(m/2.55),a[f](m),delete a[f]))},!1);var n=function(a,c,d,e){var f=function(b){tknative.postMessage({command:"setCamera",deviceId:b.video.deviceId,width:Number(b.video.width),height:Number(b.video.height),fps:Number(b.video.frameRate)});tknative.postMessage({command:"setMicrophone",deviceId:b.audio.deviceId});a(null)};d=d||{audio:{},video:{}};if(d.screen)L.Logger.debug("[tk-sdk]Screen access requested!"),a(null);else{var l={video:{},audio:{},screen:d.screen};
"object"===typeof d.audio&&(l.audio=d.audio);e=void 0!=e&&null!=e&&"object"===typeof e?e:{video:{},audio:{},exclude:{}};e.video=e.video||{};e.audio=e.audio||{};var h=d.audio.mandatory||{sourceId:e.audio.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||""},m=d.video.mandatory||{sourceId:e.video.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",idealWidth:b.room_video_width||320,maxWidth:b.room_video_width||320,idealHeight:b.room_video_height||
240,maxHeight:b.room_video_height||240};l.video.width=m.maxWidth;l.video.height=m.maxHeight;void 0!==d.video.optional?l.video.frameRate=d.video.optional[1].maxFrameRate:(c={idealFrameRate:Number(b.room_video_fps||10),maxFrameRate:Number(b.room_video_fps||10)},void 0!=c.idealFrameRate&&void 0!=c.maxFrameRate?l.video.frameRate=c.maxFrameRate:void 0!=c.frameRate&&(l.video.frameRate=c.frameRate));m.sourceId&&h.sourceId?(null!==h.sourceId&&void 0!==h.sourceId?l.audio.deviceId=h.sourceId:l.audio=!1,null!==
m.sourceId&&void 0!==m.sourceId?l.video.deviceId=m.sourceId:l.video=!1,e.exclude&&e.exclude.video?l.video=!1:e.exclude&&e.exclude.audio&&(l.audio=!1),f(l)):b.enumerateDevices(function(a){var b=a.useDevices;a=a.hasdevice;null===a.videoinput||void 0===a.videoinput||null===b.videoinput||void 0===b.videoinput||m.sourceId||(m.sourceId=b.videoinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,m.sourceId));null===a.audioinput||void 0===a.audioinput||null===b.audioinput||void 0===b.audioinput||
h.sourceId||(h.sourceId=b.audioinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,h.sourceId));null!==h.sourceId&&void 0!==h.sourceId?l.audio.deviceId=h.sourceId:l.audio=!1;null!==m.sourceId&&void 0!==m.sourceId?l.video.deviceId=m.sourceId:l.video=!1;e.exclude&&e.exclude.video?l.video=!1:e.exclude&&e.exclude.audio&&(l.audio=!1);f(l)})}};b.getUserMedia=function(a,b,c,d){n(a,b,c,d)};b.startDetecteMic=function(c,d){b.stopDetectMic();tknative.postMessage({command:"startDetecteMic",
deviceId:c});a["detecte-mic-callback"]=d};b.stopDetectMic=function(){tknative.postMessage({command:"stopDetecteMic"});delete a["detecte-mic-callback"]};b.startDetecteCam=function(a,c){b.stopDetecteCam();tknative.postMessage({command:"startDetecteCam",deviceId:a,args:c})};b.stopDetecteCam=function(){tknative.postMessage({command:"stopDetecteCam"})};b.enumerateDevices=function(b,d){L.Logger.debug("[tk-sdk]call enumerateDevices from client!");var f=e++;a[f]=b;b={};b.isSetlocalStorage=void 0===d?!1:void 0!=
d.isSetlocalStorage?d.isSetlocalStorage:!1;c[f]=b;tknative.postMessage({command:"enumerateDevices",seq:f})};b.setSpeaker=function(a){tknative.postMessage({command:"setSpeaker",deviceId:a})};b.getsSoundMeterInstance=function(a){if(a)return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,f=0;for(c=0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&
(f+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=f/a.length};b.connectToSource=function(a,c){L.Logger.debug("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&c(null)}catch(t){L.Logger.error(t),"undefined"!==typeof c&&c(t)}};b.stop=function(){b.mic&&b.mic.disconnect&&b.mic.disconnect();b.script&&b.script.disconnect&&b.script.disconnect()};return b}(a);
L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};b.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),tknative.postMessage({command:"setSpeaker",deviceId:b}),c&&"function"===typeof c&&c(!1);else{var d=0,f=function(a,f,e){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var f=
a.getAttribute("id");L.Logger.debug("[tk-sdk]Audio output device set to "+b,f?" , element id is "+f:"  element:",f?"":a);d++;d===e&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var f=void 0,l=a.getAttribute("id");b&&"SecurityError"===b.name&&(f="You need to use HTTPS for selecting audio output device  ");L.Logger.warning("[tk-sdk]setSinkId error:",b,f?f:"",l?" , element id is "+l:"  element:",l?"":a);d++;d===e&&c&&"function"===typeof c&&c(!1)})}catch(Y){f=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",
Y,f?" , element id is "+f:"  element:",f?"":a),d++,d===e&&c&&"function"===typeof c&&c(!1)}else f=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,f?" , element id is "+f:"  element:",f?"":a),d++,d===e&&c&&"function"===typeof c&&c(!1);else d++,d===e&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var e=document.getElementsByTagName("audio"),l=document.getElementsByTagName("video");if(e&&0<e.length)for(var h=0;h<e.length;h++){var m=
e[h];a.push(m)}if(l&&0<l.length)for(h=0;h<l.length;h++)m=l[h],a.push(m)}if(a&&0<a.length)for(e=a.length,h=0;h<a.length;h++)m=a[h],f(m,h,e);else f(a,0,1)}else c&&"function"===typeof c&&c(!1)};b.changeLocalDeviceToLocalstream=function(a,c,d,e){c=c||{};var f={},l;for(l in c)L.Constant.deviceStorage[l]&&c[l]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[l])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[l],c[l]),f[l]=!0);f.audiooutput&&b.setElementSinkIdToAudioouputDevice(e);f.videoinput||
f.audioinput?b.getUserMedia(function(b){a&&"function"===typeof a&&a(b);d&&"function"===typeof d&&d(b)},function(a){d&&"function"===typeof d&&d(void 0)},void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1}):d&&"function"===typeof d&&d(void 0)};b.addOndevicechange=function(a){};b.removeOndevicechange=function(){};b.addDeviceChangeListener=function(a){};b.removeDeviceChangeListener=function(){};b.getSpeakerVolume=function(b){if("function"!==typeof b)L.Logger.error("[tk-sdk] wrong arguments in funciton getSpeakerVolume");
else{var c=e++;a[c]=b;tknative.postMessage({command:"getSpeakerVolume",seq:c})}};b.setSpeakerVolume=function(a){void 0===a||null===a||0>a||100<a?L.Logger.error("[tk-sdk] invalid arguments in funciton setSpeakerVolume"):(a=Math.round(2.55*a),tknative.postMessage({command:"setSpeakerVolume",volume:a}))};b.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};
b.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};b.playDeviceStream=function(a,b,c){c=c||{};a?(a=TK.NativeVideoPlayer({id:"videoinput_stream_player",stream:{stream:void 0},elementID:a,options:c}),"function"===typeof b&&b(a)):L.Logger.error("[tk-sdk]playDeviceStream elementID can not be empty!")};b.unplayDeviceStream=function(a){a&&a&&a.destroy&&a.destroy()};
b.associateElementsToSpeaker=function(a,b,c){};b.getDevices=function(a){b.enumerateDevices(a)};b.setDevices=function(a,c){b.changeLocalDeviceToLocalstream(b.onDevicesSetted,a,function(a){})};b.stopCameraTest=function(){b.unplayDeviceStream(d.player);tknative.postMessage({command:"stopDetecteCam"});delete d.player;d.player=null};b.startCameraTest=function(a,c,e){if(a)if(c){b.stopCameraTest();var f=void 0;b.playDeviceStream(c,function(a){d.player=a;f=a.id});f?tknative.postMessage({command:"startDetecteCam",
deviceId:a,args:{elementId:f}}):(L.Utils.isFunction(e)&&e("TK_ERR_INTERNAL_EXCEPTION"),L.Logger.error("startCameraTest occurred internal exception"))}else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid elementId");else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid deviceId")};b.stopMicrophoneTest=function(){b.stopDetectMic();var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);a&&tknative.postMessage({command:"setMicrophone",
deviceId:a})};b.startMicrophoneTest=function(a,c,d,e){a?c?b.startDetecteMic(a,d):(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid deviceId"))};b.stopSpeakerTest=function(){if(m){var a={};a.audioUrl=m;tknative.postMessage({command:"clientAudioMediaPlayer",action:"stop",options:a});m=null}(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))&&
b.setSpeaker(a)};b.startSpeakerTest=function(a,c,d){a?c?(b.stopSpeakerTest(),b.setSpeaker(a),a={},a.audioUrl=c,tknative.postMessage({command:"clientAudioMediaPlayer",action:"play",options:a}),m=c):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startSpeakerTest got invalid deviceId"))};return b};var TK=TK||{};
TK.NativeProxy=function(){function b(){if(void 0===TK.nativeCallSeq||"number"!==typeof TK.nativeCallSeq)TK.nativeCallSeq=0;return++TK.nativeCallSeq}var a=TK.EventDispatcher({});a.onNativeStartShareMediaFile=null;a.onNativeStopShareMediaFile=null;var c=function(b){if(!L.Utils.isNull(b)&&!L.Utils.isNull(b.data)&&!L.Utils.isNull(b.data.name)){var c=b.data.name;if("onValidWindowList"===c)c=b.data.seq,void 0!==c&&"function"===typeof TK.waitNativeToCallbackList[c]&&(TK.waitNativeToCallbackList[c](b.data.validWindows),delete TK.waitNativeToCallbackList[c]);
else if("onLog"===c)c=b.data.level,b=b.data.log,0===c&&L.Logger.debug(b),1===c&&L.Logger.info(b),2===c&&L.Logger.warning(b),3===c&&L.Logger.error(b);else if("onMonitorCount"===c){var d=b.data.count;c=b.data.seq;void 0!==c&&"function"===typeof TK.waitNativeToCallbackList[c]&&(TK.waitNativeToCallbackList[c](d),delete TK.waitNativeToCallbackList[c])}else if("onTakSnapshot"===c){c=b.data.action;d=b.data.requestId;var e=b.data.total,f=b.data.now,m=b.data.code;"function"===typeof TK.waitNativeToCallbackList[d]&&
(b=L.Utils.toJsonParse(b.data.result),TK.waitNativeToCallbackList[d](c,d,e,f,m,b),"result"===c&&delete TK.waitNativeToCallbackList[d])}else if("onLocalRecord"===c)d=b.data.arg,c=b.data.seq,"function"===typeof TK.waitNativeToCallbackList[c]&&(TK.waitNativeToCallbackList[c](d),delete TK.waitNativeToCallbackList[c]);else if("onGetOpenOrSaveFileName"===c)d=b.data.arg,c=b.data.seq,"function"===typeof TK.waitNativeToCallbackList[c]&&(TK.waitNativeToCallbackList[c](d),delete TK.waitNativeToCallbackList[c]);
else if("onGetMediaPlayPos"===c){if(d=b.data.arg,d.duration=parseInt(1E3*d.duration),1<d.pos&&(d.pos=1),d.position=parseInt(d.pos*d.duration),d.position>d.duration&&(d.position=d.duration),c=b.data.seq,"function"===typeof TK.waitNativeToCallbackList[c])TK.waitNativeToCallbackList[c](d)}else"onNativeNotification"===c?(d=b.data.arg,TK.isTkNative&&"object"===typeof d&&"onMediaFileEnded"===d.name&&(b=TK.RoomEvent({type:"room-clientNotification-onMediaFileEnded",message:{}}),a.dispatchEvent(b))):"onGetMediaFileInfo"===
c&&(d=b.data.arg,c=b.data.seq,d.duration&&(d.duration*=1E3),"function"===typeof TK.waitNativeToCallbackList[c]&&(TK.waitNativeToCallbackList[c](d),delete TK.waitNativeToCallbackList[c]))}},e=void 0,d=0,m=void 0;a.initialize=function(){tknative.addEventListener("message",c,!1)};a.publishScreen=function(b,c,d){if(TK.isTkNative)if(TK.isOnlyAudioRoom)L.Logger.warning("[tk-sdk]only audio room not execute method publishScreen method !");else{if(_status!=STATUS_ALLREADY)return L.Logger.warning("[tk-sdk]publish with wrong room status",
_status),ERR_INVALID_STATUS;if(_isDesktopSharing)L.Logger.error("[tk-sdk]Screen has been shared already");else if(L.Logger.info("[tk-sdk]calling screenPublish stream , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),b&&!b.failed&&void 0===a.remoteStreams[b.getID()]){if(b.hasScreen())return _desktop_stream=b,a.publish(_desktop_stream,c,d);L.Logger.error("[tk-sdk]Screen Shared streaming screen  must be true",b);d&&d(void 0,"Screen Shared streaming screen must be true")}else L.Logger.error("[tk-sdk]Trying to publish invalid screenStream",
b),d&&d(void 0,"Trying to publish invalid screenStream")}else L.Logger.warning("[tk-sdk]publishScreen method must be in the client environment!")};a.unpublishScreen=function(b,c){if(TK.isTkNative){if(_status!=STATUS_ALLREADY)return ERR_INVALID_STATUS;if(_isDesktopSharing)return L.Logger.info("[tk-sdk]calling unpublishScreen , stream id:"+_desktop_stream.getID()+" , extensionId is "+_desktop_stream.extensionId+", attrs is "+L.Utils.toJsonStringify(_desktop_stream.getAttributes())),a.unpublish(_desktop_stream,
b,c)}else L.Logger.warning("[tk-sdk]unpublishScreen method must be in the client environment!")};var n=function(a,c,d){TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getMediaFileInfo method got invalid fileName!")):(d=b(),TK.waitNativeToCallbackList[d]=c,tknative.postMessage({command:"getMediaFileInfo",seq:d,file:a})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getMediaFileInfo method must be called in the native environment!"))};
a.startShareMediaFile=function(b,c,e){TK.isTkNative?L.Utils.isNull(b)?(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startShareMediaFile method got invalid fileName!")):L.Utils.isNull(c)?(L.Utils.isFunction(e)&&e("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startShareMediaFile method got invalid elementId!")):n(b,function(f){var l=f.duration,h=f.width,k=f.height,m=f.video,n=f.audio;if(f.video||f.audio){f={width:h,height:k,duration:l,filename:L.Utils.getFileName(b)};
m={video:m,audio:n,attributes:f,path:b};if(L.Utils.isFunction(a.onNativeStartShareMediaFile))a.onNativeStartShareMediaFile(m,c,function(a,b){!a&&L.Utils.isFunction(e)&&e(b)});d=1}else L.Utils.isFunction(e)&&e("TK_ERR_INVALID_FIEL"),L.Logger.error("[tk-sdk] startShareMediaFile method got invalid file!")},e):(L.Utils.isFunction(e)&&e("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startShareMediaFile method must be called in the native environment!"))};a.stopShareMediaFile=function(b){if(TK.isTkNative){if(L.Utils.isFunction(a.onNativeStopShareMediaFile))a.onNativeStopShareMediaFile(function(a,
c){!a&&L.Utils.isFunction(b)&&b(c)});d=0}else L.Utils.isFunction(b)&&b("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startShareMediaFile method must be called in the native environment!")};a.pauseShareMediaFile=function(a,b,c){if(TK.isTkNative)if(L.Utils.isBoolean(a)){if(!0===a&&2!==d||!1===a&&1!==d)tknative.postMessage({command:"pauseMediaFile",pause:a}),d=!0===a?2:1;L.Utils.isFunction(b)&&b(!0===a?"Paused":"Sharing")}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] pauseShareMediaFile function got wrong arguments");
else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startShareMediaFile method must be called in the native environment!")};a.registerMediaFileProgressListener=function(c,h,l){TK.isTkNative?L.Utils.isNull(c)||0>=c||!L.Utils.isFunction(h)?(L.Utils.isFunction(l)&&l("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] registerMediaFileProgressListener function got wrong arguments")):(a.unregisterMediaFileProgressListener(),1E3>c&&(c=1E3),m=b(),TK.waitNativeToCallbackList[m]=
h,e=setInterval(function(){1===d&&tknative.postMessage({command:"getMediaPlayPos",seq:m})},c)):(L.Utils.isFunction(l)&&l("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] registerMediaFileProgressListener method must be called in the native environment!"))};a.unregisterMediaFileProgressListener=function(a){TK.isTkNative?(L.Utils.isNull(e)||(clearInterval(e),e=void 0),L.Utils.isNull(m)||(delete TK.waitNativeToCallbackList[m],m=void 0)):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] unregisterMediaFileProgressListener method must be called in the native environment!"))};
a.seekMediaFile=function(a,b){TK.isTkNative?L.Utils.isNumber(a)?(0>a&&(a=0),1<a&&(a=1),tknative.postMessage({command:"seekMediaFile",pos:a})):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] seekShareMediaFile function got wrong arguments")):(L.Utils.isFunction(b)&&b("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] seekShareMediaFile method must be called in the native environment!"))};a.getValidWindowList=function(a,c){if(TK.isTkNative)if(void 0===a||null===a||"function"!==
typeof c)L.Logger.error("[tk-sdk] getValidWindowList function got wrong arguments");else{var d=b();TK.waitNativeToCallbackList[d]=c;tknative.postMessage({command:"getValidWindowList",type:Number(a),seq:d})}else L.Logger.warning("[tk-sdk]getValidWindowList method must be in the client environment!")};a.updateWindowSource=function(a){TK.isTkNative?(a.id||(a.id=0),a.x||(a.x=0),a.y||(a.y=0),a.width||(a.width=0),a.height||(a.height=0),a.mixMic||(a.mixMic=!1),a.mixSpk||(a.mixSpk=!1),a.type||(a.type=0),
tknative.postMessage({command:"updateWindowSource",id:Number(a.id),left:Number(a.x),top:Number(a.y),width:Number(a.width),height:Number(a.height),mixMic:a.mixMic,mixSpk:a.mixSpk,type:Number(a.type)})):L.Logger.warning("[tk-sdk] updateWindowSource method must be in the client environment!")};a.getMonitorCount=function(a){if(TK.isTkNative)if("function"!==typeof a)L.Logger.error("[tk-sdk] getMonitorCount function got wrong arguments");else{var c=b();TK.waitNativeToCallbackList[c]=a;tknative.postMessage({command:"getMonitorCount",
seq:c})}else L.Logger.warning("[tk-sdk]getMonitorCount method must be in the client environment!")};a.enableViceMonitor=function(){TK.isTkNative?(TK.subscribe_from_native=!0,tknative.postMessage({command:"enableViceMonitor"})):L.Logger.warning("[tk-sdk] enableViceMonitor method must be in the client environment!")};a.takeSnapshot=function(a,c,d){if(TK.isTkNative)if(c)if("function"!==typeof d)L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");else{var e=b();TK.waitNativeToCallbackList[e]=
d;tknative.postMessage({command:"takeSnapshot",needMin:a,fileName:c,requestId:e})}else L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments");else L.Logger.warning("[tk-sdk] takeSnapshot method must be in the client environment!")};a.startRecordScreen=function(a,c,d){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.filename))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startRecordScreen function got wrong arguments");else{var e={type:1,fileName:a.filename,
forcepath:!0},f;for(f in a)"type"!==f&&"filename"!==f&&(e[f]=a[f]);a=b();TK.waitNativeToCallbackList[a]=function(a){"Recording"===a.action?L.Utils.isFunction(c)&&c({filename:a.filepath}):L.Utils.isFunction(d)&&d("record screen failed")};tknative.postMessage({command:"startLocalRecord",args:e,seq:a})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startRecordScreen method must be called in the native environment!")};a.pauseRecordScreen=function(a,c,d){TK.isTkNative?
L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] pauseRecordScreen function got wrong arguments")):(a={type:1,pause:a},d=b(),TK.waitNativeToCallbackList[d]=function(a){L.Utils.isFunction(c)&&c(a.action)},tknative.postMessage({command:"pauseLocalRecord",args:a,seq:d})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseRecordScreen method must be called in the native environment!"))};a.stopRecordScreen=function(a){TK.isTkNative?
tknative.postMessage({command:"stopLocalRecord",args:{type:1}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopRecordScreen method must be called in the native environment!"))};a.startRecordAudio=function(a,c,d){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.filename))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startRecordAudio function got wrong arguments");else{a={type:0,fileName:a.filename,forcepath:!0};var e=b();TK.waitNativeToCallbackList[e]=
function(a){"Recording"===a.action?L.Utils.isFunction(c)&&c({filename:a.filepath}):L.Utils.isFunction(d)&&d("record screen failed")};tknative.postMessage({command:"startLocalRecord",args:a,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startRecordAudio method must be called in the native environment!")};a.pauseRecordAudio=function(a,c,d){TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] pauseRecordAudio function got wrong arguments")):
(a={type:0,pause:a},d=b(),TK.waitNativeToCallbackList[d]=function(a){L.Utils.isFunction(c)&&c(a.action)},tknative.postMessage({command:"pauseLocalRecord",args:a,seq:d})):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseRecordAudio method must be called in the native environment!"))};a.stopRecordAudio=function(a){TK.isTkNative?tknative.postMessage({command:"stopLocalRecord",args:{type:0}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopRecordAudio method must be called in the native environment!"))};
a.getOpenFileName=function(a,c,d){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.caption)||L.Utils.isNull(a.filter))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getOpenFileName function got wrong arguments");else{var e=b();TK.waitNativeToCallbackList[e]=function(a){"Activated"===a.action?L.Utils.isFunction(d)&&(d("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning("[tk-sdk] getOpenFileName in progress")):L.Utils.isFunction(c)&&c(a)};tknative.postMessage({command:"getOpenFileName",
args:a,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getOpenFileName method must be called in the native environment!")};a.getSaveFileName=function(a,c,d){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.caption)||L.Utils.isNull(a.filter))L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getSaveFileName function got wrong arguments");else{var e=b();TK.waitNativeToCallbackList[e]=function(a){"Activated"===a.action?L.Utils.isFunction(d)&&
(d("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning("[tk-sdk] getSaveFileName in progress")):L.Utils.isFunction(c)&&c(a)};tknative.postMessage({command:"getSaveFileName",args:a,seq:e})}else L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getSaveFileName method must be called in the native environment!")};a.listenCloseEvent=function(){if(TK.isTkNative)try{talk_window&&talk_window.listenCloseEvent?talk_window.listenCloseEvent():L.Logger.error("[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(f){L.Logger.error("[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning("[tk-sdk]listenCloseEvent method must be in the client environment!")};
a.shutdownNativeClient=function(){TK.isTkNative?tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning("[tk-sdk]shutdownNativeClient method must be in the client environment!")};a.closeWindow=function(){try{talk_window&&talk_window.closeWindow?talk_window.closeWindow():L.Logger.error("[tk-sdk]talk_window.closeWindow is not exist!")}catch(f){L.Logger.error("[tk-sdk] closeWindow function can not be called")}};a.clientAudioMediaPlayer=function(a,b,c){TK.isTkNative?2018031E3>TK.clientversion?
L.Logger.warning("[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(c=c||{},b?(L.Logger.info("[tk-sdk]clientAudioMediaPlayer url is "+a+" , action is "+b+" , options is"+L.Utils.toJsonStringify(c)),c.audioUrl=a,tknative.postMessage({command:"clientAudioMediaPlayer",action:b,options:c})):L.Logger.error("[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning("[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")};
a.clientPreloadMediaFile=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):Array.isArray(a)?a&&0<a.length&&tknative.postMessage({command:"clientPreloadMediaFile",urlArray:a}):L.Logger.error("[tk-sdk]clientPreloadMediaFile args must is array!"):L.Logger.warning("[tk-sdk]clientPreloadMediaFile method must be in the client environment!")};a.clientOpenBrowserUrl=function(a){TK.isTkNative?
2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):a?tknative.postMessage({command:"clientOpenBrowserUrl",url:a}):L.Logger.error("[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning("[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")};a.initBroadcast=function(a,b,c,d,e){TK.isTkNative?a?(b||(b=10),c||(c=3),d&&e?tknative.postMessage({command:"initBroadcast",url:a.toString(),
fps:Number(b),key_sec:Number(c),width:Number(d),height:Number(e)}):L.Logger.error("[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error("[tk-sdk]argument url of initBroadcast function not exist!"):L.Logger.warning("[tk-sdk]initBroadcast method must be in the client environment!")};a.updateBroadcast=function(a,b,c,d){a||(a=10);b||(b=3);c&&d?tknative.postMessage({command:"updateBroadcast",fps:Number(a),key_sec:Number(b),width:Number(c),height:Number(d)}):L.Logger.error("[tk-sdk]argument width or height of updateBroadcast function not exist!")};
a.uninitBroadcast=function(){TK.isTkNative?tknative.postMessage({command:"uninitBroadcast"}):L.Logger.warning("[tk-sdk]uninitBroadcast method must be in the client environment!")};a.startBroadcast=function(a){TK.isTkNative?a?tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error("[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning("[tk-sdk]startBroadcast method must be in the client environment!")};a.stopBroadcast=function(){TK.isTkNative?tknative.postMessage({command:"stopBroadcast"}):
L.Logger.warning("[tk-sdk]stopBroadcast method must be in the client environment!")};return a}(TK);
